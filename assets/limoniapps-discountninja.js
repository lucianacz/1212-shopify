/* Discount Ninja v3 - production */
//! Discount Ninja price rule engine
//! COPYRIGHT (c) 2017-2019 ALL RIGHTS RESERVED
//! See terms and conditions at https://support.discountninja.io/terms-and-conditions/conditions/terms-and-conditions
if(window.location.search.indexOf("frame_token")>-1&&window!==window.top)throw new Error("Limoni Apps DiscountNinja has detected it is running in the Shopify Admin theme editor. Aborting script.");if(void 0!==discountNinja||"undefined"!=typeof discountNinja_Script_Loading)discountNinja.Logging.LogVerbose("Aborting load of script because it is already loaded");else{let discountNinja_Script_Loading=!0;var discountNinja_Script_Core={Shop:"",Environment:"prod",Version:"6.1.203",SubscribedToDrawerCartOpened:!1,TriggerPromotion:function(t){try{let i=jQuery(t).attr("data-limoniapps-discountninja-token");null!=i&&""!==i&&(discountNinja.Logging.LogVerbose("Triggering offer with token "+i),discountNinja.Token.SetTokenInLocalStorage(i),discountNinja.Token.SetCartTokenInLocalStorage(i),discountNinja.Token.SetNonAutomaticTokenInSession(i),discountNinja_Script_Core.Start())}catch(t){discountNinja.Logging.LogError("Core.Exception in TriggerPromotion",t)}},ExecuteOnLoadCallback:function(){try{let callback=discountNinja.Cache.SessionGet("CallbackAfterReloadPageAddingFreeGift");callback&&""!==callback&&(discountNinja.Cache.SessionSet("CallbackAfterReloadPageAddingFreeGift",""),setTimeout(function(){try{discountNinja.Logging.LogVerbose("Executing CallbackAfterReloadPageAddingFreeGift"),eval(callback)}catch(t){discountNinja.Logging.LogError("PromotionFlow.ExecuteCallback.Eval",t)}},500))}catch(t){discountNinja.Logging.LogError("PromotionFlow.ExecuteCallback",t)}},Start:function(t){try{discountNinja_Script_Core.CurrentLocation=discountNinja.QueryParameter.RemoveFromUrl(window.location.href,"discountninjatestmode",1),discountNinja_Script_Core.CurrentLocation=discountNinja.QueryParameter.RemoveFromUrl(discountNinja_Script_Core.CurrentLocation,"discountninjalog",1),discountNinja_Script_Core.Shop=discountNinja.Environment.Shopify.MyShopifyDomain(),function(){try{discountNinja.TestMode.HandleQueryParameter(),discountNinja.Logging.HandleQueryParameter()}catch(t){discountNinja.Logging.LogError("Core.HandleDiscountNinjaQueryParameters",t)}}(),discountNinja.TestMode.TestModeOutputIssue=!1,t&&discountNinja.Logging.LogToConsole("information","\n\n"+discountNinja.Utilities.GetEmoji(128640)+" This forward-thinking shop uses Discount Ninja (an app by Limoni Apps) to drive more sales and increase average order value.\nScript version: v"+discountNinja_Script_Core.Version+", Environment: "+discountNinja_Script_Core.Environment+"\nLearn more at https://apps.shopify.com/discount-url?ref="+discountNinja_Script_Core.Shop+"\nOur script contains third-party, open source software and/or libraries. To view them and their license terms, go to https://support.discountninja.io/script-legal-notices\n\n","green",!0,!0),discountNinja.Logging.LogVerbose("Loaded at '"+Date.now().toString()+"' - Version: "+discountNinja_Script_Core.Version);let i=discountNinja.Environment.Shopify;if(!(i.IsCartPage()||i.IsProductPage()||i.IsCollectionPage()||i.IsHomePage()||i.IsBlogPost()||i.IsCustomPage()||i.IsSearchPage()||i.IsAccountPage()))return void discountNinja.Logging.LogVerbose("Not a supported page type. Aborting script.");"function"==typeof XMLHttpRequest?XMLHttpRequest.prototype.send=discountNinja.XmlHttpRequest.CreateSendInterceptor("readystatechange",discountNinja.XmlHttpRequest.HandleSend,XMLHttpRequest.prototype.send):discountNinja.Logging.LogErrorMessage("Core","XMLHttpRequest not available"),discountNinja.XmlHttpRequest.CreateFetchInterceptor(discountNinja.XmlHttpRequest.HandleFetch),LimoniAppsLoadJQuery(LimoniAppsLoadJQueryNotify(LimoniAppsLoadOuiBounce(LimoniAppsLoadFontAwesome(LimoniAppsLoadMoment(LimoniAppsLoadMomentFormat(LimoniAppsLoadMomentTimezone(discountNinja.LiquidData.WaitForLiquidAsset(function(){try{!function(){function t(t){return t&&(t.Format&&(t.Format=t.Format.replace(/\\{/g,"{").replace(/\\}/g,"}")),t.PrefixText&&(t.PrefixText=t.PrefixText.replace(/\\{/g,"{").replace(/\\}/g,"}")),t.SuffixText&&(t.SuffixText=t.SuffixText.replace(/\\{/g,"{").replace(/\\}/g,"}"))),t}if(discountNinja.Settings.Settings=window.discountNinjaContext.Settings,discountNinja.Settings.Settings.CurrencySettings){discountNinja.Settings.Settings.CurrencySettings.MoneyFormat&&(discountNinja.Settings.Settings.CurrencySettings.MoneyFormat=discountNinja.Settings.Settings.CurrencySettings.MoneyFormat.replace(/\\{/g,"{").replace(/\\}/g,"}"));let i=discountNinja.Settings.Settings.PriceUpdateSettings;i.ProductPagePriceFormat&&(i.ProductPagePriceFormat=t(i.ProductPagePriceFormat)),i.OtherPagePriceFormat&&(i.OtherPagePriceFormat=t(i.OtherPagePriceFormat)),i.CartProductPriceFormat&&(i.CartProductPriceFormat=t(i.CartProductPriceFormat)),i.CartLinePriceFormat&&(i.CartLinePriceFormat=t(i.CartLinePriceFormat)),i.CartSubtotalPriceFormat&&(i.CartSubtotalPriceFormat=t(i.CartSubtotalPriceFormat)),i.DrawerCartProductPriceFormat&&(i.DrawerCartProductPriceFormat=t(i.DrawerCartProductPriceFormat)),i.DrawerCartLinePriceFormat&&(i.DrawerCartLinePriceFormat=t(i.DrawerCartLinePriceFormat)),i.DrawerCartSubtotalPriceFormat&&(i.DrawerCartSubtotalPriceFormat=t(i.DrawerCartSubtotalPriceFormat))}}();let t=discountNinja.Settings.Settings;if(!t||!t.CurrencySettings||!t.CurrencySettings.BaseCurrency)return void discountNinja.Logging.LogErrorMessage("Core.LoadSettings","No settings available");if("undefined"!==window.discountNinjaContextAdditionalProduct&&window.discountNinjaContextAdditionalProduct&&"object"==typeof window.discountNinjaContextAdditionalProduct.CollectionProducts)for(let t=0;t<window.discountNinjaContextAdditionalProduct.CollectionProducts.length;t++)window.discountNinjaContext.CollectionProducts.push(window.discountNinjaContextAdditionalProduct.CollectionProducts[t]);discountNinja.Checkout.Shopify.RegisterEventHandlerForCheckout(),discountNinja.Cart.Shopify.RegisterEventHandlerForAddToCart();let i=discountNinja.DiscountCode;i.EnableDiscountCodeField(),i.UpdateTags(),i.LockDiscountCodeFieldIfRequired(),discountNinja_Script_Core.SubscribedToDrawerCartOpened||discountNinja.Cart.Shopify.SubscribeDrawerCartOpened(),discountNinja.Logging.StartTimer(),discountNinja.Trigger.IntializeTimeOnPageCounter(),discountNinja.Trigger.TrackScrollPercentage(),discountNinja.Offer.PrimaryOffer=null,discountNinja_Script_Core.RegisterDiscountButtonClickEvents(),discountNinja.Logging.LogVerbose("Getting offer info"),discountNinja.Logging.ShowTimeElapsed("Loading offer info"),discountNinja.Offer.LoadApplicableOffers(function(){!function(t){try{let i=0,n=null,e=function(){i++,"undefined"!=typeof jQuery&&"boolean"==typeof jQuery.isReady&&(discountNinja_Script_Core.DOMHasLoaded=discountNinja_Script_Core.DOMHasLoaded||jQuery.isReady),discountNinja_Script_Core.DOMHasLoaded||50===i?(null!==n&&clearTimeout(n),50===i&&discountNinja.Logging.LogErrorMessage("Core.Start.WaitForDom","Timed out"),discountNinja.Logging.LogVerbose("Waiting for DOM to load - DONE"),"function"==typeof t&&null!==t&&t()):n=setTimeout(function(){try{e()}catch(t){discountNinja.Logging.LogError("Core.WaitForDom",t)}},100)};e()}catch(t){discountNinja.Logging.LogError("Core.WaitForDom",t)}}(function(){discountNinja.Cart.Shopify.UpdateCart(function(){discountNinja.DiscountedCart.BuildDiscountedCart(function(){discountNinja.Checkout.Shopify.InjectLoadingCheckoutPopUp(),discountNinja.PromotionFlow.StartFlow(),discountNinja.ProductData.Save()})})})},discountNinja.PromotionFlow.StopFlow),discountNinja.PromotionEvent.ProcessQueue()}catch(t){discountNinja.Logging.LogError("Core.StartInternal",t)}}))))))))}catch(t){discountNinja.Logging.LogError("Core.Start",t)}},RegisterDiscountButtonClickEvents:function(){try{discountNinja.Logging.LogVerbose("Registering event handler for discount buttons"),function(){try{jQuery("body").find(".limoniapps-discountninja-discountbutton").each(function(){jQuery(this).off("click")})}catch(t){discountNinja.Logging.LogError("Core.UnRegisterDiscountButtonClickEvents",t)}}(),jQuery("body").find(".limoniapps-discountninja-discountbutton").each(function(){jQuery(this).on("click",function(t){discountNinja.Logging.LogVerbose("Offer triggered via discount button"),discountNinja_Script_Core.TriggerPromotion(t.currentTarget)})})}catch(t){discountNinja.Logging.LogError("Core.RegisterDiscountButtonClickEvents",t)}},CheckoutCurrentVariant:function(){try{if(discountNinja.Environment.Shopify.IsProductPage()){let t=discountNinja.Environment.Shopify.VariantId(),i=discountNinja.DiscountCode.GetDiscountCode(),n=jQuery('form input[name="quantity"]'),e=1;null!==n&&1===n.length&&(e=n.val()),(void 0===e||"undefined"===e||null===e||isNaN(e))&&(e=1);let o=null==i||""===i?"":"?discount="+i,r=discountNinja.QueryParameter.Get("locale"),a=void 0===r?"":""===o?"?locale="+r:"&locale="+r;window.location.assign("    /"+t+":"+e+o+a)}}catch(t){discountNinja.Logging.LogError("Core.CheckoutCurrentVariant",t)}}},discountNinja_Script_Badge={WrapperClass:"limoniapps-discountninja-badge-wrapper",Add:function(t,i,n){try{if(t.BadgeSettings&&t.BadgeSettings.Enabled){let e=function(t,i){try{if(!t)return"";let n=t.BadgeSettings,e=discountNinja.ShortCode.ReplaceAllPlaceHolders(t,discountNinja.TextSettings.GetText(n.Text,t),i),o=jQuery("#limoniapps-discountninja-badge-template").html();return o=discountNinja.TemplateParameter.Replace(o,"TEXT",e),o=discountNinja.TemplateParameter.Replace(o,"TOKEN",t.Token),o=discountNinja.TemplateParameter.Replace(o,"STYLE",n.Style),o=discountNinja.TemplateParameter.Replace(o,"POSITION",n.Position),o=discountNinja.TemplateParameter.Replace(o,"SIZE",n.Size)}catch(t){return discountNinja.Logging.LogError("Badge.GetHtml",t),""}}(t,i),o='<div class="'+discountNinja_Script_Badge.WrapperClass+'">'+e+"</div>";jQuery(n).append(o)}else discountNinja.Logging.LogVerbose("Not showing badge, not enabled for offer with token "+t.Token)}catch(t){return discountNinja.Logging.LogError("Badge.Add",t),""}}},discountNinja_Script_Notification={AnimateOnReminderIntervalHandle:-1,DelayIntervalHandle:-1,GetClass:function(){return"limoniapps-notification.active"},GetStyle:function(t){try{return t?t.NotificationSettings.Style:""}catch(t){return discountNinja.Logging.LogError("Notification.GetStyle",t),""}},GetText:function(t,i,n){try{return discountNinja.ShortCode.ReplaceAllPlaceHolders(i,discountNinja.TextSettings.GetText(t,i),n)}catch(t){return discountNinja.Logging.LogError("Notification.GetText",t),""}},GetHtml:function(t){try{let i=discountNinja_Script_Notification.DefaultOffer();if(!i)return"";let n=discountNinja.DiscountTier.GetCurrentDiscountTier(i),e=discountNinja.DiscountTier.GetPercentageAmountFromDiscountTier(n),o=i.NotificationSettings,r=discountNinja_Script_Notification.AppSettings(),a=discountNinja.TextSettings.WrapInColor(o.HeaderTextColor,discountNinja_Script_Notification.GetText(o.Header,i,e)),c=discountNinja.TextSettings.WrapInColor(o.FooterTextColor,discountNinja_Script_Notification.GetText(o.Footer,i,e)),s=discountNinja.TextSettings.WrapInColor(o.TimerFooterTextColor,discountNinja.Timer.IsTimerStarted()?discountNinja_Script_Notification.GetText(o.TimerFooter,i,e):""),u=discountNinja.TextSettings.WrapInColor(o.MinimizedTextColor,discountNinja_Script_Notification.GetText(o.MinimizedText,i,e)),d=jQuery("#limoniapps-discountninja-notification-template").html();return d=discountNinja.TemplateParameter.Replace(d,"HEADER",a),d=discountNinja.TemplateParameter.Replace(d,"MINIMIZED",u),d=discountNinja.TemplateParameter.Replace(d,"BODY",t),d=discountNinja.TemplateParameter.Replace(d,"FOOTER",c),d=discountNinja.TemplateParameter.Replace(d,"TIMER_FOOTER",s),d=discountNinja.TemplateParameter.Replace(d,"TOKEN",i.Token),d=discountNinja.TemplateParameter.Replace(d,"CLOSEABLE",r.CloseButton?"closeable":""),d=discountNinja.TemplateParameter.Replace(d,"MINIMIZABLE",r.MinimizeButton?"limoniapps-minimizable maximized":""),d=discountNinja.TemplateParameter.Replace(d,"HASOFFERCOUNT",r.OfferCounter?"limoniapps-hasoffercount":""),d=discountNinja.TemplateParameter.Replace(d,"ACTIVE","active"),d=discountNinja.TemplateParameter.Replace(d,"POSITION",o.PlacementVertical+"-"+o.PlacementHorizontal)}catch(t){return discountNinja.Logging.LogError("Notification.GetHtml",t),""}},Hiding:!1,Hide:function(t){try{discountNinja.Logging.LogVerbose("Hiding notification");let i=jQuery("."+discountNinja_Script_Notification.GetClass());i&&(discountNinja_Script_Notification.Hiding=!0,discountNinja_Script_Notification.ApplyAnimation(i,discountNinja_Script_Notification.AppSettings().AnimationExit),setTimeout(function(){try{discountNinja_Script_Notification.Hiding&&i.hide()}catch(t){discountNinja.Logging.LogError("Notification.Hide",t)}},800)),t&&discountNinja_Script_Notification.SetHiddenInSession(!0),discountNinja.Logging.LogVerbose("Notification hidden")}catch(t){discountNinja.Logging.LogError("Notification.Hide",t)}},ToggleMinMaximize:function(){try{discountNinja_Script_Notification.IsMinimized()?discountNinja_Script_Notification.Maximize():discountNinja_Script_Notification.Minimize()}catch(t){discountNinja.Logging.LogError("Notification.ToggleMinMaximize",t)}},Minimize:function(){try{if("minimized"===discountNinja_Script_Notification.IsMinimized())return;discountNinja.Logging.LogVerbose("Minimize notification");let t=jQuery("."+discountNinja_Script_Notification.GetClass());t&&jQuery(t).removeClass("maximized").addClass("minimized")}catch(t){discountNinja.Logging.LogError("Notification.Minimize",t)}},AppSettings:function(){try{return null===discountNinja.Settings.Settings?null:discountNinja.Settings.Settings.NotificationSettings}catch(t){discountNinja.Logging.LogError("Notification.AppSettings",t)}},DefaultOffer:function(){try{if(null===discountNinja.Offer.Offers||0===discountNinja.Offer.Offers.length)return null;if(discountNinja.Offer.PrimaryOffer&&discountNinja.Offer.PrimaryOffer.NotificationSettings&&discountNinja.Offer.PrimaryOffer.NotificationSettings.PlacementVertical)return discountNinja.Offer.PrimaryOffer;for(let t=0;t<discountNinja.Offer.Offers.length;t++){let i=discountNinja.Offer.Offers[t];if(i.NotificationSettings&&i.NotificationSettings.PlacementVertical)return i}return null}catch(t){discountNinja.Logging.LogError("Notification.DefaultOffer",t)}},Maximize:function(){try{if(!discountNinja_Script_Notification.IsMinimized())return;discountNinja.Logging.LogVerbose("Maximize notification");let t=jQuery("."+discountNinja_Script_Notification.GetClass());t&&(discountNinja_Script_Notification.ActAfterDelay(),jQuery(t).css("transition","unset"),jQuery(t).removeClass("minimized").addClass("maximized"),jQuery(t).css("transition","all 0.5s ease -in -out 0s"))}catch(t){discountNinja.Logging.LogError("Notification.Maximize",t)}},Clear:function(){discountNinja.Cache.SessionRemove("notificationinfo-data")},Remove:function(t){try{let i=discountNinja_Script_Notification.GetFromCache(),n=[];for(let e=0;e<i.length;e++)i[e].Token!==t&&n.push(i[e]);0===n.length&&discountNinja_Script_Notification.Hide(),discountNinja_Script_Notification.SaveToCache(n),discountNinja_Script_Notification.UpdateOfferCounter(n.length)}catch(t){discountNinja.Logging.LogError("Notification.Remove",t)}},GetOfferCounterElement:function(){try{return jQuery("."+discountNinja_Script_Notification.GetClass()).find(".limoniapps-offercount")}catch(t){discountNinja.Logging.LogError("Notification.UpdateOfferCounter",t)}},UpdateOfferCounter:function(t){try{let i=0;for(let n=0;n<t.length;n++){discountNinja.Offer.GetOfferByToken(t[n].Token)&&i++}discountNinja_Script_Notification.GetOfferCounterElement().text(i)}catch(t){discountNinja.Logging.LogError("Notification.UpdateOfferCounter",t)}},GetFromCache:function(){try{let t=discountNinja.Cache.SessionGet("notificationinfo-data");return null===(t="undefined"===t?[]:JSON.parse(t))?[]:t}catch(t){return discountNinja.Logging.LogError("Notification.GetFromCache",t),[]}},SaveToCache:function(t){try{discountNinja.Cache.SessionSet("notificationinfo-data",JSON.stringify(t))}catch(t){discountNinja.Logging.LogError("Notification.SaveToCache",t)}},Add:function(t){try{t||discountNinja.Logging.LogErrorMessage("Notification.Add","Expected token");let i=discountNinja_Script_Notification.GetFromCache();for(let n=0;n<i.length;n++)if(i[n]&&i[n].Token===t)return;i.push({Token:t,Animated:!1}),discountNinja_Script_Notification.SaveToCache(i),discountNinja_Script_Notification.UpdateOfferCounter(i)}catch(t){discountNinja.Logging.LogError("Notification.Add",t)}},ClearAnimation:function(t){try{let i=discountNinja_Script_Notification.AppSettings();t.removeClass(i.AnimationEnter),t.removeClass(i.AnimationOnReminder),t.removeClass(i.AnimationExit),t.removeClass("animated shake flash bounce rotateIn")}catch(t){discountNinja.Logging.LogError("Notification.ClearAnimation",t)}},ApplyAnimation:function(t,i,n){try{discountNinja_Script_Notification.ClearAnimation(t),t.addClass(i),n&&t.css("animation-iteration-count",n)}catch(t){discountNinja.Logging.LogError("Notification.ApplyAnimation",t)}},ActAfterDelay:function(){try{let t=discountNinja_Script_Notification.AppSettings();t.MinimizeButton&&t.Delay&&t.Delay>0&&(clearInterval(discountNinja_Script_Notification.DelayIntervalHandle),discountNinja_Script_Notification.DelayIntervalHandle=setTimeout(function(){try{discountNinja_Script_Notification.GetUserToggledMinMaximize()?discountNinja.Logging.LogVerbose("Not hiding/minimizing notification because it was toggled by the user"):"hide"===t.HideMode?discountNinja_Script_Notification.Hide(!0):"minimize"===t.HideMode&&discountNinja_Script_Notification.Minimize()}catch(t){discountNinja.Logging.LogError("Notification.ActAfterDelay",t)}},t.Delay))}catch(t){discountNinja.Logging.LogError("Notification.ActAfterDelay",t)}},HighlightNewOffers:function(t){try{setTimeout(function(){try{!function(t){try{setTimeout(function(){try{for(let i=0;i<t.length;i++){let n=jQuery("."+discountNinja_Script_Notification.GetClass()+' span[data-offer-token="'+t[i]+'"]');discountNinja_Script_Notification.ApplyAnimation(n,"animated shake",1)}}catch(t){discountNinja.Logging.LogError("Notification.AnimateNewPromotionNotifications",t)}},500),setTimeout(function(){try{for(let i=0;i<t.length;i++){let n=jQuery("."+discountNinja_Script_Notification.GetClass()+' span[data-offer-token="'+t[i]+'"]');discountNinja_Script_Notification.ApplyAnimation(n,"animated flash",3)}}catch(t){discountNinja.Logging.LogError("Notification.AnimateNewPromotionNotifications",t)}},1500)}catch(t){discountNinja.Logging.LogError("Notification.HighlightNewOffers.HighlightNewOffers",t)}}(t),function(){try{let i=discountNinja_Script_Notification.AppSettings();if(!i)return;i.OfferCounterAnimate&&t.length>0&&(discountNinja_Script_Notification.Maximize(),setTimeout(function(){try{discountNinja_Script_Notification.ApplyAnimation(discountNinja_Script_Notification.GetOfferCounterElement(),"animated bounce",2)}catch(t){discountNinja.Logging.LogError("Notification.HighlightNewOffers.AnimateCounter",t)}},500))}catch(t){discountNinja.Logging.LogError("Notification.HighlightNewOffers.AnimateCounter",t)}}()}catch(t){discountNinja.Logging.LogError("Notification.HighlightNewOffers",t)}},1500)}catch(t){discountNinja.Logging.LogError("Notification.HighlightNewOffers",t)}},Show:function(){function t(i,n){discountNinja_Script_Notification.AnimateOnReminderIntervalHandle=setTimeout(function(){try{!function(){let t=jQuery("."+discountNinja_Script_Notification.GetClass());discountNinja_Script_Notification.ApplyAnimation(t,i)}(),t(i,n)}catch(t){discountNinja.Logging.LogError("Notification.AnimateOnReminder",t)}},n)}try{if(discountNinja_Script_Notification.GetHiddenInSession())return;let i=discountNinja_Script_Notification.GetFromCache();if(!i||0===i.length)return;let n=null,e=i.length>1?"<ul>":"",o=[],r=[];for(let t=0;t<i.length;t++){n=i[t];let a=discountNinja.Offer.GetOfferByToken(n.Token);if(a){let t=discountNinja.DiscountTier.GetCurrentDiscountTier(a),c=discountNinja.DiscountTier.GetPercentageAmountFromDiscountTier(t),s='data-offer-token="'+n.Token+'"',u=discountNinja_Script_Notification.GetText(a.NotificationSettings.Body,a,c),d=!1;for(let t=0;t<r.length;t++)if(r[t]===u){d=!0;break}if(d)continue;r.push(e),e=i.length>1?e+"<li "+s+">"+u+"</li>":e+'<span style="display:block;" '+s+">"+u+"</span>",!1===n.Animated&&o.push(n.Token)}else discountNinja.Logging.LogVerbose("Cached notification refers to offer "+n.Token+", which is not available")}i.length>1&&(e+="</ul>"),function(){try{let t=discountNinja_Script_Notification.GetFromCache();for(let i=0;i<t.length;i++)t[i].Animated=!0;discountNinja_Script_Notification.SaveToCache(t)}catch(t){discountNinja.Logging.LogError("Notification.MarkNotificationsAsAnimated",t)}}(),!function(i,n,e){try{if(null===i||"<ul></ul>"===i)return;if(discountNinja.Logging.LogVerbose("Showing notification"),discountNinja_Script_Notification.GetDismissedInSession())return void discountNinja.Logging.LogVerbose("Notification was dismissed during the session, canceling show");if(jQuery("."+discountNinja_Script_Notification.GetClass()).length>0){jQuery(".limoniapps-notification .limoniapps-message-body .text-wrapper").html(n),discountNinja.Logging.LogVerbose("Notification already exists, updating message");let t=jQuery("."+discountNinja_Script_Notification.GetClass());return jQuery(t).find("[data-offer-token]").each(function(){let t=jQuery(this).attr("data-offer-token"),i=discountNinja.Offer.GetOfferByToken(t),n=discountNinja.DiscountTier.GetCurrentDiscountTier(i),e=discountNinja.DiscountTier.GetPercentageAmountFromDiscountTier(n);discountNinja.ShortCode.RefreshResolvedPlaceholders(this,i,e)}),discountNinja.Logging.LogVerbose("Notification already exists, ensuring it is visible"),discountNinja_Script_Notification.ClearAnimation(t),discountNinja_Script_Notification.Hiding=!1,jQuery(t).show(),void(discountNinja_Script_Notification.IsMinimized()||discountNinja_Script_Notification.Maximize())}discountNinja.Logging.LogVerbose("Notification does not exist, creating message"),LimoniAppsLoadJQueryNotify(function(){!function(i,n){try{let n=discountNinja_Script_Notification.DefaultOffer();if(!n)return;let e=discountNinja_Script_Notification.AppSettings(),o=n.NotificationSettings,r=discountNinja_Script_Notification.GetShownInSession(),a=i.trim().replace(/'/g,"&#39;");jQuery.notify({icon:"",title:"",message:""},{allow_dismiss:e.CloseButton||!1,type:"limoniapps-discountninja",placement:{from:o.PlacementVertical||"bottom",align:o.PlacementHorizontal||"top"},offset:{x:o.HorizontalOffset||0,y:o.VerticalOffset||0},delay:0,template:a,animate:{enter:r?"":e.AnimationEnter,exit:""},onClose:function(){discountNinja_Script_Notification.Hide(!0)},onClosed:function(){discountNinja_Script_Notification.SetDismissedInSession(!0)},z_index:99999}),n&&jQuery(".limoniapps-notification").attr("data-token",n.Token);let c=jQuery("."+discountNinja_Script_Notification.GetClass());jQuery(c).click(function(){discountNinja_Script_Notification.SetUserToggledMinMaximize(!0),discountNinja_Script_Notification.ToggleMinMaximize()}),r&&e.MinimizeAfterFirstView&&discountNinja_Script_Notification.Minimize(),discountNinja_Script_Notification.ActAfterDelay(),discountNinja.Settings.Settings.GeneralSettings.ShowPoweredBy?jQuery(".limoniapps-poweredby").removeClass("limoniapps-poweredby-hidden"):jQuery(".limoniapps-poweredby").addClass("limoniapps-poweredby-hidden"),discountNinja_Script_Notification.SetShownInSession(!0),e.AnimationOnReminder&&(clearInterval(discountNinja_Script_Notification.AnimateOnReminderIntervalHandle),t(e.AnimationOnReminder,e.ReminderDuration))}catch(t){return discountNinja.Logging.LogError("Notification.ShowInternalAfterEnsuringDependencies",t),!1}}(i)})}catch(t){return discountNinja.Logging.LogError("Notification.ShowInternal",t),!1}}(discountNinja_Script_Notification.GetHtml(e),e),discountNinja_Script_Notification.UpdateOfferCounter(i)}catch(t){discountNinja.Logging.LogError("Notification.Show",t)}},GetUserToggledMinMaximize:function(){let t=discountNinja.Cache.SessionGet("notification-usertoggled");return"true"===t||!0===t},SetUserToggledMinMaximize:function(t){discountNinja.Cache.SessionSet("notification-usertoggled",t)},IsMinimized:function(){return jQuery(".limoniapps-notification.active").hasClass("minimized")},GetShownInSession:function(){let t=discountNinja.Cache.SessionGet("notification-displayed-insession");return"true"===t||!0===t},SetShownInSession:function(t){discountNinja.Cache.SessionSet("notification-displayed-insession",t)},GetDismissedInSession:function(){let t=discountNinja.Cache.SessionGet("notification-dismissed-insession");return"true"===t||!0===t},SetDismissedInSession:function(t){discountNinja.Cache.SessionSet("notification-dismissed",t)},GetHiddenInSession:function(){let t=discountNinja.Cache.SessionGet("notification-hidden-insession");return"true"===t||!0===t},SetHiddenInSession:function(t){discountNinja.Cache.SessionSet("notification-hidden-insession",t)}},discountNinja_Script_PopUp={GetElement:function(t){return jQuery(".limoniapps-popup[data-token='"+t+"']")},Hide:function(t){try{discountNinja_Script_PopUp.GetElement(t).hide()}catch(t){discountNinja.Logging.LogError("PopUp.Hide",t)}},InjectHtml:function(t,i){try{if(discountNinja_Script_PopUp.GetElement(t.Token).length>0)return void discountNinja.ShortCode.RefreshResolvedPlaceholders(discountNinja_Script_PopUp.GetElement(t.Token),t,i);let n=discountNinja.Utilities.IsMobilePhone()?t.PopUpSettings.MobileSize:t.PopUpSettings.Size,e=jQuery("#limoniapps-discountninja-popup-template").html();e=discountNinja.TemplateParameter.Replace(e,"HEADER",discountNinja.TextSettings.GetText(t.PopUpSettings.Header,t)),e=discountNinja.TemplateParameter.Replace(e,"BODY",discountNinja.TextSettings.GetText(t.PopUpSettings.Body,t)),e=discountNinja.TemplateParameter.Replace(e,"FOOTER",discountNinja.TextSettings.GetText(t.PopUpSettings.Footer,t)),e=discountNinja.TemplateParameter.Replace(e,"NOTHANKSBUTTONLABEL",t.PopUpSettings.NoThanksButtonLabel),e=discountNinja.TemplateParameter.Replace(e,"SIZE",n),e=discountNinja.TemplateParameter.Replace(e,"ACTIONBUTTON1LABEL",t.PopUpSettings.ActionButton1Label),e=discountNinja.TemplateParameter.Replace(e,"ACTIONBUTTON1STYLE",t.PopUpSettings.ActionButton1Style),e=discountNinja.TemplateParameter.Replace(e,"ACTIONBUTTON1SIZE",t.PopUpSettings.ActionButton1Size),e=discountNinja.TemplateParameter.Replace(e,"ACTIONBUTTON2LABEL",t.PopUpSettings.ActionButton2Label),e=discountNinja.TemplateParameter.Replace(e,"ACTIONBUTTON2STYLE",t.PopUpSettings.ActionButton2Style),e=discountNinja.TemplateParameter.Replace(e,"ACTIONBUTTON2SIZE",t.PopUpSettings.ActionButton2Size),e=discountNinja.TemplateParameter.Replace(e,"BUTTONPLACEMENT","fullscreen"===n?"inside":t.PopUpSettings.ButtonPlacement),e=discountNinja.TemplateParameter.Replace(e,"BACKGROUNDOVERLAY",t.PopUpSettings.BackgroundOverlay),e=discountNinja.TemplateParameter.Replace(e,"SHAPE",t.PopUpSettings.Shape),e=discountNinja.TemplateParameter.Replace(e,"CONTENTALIGNMENTHORIZONTAL",t.PopUpSettings.ContentAlignmentHorizontal),e=discountNinja.TemplateParameter.Replace(e,"CONTENTALIGNMENTVERTICAL",t.PopUpSettings.ContentAlignmentVertical),e=discountNinja.TemplateParameter.Replace(e,"BACKGROUNDTOPCOLORHEIGHT",t.PopUpSettings.ContentAlignmentVertical),e=discountNinja.TemplateParameter.Replace(e,"BACKGROUNDTOPCOLORRADIUS",t.PopUpSettings.BackgroundColorTopHeight),e=discountNinja.TemplateParameter.Replace(e,"BACKGROUNDTOPCOLORRADIUS",t.PopUpSettings.BackgroundColorTopRadius),e=discountNinja.TemplateParameter.Replace(e,"TOKEN",t.Token);let o=function(t){let i=document.createDocumentFragment(),n=document.createElement("div");for(n.innerHTML=t;n.firstChild;)i.appendChild(n.firstChild);return i}(e=discountNinja.ShortCode.ReplaceAllPlaceHolders(t,e,i));document.body.insertBefore(o,document.body.childNodes[0])}catch(t){discountNinja.Logging.LogError("PopUp.InjectPopUpHtml",t)}},Show:function(t,i){function n(t,i){try{discountNinja.Offer.SetPromotionAccepted(t.Token,t.Frequency,"false"),discountNinja_Script_PopUp.Hide(t.Token),discountNinja.Offer.Stop()}catch(t){discountNinja.Logging.LogError("PopUp.Cancel",t)}}function e(t,i){discountNinja.Cache.LocalSet("popup-displayed-"+t,i)}try{discountNinja_Script_PopUp.InjectHtml(t,i);let c=t.Token;discountNinja.Logging.ShowTimeElapsed("Show pop-up"),discountNinja.Logging.LogVerbose("Showing pop-up"),discountNinja.DiscountCode.Remove(c),discountNinja.Offer.RemoveFromCache(t);let s=discountNinja_Script_PopUp.GetElement(c);s.find('.limoniapps-close[data-notify="dismiss"]').click(function(){n(t)}),s.find(".limoniapps-lnk-dismiss").click(function(){n(t)}),s.find('.limoniapps-action-btn[data-action="apply"]').click(function(){!function(t,i){try{discountNinja_Script_PopUp.Hide(t.Token),discountNinja.PromotionFlow.AcceptPromotion(t,i),discountNinja.PromotionFlow.DisplayAppliedOffers()}catch(t){discountNinja.Logging.LogError("PopUp.Accept",t)}}(t,i)}),discountNinja.Settings.Settings.GeneralSettings.ShowPoweredBy?jQuery(".limoniapps-poweredby").removeClass("limoniapps-poweredby-hidden"):jQuery(".limoniapps-poweredby").addClass("limoniapps-poweredby-hidden"),o=s.find(".limoniapps-content"),r=t.PopUpSettings.Animation,a=t.PopUpSettings,jQuery(o).removeClass(a.Animation),jQuery(o).addClass(r),s.show(),function(t){var i,n;"onceperdevice"===t.PopUpSettings.Frequency?e(t.Token,"shown"):(e(t.Token,""),i=t.Token,n="shown",discountNinja.Cache.SessionSet("popup-displayed-"+i,n))}(t),discountNinja_Script_PopUp.PopUpDisplayed=!0}catch(t){discountNinja.Logging.LogError("PopUp.Show",t)}var o,r,a}},discountNinja_Script_StickyBar={AnimateOnReminderIntervalHandle:-1,CycleIntervalHandle:-1,CurrentLevelForPromotion:[],WrapperId:"limoniapps-discountninja-stickybar-wrapper",GetWrapperElement:function(){return jQuery("#"+discountNinja_Script_StickyBar.WrapperId)},AppSettings:function(){try{return null===discountNinja.Settings.Settings?null:discountNinja.Settings.Settings.StickyBarSettings}catch(t){discountNinja.Logging.LogError("StickyBar.AppSettings",t)}},DefaultOffer:function(){try{if(null===discountNinja.Offer.Offers||0===discountNinja.Offer.Offers.length)return null;if(discountNinja.Offer.PrimaryOffer&&discountNinja.Offer.PrimaryOffer.StickyBarSettings&&discountNinja.Offer.PrimaryOffer.StickyBarSettings.PlacementVertical)return discountNinja.Offer.PrimaryOffer;for(let t=0;t<discountNinja.Offer.Offers.length;t++){let i=discountNinja.Offer.Offers[t];if(i.StickyBarSettings&&i.StickyBarSettings.PlacementVertical)return i}return null}catch(t){discountNinja.Logging.LogError("StickyBar.DefaultOffer",t)}},ShouldRequestNotification:function(){try{return!!pushowl&&!pushowl.browserHandler.isPermissionGranted}catch(t){return discountNinja.Logging.LogError("StickyBar.ShouldRequestNotification",t),!1}},RequestNotification:function(){try{if(!pushowl)return!1;pushowl.subscribeIfNotAlready()}catch(t){discountNinja.Logging.LogError("StickyBar.RequestNotification",t)}},SlideBodyDownLastExecuted:null,SlideBodyDown:function(){try{if(!function(){let t=discountNinja_Script_StickyBar.SlideBodyDownLastExecuted,i=!0;return null!==t&&new Date-t<50&&(i=!1),discountNinja_Script_StickyBar.SlideBodyDownLastExecuted=new Date,i}())return;let t=discountNinja_Script_StickyBar.DefaultOffer(),i=t?t.StickyBarSettings:null;if(null===i)return;if("top_page_sticky"===i.PlacementVertical){discountNinja.Logging.LogVerbose("Applying margin to sticky bar since it is positioned on the top");let t=discountNinja_Script_StickyBar.GetWrapperElement().outerHeight();jQuery("#limoniapps-discountninja-stickybar-pusher").height(t),discountNinja_Script_StickyBar.AddTopMarginToElements(t)}else discountNinja.Logging.LogVerbose("No margin applied to sticky bar since it is positioned on the bottom")}catch(t){discountNinja.Logging.LogError("StickyBar.SlideBodyDown",t)}},TopMarginDesktopElements:function(){try{let t=[];return t.push(".limoniapps-discountninja-topmargin-desktop"),t}catch(t){return discountNinja.Logging.LogError("StickyBar.TopMarginDesktopElements",t),[]}},TopMarginMobileElements:function(){try{let t=[];return t.push(".limoniapps-discountninja-topmargin-mobile"),t}catch(t){return discountNinja.Logging.LogError("StickyBar.TopMarginMobileElements",t),[]}},TopMarginIncludeClasses:function(){try{let t=[];return t.push("limoniapps-discountninja-topmargin"),t.push("limoniapps-discountninja-header"),t.push("limoniapps-discounturl-header"),t}catch(t){return discountNinja.Logging.LogError("StickyBar.TopMarginIncludeClasses",t),[]}},TopMarginElements:function(){try{let i=[];var t=discountNinjaContext.Flags.StickyBarShouldPushSelectors;return t&&""!==t&&i.push(t),i.push(".limoniapps-discountninja-topmargin, .limoniapps-discountninja-header, .limoniapps-discounturl-header"),i}catch(t){return discountNinja.Logging.LogError("StickyBar.TopMarginElements",t),[]}},TopMarginExcludeClasses:function(){try{let t=[];return t.push("limoniapps-discountninja-topmargin-ignore"),t.push("limoniapps-discountninja-header-ignore"),t}catch(t){return discountNinja.Logging.LogError("StickyBar.TopMarginExcludeElements",t),[]}},AddTopMarginToElements:function(t){function i(t,i){try{discountNinja.Logging.LogVerbose("Applying top margin "+i+"px to element "+discountNinja.Utilities.GetElementId(t)),discountNinja.Utilities.AppendToStyle(t,"margin-top",i.toString()+"px !important"),discountNinja.Utilities.AppendToStyle(t,"background-position","0% "+i.toString()+"px !important")}catch(t){discountNinja.Logging.LogError("StickyBar.ApplyTopMarginToElementStyle",t)}}function n(t,n){try{if(0===jQuery(t).length)return;let e=discountNinja_Script_StickyBar.TopMarginExcludeClasses(),o=!1;for(let i=0;i<e.length;i++)if(jQuery(t).hasClass(e[i])){o=!0;break}let r=discountNinja_Script_StickyBar.TopMarginIncludeClasses(),a=!1;for(let i=0;i<r.length;i++)if(jQuery(t).hasClass(r[i])){a=!0;break}if(void 0!==jQuery(t).attr("data-original-body-margin-top")){discountNinja.Logging.LogVerbose("Updating top margin of "+n+"px to element "+discountNinja.Utilities.GetElementId(t)),i(t,parseInt(jQuery(t).attr("data-original-body-margin-top"))+n)}else{discountNinja.Logging.LogVerbose("Adding top margin "+n+"px to element "+discountNinja.Utilities.GetElementId(t));let e=parseInt(jQuery(t).css("margin-top")),o=jQuery(t).css("background-position");i(t,e+n),jQuery(t).attr("data-original-body-margin-top",e),jQuery(t).attr("data-original-body-background-position",o)}}catch(t){discountNinja.Logging.LogError("StickyBar.ShowTopMarginToElement",t)}}try{let i=discountNinja_Script_StickyBar.TopMarginElements();i=discountNinja.Utilities.IsMobilePhone()?i.concat(discountNinja_Script_StickyBar.TopMarginMobileElements()):i.concat(discountNinja_Script_StickyBar.TopMarginDesktopElements());for(let e=0;e<i.length;e++)jQuery(i[e]).each(function(){n(i[e],t)})}catch(t){discountNinja.Logging.LogError("StickyBar.AddTopMarginToElements",t)}},RemoveTopMarginFromElements:function(){function t(t){try{if(0===jQuery(t).length)return;try{discountNinja.Logging.LogVerbose("Removing top margin from element "+("body"===t?"body":jQuery(t).attr("id")))}catch(t){}let i=parseInt(jQuery(t).attr("data-original-body-margin-top")),n=jQuery(t).attr("data-original-body-background-position");jQuery(t).css("margin-top",i.toString()+"px"),jQuery(t).css("background-position",n)}catch(t){discountNinja.Logging.LogError("StickyBar.HideTopMarginFromElement",t)}}try{jQuery("#limoniapps-discountninja-stickybar-pusher").height(0);let i=discountNinja_Script_StickyBar.TopMarginElements();for(let n=0;n<i.length;n++)jQuery(i[n]).each(function(){t(i[n])})}catch(t){discountNinja.Logging.LogError("StickyBar.RemoveTopMarginFromElements",t)}},OnAction:function(t,i,n){try{let e=1===t?i.StickyBarSettings.ActionButton1:i.StickyBarSettings.ActionButton2;discountNinja.ActionButton.HandleAction(e,i,n)}catch(t){discountNinja.Logging.LogError("StickyBar.OnAction",t)}},Hide:function(t){function i(t){try{discountNinja_Script_StickyBar.GetWrapperElement().hide();let i=discountNinja_Script_StickyBar.DefaultOffer(),n=i?i.StickyBarSettings:null;n&&"top_page_sticky"===n.PlacementVertical&&discountNinja_Script_StickyBar.RemoveTopMarginFromElements(),t&&discountNinja_Script_StickyBar.SetHiddenInSession(!0),discountNinja.Logging.LogVerbose("Sticky bar hidden")}catch(t){discountNinja.Logging.LogError("StickyBar.HideInner",t)}}try{discountNinja.Logging.LogVerbose("Hiding sticky bar");let n=discountNinja_Script_StickyBar.AppSettings();n.AnimationExit?(discountNinja_Script_StickyBar.ApplyAnimation(discountNinja_Script_StickyBar.GetWrapperElement(),n.AnimationExit),i(t)):i(t)}catch(t){discountNinja.Logging.LogError("StickyBar.Hide",t)}},Remove:function(t){try{discountNinja.Logging.LogInformation("StickyBar.Remove for token "+t);let i=discountNinja_Script_StickyBar.GetFromCache(),n=[];for(let e=0;e<i.length;e++)i[e].Token!==t&&n.push(i[e]);discountNinja_Script_StickyBar.MessageCount=n.length,discountNinja_Script_StickyBar.SaveToCache(n),setTimeout(function(){try{discountNinja_Script_StickyBar.Show()}catch(t){discountNinja.Logging.LogError("StickyBar.Remove",t)}},500)}catch(t){discountNinja.Logging.LogError("StickyBar.Remove",t)}},Clear:function(){discountNinja.Logging.LogInformation("StickyBar.Clear called "),discountNinja_Script_StickyBar.MessageCount=0,discountNinja.Cache.SessionRemove("stickybar-data")},GetFromCache:function(){try{let t=discountNinja.Cache.SessionGet("stickybar-data");return null===(t="undefined"===t?[]:JSON.parse(t))?[]:t}catch(t){return discountNinja.Logging.LogError("StickyBar.GetFromCache",t),[]}},SaveToCache:function(t){try{discountNinja.Cache.SessionSet("stickybar-data",JSON.stringify(t))}catch(t){discountNinja.Logging.LogError("StickyBar.SaveToCache",t)}},Add:function(t){try{discountNinja.Logging.LogInformation("StickyBar.Add for token "+t),t||discountNinja.Logging.LogErrorMessage("StickyBar.Add","Expected token");let i=discountNinja_Script_StickyBar.GetFromCache();for(let n=0;n<i.length;n++)if(i[n]&&i[n].Token===t)return;i.push({Token:t}),discountNinja_Script_StickyBar.MessageCount=discountNinja_Script_StickyBar.MessageCount+1,discountNinja_Script_StickyBar.SaveToCache(i)}catch(t){discountNinja.Logging.LogError("StickyBar.Add",t)}},CurrentMessageIndex:0,MessageCount:0,CycleMessage:function(t){try{discountNinja.Logging.LogVerbose("StickyBar.CycleMessage"),discountNinja_Script_StickyBar.ShowMessage(t);let i=discountNinja_Script_StickyBar.AppSettings();if(discountNinja_Script_StickyBar.MessageCount<=1)return;discountNinja_Script_StickyBar.CycleIntervalHandle=setTimeout(function(){!function(){try{discountNinja_Script_StickyBar.CurrentMessageIndex=discountNinja_Script_StickyBar.CurrentMessageIndex+1,discountNinja_Script_StickyBar.CycleMessage(!0)}catch(t){discountNinja.Logging.LogError("StickyBar.CycleMessage.CycleMessageInner",t)}}()},i.CycleSettings.DurationMilliseconds)}catch(t){discountNinja.Logging.LogError("StickyBar.CycleMessage",t)}},ApplyAnimation:function(t,i){if(!i)return;let n=discountNinja_Script_StickyBar.AppSettings();jQuery(t).removeClass(n.AnimationEnter),jQuery(t).removeClass(n.AnimationOnGoal),jQuery(t).removeClass(n.AnimationOnReminder),jQuery(t).removeClass(n.AnimationExit),jQuery(t).removeClass(n.CycleSettings.AnimationOnCyle),jQuery(t).addClass(i)},ShowMessage:function(t){function i(t,i){try{return discountNinja.Timer.IsTimerStarted()?discountNinja.TextSettings.WrapInColor(t.StickyBarSettings.TimerFooterTextColor,discountNinja.ShortCode.ReplaceAllPlaceHolders(t,discountNinja.TextSettings.GetText(t.StickyBarSettings.TimerFooter,t),i)):""}catch(t){return discountNinja.Logging.LogError("StickyBar.GetTimerFooterMessage",t),""}}function n(t){if(t.StickyBarSettings.AnimationOnGoal){let i=!1,n=discountNinja.DiscountTier.GetCurrentDiscountTier(t),e=discountNinja_Script_StickyBar.CurrentLevelForPromotion[t.Token];(i=void 0!==e?e<n:n>0)&&(discountNinja_Script_StickyBar.CurrentLevelForPromotion[t.Token]=n,function(t){let i=jQuery(".limoniapps-sticky-bar .limoniapps-content");discountNinja_Script_StickyBar.ApplyAnimation(i,t)}(discountNinja_Script_StickyBar.AppSettings.AnimationOnGoal))}}function e(t,n){discountNinja.Logging.LogVerbose("StickyBar.ShowMessage - Change messages");let e=discountNinja_Script_StickyBar.GetWrapperElement(),o=jQuery(e).find(".limoniapps-message.limoniapps-message-body"),r=jQuery(e).find(".limoniapps-message.limoniapps-message-timerfooter"),a=function(t,i){try{return discountNinja.TextSettings.WrapInColor(t.StickyBarSettings.BodyTextColor,discountNinja.ShortCode.ReplaceAllPlaceHolders(t,discountNinja.TextSettings.GetText(t.StickyBarSettings.Body,t),i))}catch(t){return discountNinja.Logging.LogError("StickyBar.GetBodyMessage",t),""}}(t,n),c=i(t,n);jQuery(o).html(a,n),jQuery(r).html(c)}try{discountNinja_Script_StickyBar.CurrentMessageIndex>=discountNinja_Script_StickyBar.MessageCount&&(discountNinja_Script_StickyBar.CurrentMessageIndex=0);let o=discountNinja_Script_StickyBar.CurrentMessageIndex;discountNinja.Logging.LogVerbose("StickyBar.ShowMessage - Index: "+o);let r=discountNinja_Script_StickyBar.GetFromCache()[o];if(!r)return void discountNinja.Logging.LogErrorMessage("StickyBar.ShowMessage","Sticky bar "+o+" not found");let a=discountNinja.Offer.GetOfferByToken(r.Token);if(!a)return void discountNinja.Logging.LogVerbose("Stickybar refers to offer "+r.Token+", which is not available");let c=discountNinja.DiscountTier.GetCurrentDiscountTier(a),s=discountNinja.DiscountTier.GetPercentageAmountFromDiscountTier(c),u=a.StickyBarSettings;discountNinja.Logging.LogVerbose("StickyBar.ShowMessage - Token: "+a.Token);let d=discountNinja_Script_StickyBar.AppSettings(),l=discountNinja_Script_StickyBar.GetWrapperElement(),g=jQuery(l).find(".limoniapps-col-info");jQuery(l).find(".limoniapps-sticky-bar-wrapper").attr("data-token",a.Token),u.ActionButton1&&(discountNinja.ActionButton.HideIfNecessary(u.ActionButton1,a,1),l.find(".limoniapps-action.button1 .limoniapps-action-btn").click(function(){try{discountNinja_Script_StickyBar.OnAction(1,a,s)}catch(t){return discountNinja.Logging.LogError("StickyBar.Show.ActionButton1Click",t),!1}})),u.ActionButton2&&(discountNinja.ActionButton.HideIfNecessary(u.ActionButton2,a,2),l.find(".limoniapps-action.button2 .limoniapps-action-btn").click(function(){try{discountNinja_Script_StickyBar.OnAction(2,a,s)}catch(t){return discountNinja.Logging.LogError("StickyBar.Show.ActionButton2Click",t),!1}}));let p=d.CycleSettings.AnimationOnCyle;if(t&&p&&discountNinja_Script_StickyBar.MessageCount>0){let t=function(t){let i=t.split(" ");return 3===i.length?i[0]+" "+i[2]:i[0]+" "+i[1]}(p),o=function(t){let i=t.split(" ");return i[0]+" "+i[1]}(p);o!==t?(discountNinja_Script_StickyBar.ApplyAnimation(g,o),setTimeout(function(){try{timerFooterMessage=i(a),e(a,s),jQuery(g).hide(),setTimeout(function(){try{jQuery(g).show(),discountNinja_Script_StickyBar.ApplyAnimation(g,t)}catch(t){discountNinja.Logging.LogError("StickyBar.Show",t)}},50),n(a)}catch(t){discountNinja.Logging.LogError("StickyBar.Show",t)}},500)):(e(a,s),discountNinja_Script_StickyBar.ApplyAnimation(g,t))}else e(a,s);return setTimeout(function(){discountNinja_Script_StickyBar.SlideBodyDown()},50),n(a),!0}catch(t){return discountNinja.Logging.LogError("StickyBar.ShowMessage",t),!1}},Show:function(){try{if(discountNinja_Script_StickyBar.GetHiddenInSession())return;if(discountNinja_Script_StickyBar.MessageCount<=0)return void discountNinja_Script_StickyBar.Hide();let i=discountNinja_Script_StickyBar.DefaultOffer();if(!i)return;let n=i.StickyBarSettings,e=discountNinja_Script_StickyBar.AppSettings(),o=discountNinja_Script_StickyBar.GetWrapperElement(),r=jQuery(o).is(":visible"),a="true"===discountNinja.Cache.SessionGet("stickybar-displayed-insession");if(!r){let e="limoniapps-stick-to-"+n.PlacementVertical;t=!0,discountNinja.Cache.SessionSet("stickybar-displayed-insession",t);let r=function(t){try{let i=t.StickyBarSettings,n=jQuery("#limoniapps-discountninja-stickybar-template").html(),e=discountNinja.DiscountTier.GetCurrentDiscountTier(t),o=discountNinja.DiscountTier.GetPercentageAmountFromDiscountTier(e),r=discountNinja.TextSettings.WrapInColor(i.BodyTextColor,discountNinja_Script_Notification.GetText(i.Body,t,o)),a=discountNinja.TextSettings.WrapInColor(i.TimerFooterTextColor,discountNinja.Timer.IsTimerStarted()?discountNinja_Script_Notification.GetText(i.TimerFooter,t,o):"");return n=discountNinja.TemplateParameter.Replace(n,"BODY",r),n=discountNinja.TemplateParameter.Replace(n,"TIMERFOOTER",a),n=discountNinja.TemplateParameter.Replace(n,"HEIGHT",discountNinja.Utilities.IsMobilePhone()?i.MobileHeight:i.Height),n=discountNinja.TemplateParameter.Replace(n,"CLOSEABLE",i.CloseButton?"closeable":""),n=discountNinja.TemplateParameter.Replace(n,"HASACTION1",i.ActionButton1?"hasaction1":""),n=discountNinja.TemplateParameter.Replace(n,"HASACTION2",i.ActionButton2?"hasaction2":""),n=discountNinja.TemplateParameter.Replace(n,"HASIMAGE",i.HasImage?"hasimage":""),n=discountNinja.TemplateParameter.Replace(n,"TOKEN",t.Token),n=discountNinja.TemplateParameter.Replace(n,"WIDTH",i.Width?i.Width:""),n=discountNinja.ActionButton.ReplacePlaceHoldersForButton(n,t,o,1,i.ActionButton1),n=discountNinja.ActionButton.ReplacePlaceHoldersForButton(n,t,o,2,i.ActionButton2)}catch(t){return discountNinja.Logging.LogError("StickyBar.GetHtml",t),""}}(i),a=(0===jQuery("#limoniapps-discountninja-stickybar-pusher").length?'<div id="limoniapps-discountninja-stickybar-pusher" class="limoniapps-stickybar-pusher"></div>':"")+'<div id="'+discountNinja_Script_StickyBar.WrapperId+'" class="'+e+'" style="display:none;">'+r+"</div>";"top_header"===n.PlacementVertical?jQuery("#shopify-section-header").append(a):jQuery("body").prepend(a),o=discountNinja_Script_StickyBar.GetWrapperElement(),n.CloseButton&&o.find('.limoniapps-close[data-notify="dismiss"]').click(function(){try{discountNinja_Script_StickyBar.Hide(!0)}catch(t){return discountNinja.Logging.LogError("StickyBar.Show.Dismiss",t),!1}}),"hide"===n.HideMode&&n.Delay&&n.Delay>0&&setTimeout(function(){discountNinja_Script_StickyBar.Hide(!0)},n.Delay),discountNinja.Settings.Settings.GeneralSettings.ShowPoweredBy?jQuery(".limoniapps-poweredby").removeClass("limoniapps-poweredby-hidden"):jQuery(".limoniapps-poweredby").addClass("limoniapps-poweredby-hidden")}"cycle"===e.CycleSettings.Mode&&discountNinja_Script_StickyBar.MessageCount>1?(clearInterval(discountNinja_Script_StickyBar.CycleIntervalHandle),discountNinja_Script_StickyBar.CycleMessage(!1)):(discountNinja_Script_StickyBar.CurrentMessageIndex=0,discountNinja_Script_StickyBar.ShowMessage(!1)),e.AnimationOnReminder&&(clearInterval(discountNinja_Script_StickyBar.AnimateOnReminderIntervalHandle),function t(i,n){setTimeout(function(){try{discountNinja_Script_StickyBar.ApplyAnimation(jQuery(".limoniapps-sticky-bar .limoniapps-col-info"),i),t(i,n)}catch(t){discountNinja.Logging.LogError("StickyBar.AnimateOnReminder",t)}},n)}(e.AnimationOnReminder,e.ReminderDuration)),jQuery(window).on("resize",function(){discountNinja_Script_StickyBar.SlideBodyDown()});let c=r||a||!e.AnimationEnter?"":e.AnimationEnter;""!==c&&discountNinja_Script_StickyBar.ApplyAnimation("#"+discountNinja_Script_StickyBar.WrapperId,c),o.show()}catch(t){return discountNinja.Logging.LogError("StickyBar.Show",t),!1}var t},GetHiddenInSession:function(){let t=discountNinja.Cache.SessionGet("stickybar-hidden-insession");return"true"===t||!0===t},SetHiddenInSession:function(t){discountNinja.Cache.SessionSet("stickybar-hidden-insession",t)}},discountNinja_Script_Timer={TimeZone:null,TimerIntervalId:null,Start:function(t){function i(t,i){try{return discountNinja_Script_Timer.TimerLabels[t][i]}catch(t){return discountNinja.Logging.LogError("Timer.GetTimeLabel",t),""}}function n(t,i,n,e,o,r,a,c,s,u,d){function l(t){return t<10?"0"+t:t}try{let g="",p=!1;t>0&&(g=g+t+a,p=!0),i>0&&(d&&p&&(i=l(i)),g=""!==g?g+o+i+c:g+i+c,p=!0),n>0&&(d&&p&&(n=l(n)),g=""!==g?g+o+n+s:g+n+s,p=!0),e>0&&(d&&p&&(e=l(e)),g=""!==g?g+o+e+u:g+e+u);let f=g.lastIndexOf(o);return g=g.slice(0,f)+g.slice(f).replace(o,r)}catch(t){return discountNinja.Logging.LogError("Timer.TimeFormattingAsDuration",t),""}}function e(t,e,o){try{let r=e.asSeconds(),a=function(t,i){try{return 1===i?t.CountdownClockSettings.FormattingTemplateIn_Style1:2===i?t.CountdownClockSettings.FormattingTemplateIn_Style2:3===i?t.CountdownClockSettings.FormattingTemplateIn_Style3:4===i?t.CountdownClockSettings.FormattingTemplateIn_Style4:5===i?t.CountdownClockSettings.FormattingTemplateIn_Style5:t.CountdownClockSettings.FormattingTemplateIn_Style1}catch(t){return discountNinja.Logging.LogError("Timer.GetFormattingForStyle",t),""}}(t,o),c=function(t){try{let i=t.match(/\{.*?\}/);return null!==i&&i.length>0?i[0]:null}catch(t){return discountNinja.Logging.LogError("Timer.GetJSONFromTimeString",t),null}}(moment.duration(e,"seconds").format('s [{"Days":]d[,"Hours":]h[,"Minutes":]m[,"Seconds":]s[}]')),s=JSON.parse(c);return"in_seconds"===a?moment.duration(r,"seconds").format("s ["+i(3,0)+"]"):"in_minutes"===a?moment.duration(r,"seconds").format("m ["+i(2,0)+"]"):"in_hours_minutes_and_seconds"===a?moment.duration(r,"seconds").format("h ["+i(1,0)+"][,] m ["+i(2,0)+"] ["+i(4,0)+"] s ["+i(3,0)+"]"):"in_hours_minutes_and_seconds_short"===a?moment.duration(r,"seconds").format("h ["+i(1,1)+"][,] m ["+i(2,1)+"] ["+i(4,0)+"] s ["+i(3,1)+"]"):"in_minutes_and_seconds"===a?moment.duration(r,"seconds").format("m ["+i(2,0)+"] ["+i(4,0)+"] s ["+i(3,0)+"]"):"in_minutes_and_seconds_short"===a?moment.duration(r,"seconds").format("m ["+i(2,1)+"] ["+i(4,0)+"] s ["+i(3,1)+"]"):"in_hours"===a?moment.duration(r,"seconds").format("h ["+i(1,0)+"]"):"in_days"===a?moment.duration(r,"seconds").format("d ["+i(0,0)+"]"):"in_duration"===a?moment.duration(e,"days").format("d ["+i(0,0)+"] h ["+i(1,0)+"] m ["+i(2,0)+"] s ["+i(3,0)+"]"):"in_duration_short"===a?moment.duration(e,"days").format("d ["+i(0,1)+"] h ["+i(1,1)+"] m ["+i(2,1)+"] s ["+i(3,1)+"]"):"in_durationcommaand"===a?n(s.Days,s.Hours,s.Minutes,s.Seconds,", "," "+i(4,0)+" "," "+i(0,0)," "+i(1,0)," "+i(2,0)," "+i(3,0)):"in_durationcommaand_short"===a?n(s.Days,s.Hours,s.Minutes,s.Seconds,", "," "+i(4,0)+" "," "+i(0,1)," "+i(1,1)," "+i(2,1)," "+i(3,1)):"in_durationwithcolon"===a?n(s.Days,s.Hours,s.Minutes,s.Seconds,":",":"," "+i(0,2)," "+i(1,2)," "+i(2,2)," "+i(3,2)):"in_durationwithspace"===a?n(s.Days,s.Hours,s.Minutes,s.Seconds," "," "," "+i(0,2)," "+i(1,2)," "+i(2,2)," "+i(3,2)):"in_durationwithcomma"===a?n(s.Days,s.Hours,s.Minutes,s.Seconds,", ",", "," "+i(0,2)," "+i(1,2)," "+i(2,2)," "+i(3,2)):"in_durationwithcolon_short"===a?n(s.Days,s.Hours,s.Minutes,s.Seconds,":",":","","","","",!0):""}catch(t){return discountNinja.Logging.LogError("Timer.TimeFormattingInternal",t),LimoniAppsLoadMomentFormat(),""}}function o(t){let i=moment(t);return moment.duration(i.diff(moment().utc()))}function r(t,i){try{let n=o(i);if(n.asSeconds()>1){if("function"!=typeof moment||"function"!=typeof moment.duration||"object"!=typeof moment.duration(10,"seconds"))return discountNinja.Logging.LogVerbose("Timer dependencies not ready, skipping update"),void LimoniAppsLoadMoment(LimoniAppsLoadMomentFormat(function(){discountNinja.Logging.LogVerbose("Loading timer dependencies")}));jQuery(".limoniapps-discountninja-timer").each(function(){let i=jQuery(this).attr("data-style"),o=e(t,n,i);o=o.replace(/(\d)/g,'<div class="limoniapps-discountninja-countdownclock-digit-wrapper"><div class="limoniapps-discountninja-countdownclock-digit">$1</div></div>'),jQuery(this).html('<div class="limoniapps-discountninja-countdownclock-container style'+i+'">'+o+"</div>")})}else!function(){try{discountNinja.Logging.LogVerbose("Expiring timer"),discountNinja_Script_Timer.IsTimerStarted()?(discountNinja_Script_Timer.SetTimerStarted(!1),null!==discountNinja_Script_Timer.TimerIntervalId&&0!==discountNinja_Script_Timer.TimerIntervalId&&clearInterval(discountNinja_Script_Timer.TimerIntervalId),discountNinja.Logging.LogVerbose("Timer stopped, restarting flow"),discountNinja.PromotionFlow.StartFlow()):discountNinja.Logging.LogVerbose("Timer was not started")}catch(t){discountNinja.Logging.LogError("Timer.Expire",t)}}()}catch(t){discountNinja.Logging.LogError("Timer.UpdateTimer",t)}}try{let i=t?t.CountdownClockSettings.EndsAt:null;if(!i)return;if(o(i)<=0)return;let n=discountNinja.Settings.Settings;if(!n||!n.CountdownClockSettings||!n.CountdownClockSettings.Enabled||null===t.Mode)return;!function(t){function i(t){try{return t&&""!==t?[t,t,t]:null}catch(t){return discountNinja.Logging.LogError("Timer.ProcessCustomTimeLabels",t),null}}try{let n=i(t.CustomDaysLabel)||["days","days","d"],e=i(t.CustomHoursLabel)||["hours","hrs","h"],o=i(t.CustomMinutesLabel)||["minutes","min","m"],r=i(t.CustomSecondsLabel)||["seconds","sec","s"],a=i(t.CustomAndLabel)||["and","&","&"];discountNinja_Script_Timer.TimerLabels=[n,e,o,r,a]}catch(t){discountNinja.Logging.LogError("Timer.ProcessCountdownClockSettings",t)}}(n.CountdownClockSettings),null!==discountNinja_Script_Timer.TimerIntervalId&&0!==discountNinja_Script_Timer.TimerIntervalId&&clearInterval(discountNinja_Script_Timer.TimerIntervalId),discountNinja_Script_Timer.TimerIntervalId=window.setInterval(function(){r(n,i)},1e3),r(n,i),discountNinja_Script_Timer.SetTimerStarted(!0),discountNinja.Logging.LogVerbose("Started timer")}catch(t){discountNinja.Logging.LogError("Timer.Start",t)}},FormatDate:function(t,i){try{let n=function(t){try{let n=moment(t).utc(),e=function(){try{return LimoniAppsLoadMoment(function(){return LimoniAppsLoadMomentFormat(function(){LimoniAppsLoadMomentTimezone(function(){return null===discountNinja_Script_Timer.TimeZone&&(discountNinja_Script_Timer.TimeZone=moment.tz.guess(),discountNinja.Logging.LogVerbose("Assuming timezone is: "+discountNinja_Script_Timer.TimeZone)),discountNinja_Script_Timer.TimeZone})})})}catch(t){return discountNinja.Logging.LogError("Timer.GetTimeZone",t),"America/Los_Angeles"}}(),o=moment(n).tz(e);return(i=n=null==o?n:o)?i.startOf("minute"):i}catch(t){return discountNinja.Logging.LogError("Timer.GetMoment",t,!1),null}var i}(t);return null===i||""===i?"":n?n.format(i):""}catch(t){return discountNinja.Logging.LogError("Timer.FormatDate",t),null}},Stop:function(){discountNinja_Script_Timer.SetTimerStarted(!1)},ShouldStartOn:function(t,i){return t&&t.CountdownClockSettings&&t.CountdownClockSettings.Trigger===i},ShouldStartOnDisplay:function(t){return discountNinja_Script_Timer.ShouldStartOn(t,"displayed")},ShouldStartOnAccept:function(t){return discountNinja_Script_Timer.ShouldStartOn(t,"accepted")},ShouldStartOnGoalAchieved:function(t){return discountNinja_Script_Timer.ShouldStartOn(t,"goalachieved")},ShouldNotStart:function(t){return!(!t||!t.CountdownClockSettings)&&!t.CountdownClockSettings.Trigger},IsTimerStarted:function(){return"true"===discountNinja.Cache.SessionGet("timer-started")},SetTimerStarted:function(t){discountNinja.Cache.SessionSet("timer-started",t)}},discountNinja_Script_Cache={_SupportsCacheLocal:null,_SupportsCacheSession:null,Fallback:{},SupportsCacheLocal:function(){try{return null===discountNinja_Script_Cache._SupportsCacheLocal&&(localStorage.setItem("testSupportsCacheLocal","testSupportsCacheLocal"),localStorage.removeItem("testSupportsCacheLocal"),discountNinja_Script_Cache._SupportsCacheLocal=!0),discountNinja_Script_Cache._SupportsCacheLocal}catch(t){return discountNinja_Script_Cache._SupportsCacheLocal=!1,!1}},SupportsCacheSession:function(){try{return null===discountNinja_Script_Cache._SupportsCacheSession&&(sessionStorage.setItem("testSupportsCacheSession","testSupportsCacheSession"),sessionStorage.removeItem("testSupportsCacheSession"),discountNinja_Script_Cache._SupportsCacheSession=!0),discountNinja_Script_Cache._SupportsCacheSession}catch(t){return discountNinja_Script_Cache._SupportsCacheSession=!1,!1}},LocalRemove:function(t){try{discountNinja_Script_Cache.SupportsCacheLocal()?localStorage.removeItem("limoniapps-discountninja-"+t):discountNinja_Script_Cache.SessionRemove(t)}catch(i){discountNinja.Logging.LogError("Cache.LocalRemove",i),discountNinja_Script_Cache.SessionRemove(t)}},LocalGet:function(t){try{return discountNinja_Script_Cache.SupportsCacheLocal()?localStorage.getItem("limoniapps-discountninja-"+t):discountNinja_Script_Cache.SessionGet(t)}catch(i){return discountNinja.Logging.LogError("Cache.LocalGet",i),discountNinja_Script_Cache.SessionGet(t)}},LocalSet:function(t,i){try{discountNinja_Script_Cache.SupportsCacheLocal()?(discountNinja_Script_Cache.LocalRemove(t),localStorage.setItem("limoniapps-discountninja-"+t,i)):discountNinja_Script_Cache.SessionSet(t,i)}catch(n){discountNinja.Logging.LogError("Cache.LocalSet",n),discountNinja_Script_Cache.SessionSet(t,i)}},SessionRemove:function(t){try{discountNinja_Script_Cache.SupportsCacheSession()?sessionStorage.removeItem("limoniapps-discountninja-"+t):discountNinja_Script_Cache.FallbackRemove(t)}catch(i){discountNinja.Logging.LogError("Cache.SessionRemove",i),discountNinja_Script_Cache.FallbackRemove(t)}},SessionGet:function(t){try{return discountNinja_Script_Cache.SupportsCacheSession()?sessionStorage.getItem("limoniapps-discountninja-"+t):discountNinja_Script_Cache.FallbackGet(t)}catch(i){return discountNinja.Logging.LogError("Cache.SessionGet",i),discountNinja_Script_Cache.FallbackGet(t)}},SessionSet:function(t,i){try{discountNinja_Script_Cache.SupportsCacheSession()?(discountNinja_Script_Cache.SessionRemove(t),sessionStorage.setItem("limoniapps-discountninja-"+t,i)):discountNinja_Script_Cache.FallbackSet(t,i)}catch(n){discountNinja.Logging.LogError("Cache.SessionSet",n),discountNinja_Script_Cache.FallbackSet(t,i)}},FallbackRemove:function(t){try{delete discountNinja_Script_Cache.Fallback[t]}catch(t){discountNinja.Logging.LogError("Cache.FallbackRemove",t)}},FallbackGet:function(t){try{return discountNinja_Script_Cache.Fallback.hasOwnProperty(t)?discountNinja_Script_Cache.Fallback[t]:null}catch(t){return discountNinja.Logging.LogError("Cache.FallbackGet",t),null}},FallbackSet:function(t,i){try{discountNinja_Script_Cache.Fallback[t]=String(i)}catch(t){discountNinja.Logging.LogError("Cache.FallbackSet",t)}},FallbackClear:function(){try{discountNinja_Script_Cache.Fallback={}}catch(t){discountNinja.Logging.LogError("Cache.FallbackClear",t)}},LocalClear:function(){try{discountNinja_Script_Cache.SupportsCacheLocal()&&localStorage.clear()}catch(t){discountNinja.Logging.LogError("Cache.LocalClear",t)}},SessionClear:function(){try{discountNinja_Script_Cache.SupportsCacheSession()&&sessionStorage.clear()}catch(t){discountNinja.Logging.LogError("Cache.SessionClear",t)}},Clear:function(){try{discountNinja_Script_Cache.LocalClear(),discountNinja_Script_Cache.SessionClear(),discountNinja_Script_Cache.FallbackClear()}catch(t){discountNinja.Logging.LogError("Cache.ClearCache",t)}}},discountNinja_Script_Cookie={GetCookie:function(t){return(document.cookie.match("(^|; )"+t+"=([^;]*)")||0)[2]},GetDiscountCodeCookie:function(){return discountNinja_Script_Cookie.GetCookie("discount_code")},AppendDiscountCodeToCookie:function(t){discountNinja_Script_Cookie.RemoveDiscountCodesFromCookie();let i="discount_code="+encodeURI(t)+"; path=/";discountNinja.Logging.LogVerbose("Adding/updating cookie: "+i,!1),document.cookie=i},RemoveDiscountCodesFromCookie:function(){document.cookie="discount_code=;expires=Thu, 01 Jan 1970 00:00:01 GMT;",document.cookie="discount_code=;expires=Thu, 01 Jan 1970 00:00:01 GMT; path=/"}},discountNinja_Script_Events={GetFullQualifiedEventName:function(t){return"limoniApps:discountNinja:"+t},Publish:function(t,i){let n=discountNinja_Script_Events.GetFullQualifiedEventName(t);jQuery(document).trigger(n,i)},Subscribe:function(t,i,n){null==n&&(n=!0);let e=discountNinja_Script_Events.GetFullQualifiedEventName(t);n&&jQuery(document).off(e),discountNinja.Logging.LogVerbose("Subscribing to event "+e),jQuery(document).on(e,function(){i&&i.apply(this,arguments)})}},discountNinja_Script_Logging={StartTime:null,WriteToConsole:!1,LogTimeElapsed:!1,LogWarningToServer:!0,LogMessageHeader:"Discount Ninja - ",StartTimer:function(){try{discountNinja_Script_Logging.StartTime=moment().utc()}catch(t){discountNinja_Script_Logging.LogError("Logging.StartTimer","Exception in StartTimer",t)}},LogErrorMessage:function(t,i){try{message="Error occurred in "+t+".\r\nError message: '"+i+"'",discountNinja_Script_Logging.LogToConsole("error",message),discountNinja_Script_Logging.TrackMessage(message,"error")}catch(t){}},LogError:function(t,i,n){try{n=n||"error",message="Error occurred in "+t+".\r\nError message: '"+i.message+"'.\r\nStack: '"+i.stack+"'",discountNinja_Script_Logging.LogToConsole(n,message),discountNinja_Script_Logging.TrackMessage(i,n)}catch(t){}},LogWarning:function(t,i){try{i&&discountNinja_Script_Logging.LogToConsole("warning",t),discountNinja_Script_Logging.TrackMessage(t,"warning")}catch(t){}},LogInformation:function(t){try{discountNinja_Script_Logging.WriteToConsole&&discountNinja_Script_Logging.LogToConsole("information",t,"blue"),discountNinja_Script_Logging.TrackMessage(t,"information")}catch(t){}},LogVerbose:function(t){try{discountNinja_Script_Logging.WriteToConsole&&discountNinja_Script_Logging.LogToConsole("debug","DEBUG - "+t,"gray"),discountNinja_Script_Logging.TrackMessage(t,"verbose")}catch(t){}},BuildTrackingClient:function(){try{window.bugsnagClient=bugsnag({apiKey:"7e5b70374d322898dab33544f375cd38",releaseStage:"prod"===discountNinja.Core.Environment?"production":"development",appType:"client",appVersion:discountNinja.Core.Version,autoNotify:!1,interactionBreadcrumbsEnabled:!1,logger:null}),window.bugsnagClient.user={name:discountNinja.Core.Shop}}catch(t){}},TrackMessage:function(t,i){try{if(void 0!==window.bugsnag){void 0===window.bugsnagClient&&discountNinja_Script_Logging.BuildTrackingClient();discountNinja_Script_Logging.TrackingClient;"object"==typeof window.bugsnagClient&&(window.bugsnagClient.leaveBreadcrumb(t),"error"===i&&window.bugsnagClient.notify(new Error(t)))}}catch(t){}},LogTestMode:function(t,i,n,e){try{if(!0===discountNinja.TestMode.TestMode&&(logToServer=!1),!0!==e&&!0!==logToServer||discountNinja_Script_Logging.LogInformation(i||t),!0===n){let i="- "+t+"<br/>";for(let t=0;t<discountNinja.TestMode.TestModeOutput.length;t++)if(discountNinja.TestMode.TestModeOutput[t]===i)return;discountNinja.TestMode.TestModeOutput.push(i),discountNinja.TestMode.TestModeOutputIssue=!0}}catch(t){}},LogToConsole:function(t,i,n,e,o){try{o||(i=discountNinja_Script_Logging.LogMessageHeader+i);let r="error"===t||"critical"===t?Function.prototype.bind.call(console.error,console):"warn"===t||"warning"===t?Function.prototype.bind.call(console.warn,console):"debug"===t||"verbose"===t?Function.prototype.bind.call(console.debug,console):Function.prototype.bind.call(console.log,console);n=n||"black";let a="";!0===(e=e||!1)&&(a="font-weight: bold;"),r.apply(console,["%c"+i,"color: "+n+";"+a])}catch(t){try{console&&console.log(i)}catch(t){}}},ShowTimeElapsed:function(t){if(discountNinja_Script_Logging.LogTimeElapsed)try{discountNinja_Script_Logging.LogInformation("Time elapsed: "+moment().utc().diff(discountNinja_Script_Logging.StartTime,"milliseconds")+"ms - Currently at: "+t)}catch(t){discountNinja_Script_Logging.LogError("Logging.ShowTimeElapsed",t)}},HandleQueryParameter:function(){discountNinja.QueryParameter.Get("discountninjalog")?(discountNinja_Script_Logging.WriteToConsole=!0,discountNinja.Cache.SessionSet("discountninjalog",!0),discountNinja.QueryParameter.Remove("discountninjalog")):discountNinja.Cache.SessionGet("discountninjalog")&&(discountNinja_Script_Logging.WriteToConsole=!0)}},discountNinja_Script_Currency={GetCurrencyFormat:function(){try{let t=discountNinjaContext.PresentmentCurrency,i=discountNinjaContext.ShopCurrency,n=null===discountNinja_Script_Settings.Settings.CurrencySettings.MoneyFormat?'<span class="money">{{amount}}</span>':discountNinja_Script_Settings.Settings.CurrencySettings.MoneyFormat;if(t===i)return n;{let e=discountNinja.Settings.Settings.CurrencySettings.BaseCurrencySymbol;return presentmentCurrencySymbol=discountNinja_Script_Currency.GetCurrencySymbol(t),n.replace(new RegExp(i,"g"),t).replace(new RegExp(e,"g"),presentmentCurrencySymbol)}}catch(t){return discountNinja.Logging.LogError("Currency.GetCurrencyFormat",t),""}},GetCurrencySymbol:function(t){try{if(discountNinjaContext&&discountNinjaContext.EnabledCurrencies)for(let i=0;i<discountNinjaContext.EnabledCurrencies.length;i++){let n=discountNinjaContext.EnabledCurrencies[i];if(n.IsoCode===t)return n.Symbol}return""}catch(t){return discountNinja.Logging.LogError("Currency.GetCurrencySymbol",t),""}},Convert:function(t,i){try{let n=t*JSON.parse(discountNinja.Settings.Settings.CurrencySettings.ConversionRates)[i],e=discountNinja.Settings.Settings.CurrencySettings.RoundingAlgorithm;return"exact"===e?n:"ceiling"===e?Math.ceil(n):"floor"===e?Math.floor(n):"round"===e?Math.round(n):"roundtofive"===e?5*Math.round(n/5):"floortofive"===e?5*Math.floor(n/5):"ceiltofive"===e?5*Math.ceil(n/5):5*Math.round(n/5)}catch(i){return discountNinja.Logging.LogError("Currency.Convert",i),t}}},discountNinja_Script_MultiCurrency={UpdateCurrency:function(){try{"object"==typeof window.DoublyGlobalCurrency?function(){try{let t=discountNinja.Settings.Settings.CurrencySettings.BaseCurrency;void 0!==window.DoublyGlobalCurrency.currentCurrency&&null!==window.DoublyGlobalCurrency.currentCurrency&&""!==window.DoublyGlobalCurrency.currentCurrency&&(t=window.DoublyGlobalCurrency.currentCurrency),"function"==typeof window.DoublyGlobalCurrency.convertAll&&(t!==discountNinja.Settings.Settings.CurrencySettings.BaseCurrency&&(discountNinja.Logging.LogVerbose("Updating currency - Doubly - Back to base currency: "+discountNinja.Settings.Settings.CurrencySettings.BaseCurrency),window.DoublyGlobalCurrency.convertAll(discountNinja.Settings.Settings.CurrencySettings.BaseCurrency,".money")),discountNinja.Logging.LogVerbose("Updating currency - Doubly - To current currency: "+t),window.DoublyGlobalCurrency.convertAll(t,".money"))}catch(t){discountNinja.Logging.LogError("UpdateCurrencyDoubly",t,"warning")}}():"object"==typeof window.Geolizr?function(){try{if("object"==typeof window.Geolizr){let t=discountNinja.Settings.Settings.CurrencySettings.BaseCurrency,i=window.Geolizr.getCurrency();discountNinja.Logging.LogVerbose("Updating currency - Switching to "+i),window.Geolizr.moneyFormats[t]&&window.Geolizr.moneyFormats[i]?(window.Geolizr.switchCurrency(t),window.Geolizr.switchCurrency(i)):discountNinja.Logging.LogVerbose("Currency unavailable "+t+" or "+i)}}catch(t){discountNinja.Logging.LogError("UpdateCurrencyGeolizr",t,"warning")}}():"object"==typeof window.SECOMAPP&&"object"==typeof window.Currency?function(){try{let t=discountNinja.Settings.Settings.CurrencySettings.BaseCurrency,i=discountNinja.Settings.Settings.CurrencySettings.BaseCurrency;void 0!==window.Currency.shopCurrency&&null!==window.Currency.shopCurrency&&""!==window.Currency.shopCurrency&&(t=window.Currency.shopCurrency),void 0!==window.Currency.currentCurrency&&null!==window.Currency.currentCurrency&&""!==window.Currency.currentCurrency&&(i=window.Currency.currentCurrency),t!==i&&"function"==typeof window.Currency.convertAll&&(discountNinja.Logging.LogVerbose("Updating currency - SECOMAPP - From base currency: "+t+" - To current currency: "+i),window.Currency.convertAll(t,i))}catch(t){discountNinja.Logging.LogError("UpdateCurrencySecomapp",t,"warning")}}():"function"==typeof window.convertCurrencies&&"object"==typeof window.Currency&&function(){try{"function"==typeof window.convertCurrencies&&(discountNinja.Logging.LogVerbose("Updating currency - Standard"),window.convertCurrencies())}catch(t){discountNinja.Logging.LogError("UpdateCurrencyStandard",t,"warning")}}();try{jQuery(document).trigger("switch-currency")}catch(t){discountNinja.Logging.LogError("UpdateCurrency Switch currency",t,"warning")}}catch(t){discountNinja.Logging.LogError("UpdateCurrency",t,"warning")}}},discountNinja_Script_QueryParameter={GetQueryParameters:function(t){try{let i,n=null==t?window.location.href.replace(window.location.hash,""):t.indexOf("#")>-1?t.substring(0,t.indexOf("#")):t,e=[],o=n.slice(n.indexOf("?")+1).split("&");for(let t=0;t<o.length;t++)i=o[t].split("="),e.push(i[0]),e[i[0]]=i[1];return e}catch(t){return discountNinja.Logging.LogError("QueryParameter.GetQueryParameters",t),[]}},Get:function(t,i){try{let n=discountNinja_Script_QueryParameter.GetQueryParameters(i)[t];return"undefined"===n||"null"===n||"UNDEFINED"===n||"NULL"===n||null===n?null:n}catch(t){return discountNinja.Logging.LogError("QueryParameter.Get",t),null}},Remove:function(t){try{let i=discountNinja_Script_QueryParameter.GetQueryParameters(),n=[];for(let e in Object.keys(i)){let o=i[e],r=i[o];null!=o&&null!=r&&o!==t&&n.push(o+"="+r)}let e=n.length<1?"":"?"+n.join("&");window.history&&window.history.replaceState?window.history.replaceState({},document.title,location.origin+location.pathname+e):document.location.search=e}catch(t){discountNinja.Logging.LogError("QueryParameter.Remove",t)}},RemoveFromUrl:function(t,i,n){try{let e=t.replace(i+"="+n,""),o=(e=(e=e.replace("?&","?")).replace("&&","&")).slice(-1);return"&"!==o&&"?"!==o||(e=e.slice(0,-1)),e}catch(t){discountNinja.Logging.LogError("QueryParameter.RemoveFromUrl",t)}},AppendToUrl:function(t,i,n,e){try{n=discountNinja.Utilities.EncodeUriComponentComponentForQueryString(n),i=discountNinja.Utilities.EncodeUriComponentComponentForQueryString(i);let o=discountNinja_Script_QueryParameter.GetQueryParameters(t)[i];if(void 0!==o&&o===n)return t;e&&void 0!==o&&(t=discountNinja_Script_QueryParameter.RemoveFromUrl(t,i,o));let r="";return r=(r=t.indexOf("?")>0?t+"&"+i+"="+n:t+"?"+i+"="+n).replace("?&","?")}catch(t){discountNinja.Logging.LogError("QueryParameter.AppendToUrl",t)}}},discountNinja_Script_TextSettings={WrapInColor:function(t,i){return t?'<span style="color:'+t+'">'+i+"</span>":i},GetText:function(t,i,n){if(!t)return"";let e=discountNinja.Environment.Shopify.IsCartPage(),o=discountNinja.Utilities.IsMobilePhone(),r="-";if(null!==i&&("spendx_gety"===i.OfferType||i.Tiers[0].Prerequisite.MaximumItems>0||i.Tiers[0].Prerequisite.MinimumItems>0||i.Tiers[0].Prerequisite.MinimumAmount>0||i.Tiers[0].Prerequisite.MaximumAmount>0)){let t=discountNinja.Offer.PrerequisiteItemsCartValue(i),n=null===i?0:discountNinja.DiscountTier.GetCurrentDiscountTierNumber(i,t);n===(null===i?0:discountNinja.DiscountTier.GetMaxDiscountTierNumber(i))?r="after":n>0?r="duringandafter":n>-1&&(r="during")}let a="",c="",s="",u=t.TextOnCartDuringGoal,d=t.TextOnCartAfterGoal,l=t.TextOnCart,g=t.TextDuringGoal,p=t.TextAfterGoal,f=t.Text;o&&(u=t.MobileTextOnCartDuringGoal||u,d=t.MobileTextOnCartAfterGoal||d,l=t.MobileTextOnCart||l,g=t.MobileTextDuringGoal||g,p=t.MobileTextAfterGoal||p,f=t.MobileText||f),e&&(g=u||g,p=d||p,f=l||f),a=g||f||"",c=p||f||"";let m="";return m="duringandafter"===r?c===a?c:c+a:"during"===r?a:"after"===r?c:s=f||"",discountNinja.TextScaling.ReplacePxWithRem(m,.9)}},discountNinja_Script_Utilities={CreateFragment:function(t){let i=document.createDocumentFragment(),n=document.createElement("div");for(n.innerHTML=t;n.firstChild;)i.appendChild(n.firstChild);return i},NumberOfFractionalDigits:function(t){return Math.floor(t)===t?0:t.toString().split(".")[1].length||0},FixedMultipliedAmount:function(t,i){let n=Math.pow(10,i),e=discountNinja_Script_Utilities.NumberOfFractionalDigits(t);return(t*n).toFixed(Math.max(0,e-i))},RoundToNumberOfDigits:function(t,i){try{let n=Math.pow(10,i),e=discountNinja_Script_Utilities.FixedMultipliedAmount(t,i);return parseFloat(Math.round(e)/n)}catch(i){return discountNinja.Logging.LogError("Utilities.RoundToNumberOfDigits",i),t}},FloorToNumberOfDigits:function(t,i){try{let n=Math.pow(10,i),e=discountNinja_Script_Utilities.FixedMultipliedAmount(t,i);return parseFloat(Math.floor(e)/n)}catch(i){return discountNinja.Logging.LogError("Utilities.FloorToNumberOfDigits",i),t}},Debounce:function(t,i,n){let e;return function(){try{let o=this,r=arguments,a=function(){try{e=null,n||t.apply(o,r)}catch(t){discountNinja.Logging.LogError("Utilities.Debounce",t)}},c=n&&!e;clearTimeout(e),e=setTimeout(a,i),c&&t.apply(o,r)}catch(t){discountNinja.Logging.LogError("Utilities.Debounce",t)}}},EncodeUriComponent:function(t){try{if(!t||"string"!=typeof t)return t;let i=t;try{i=decodeURIComponent(t)}catch(t){}let n=i;try{n=encodeURIComponent(i)}catch(i){discountNinja.Logging.LogWarning("Could not encode: "+t,!0,!1)}return n}catch(i){return discountNinja.Logging.LogWarning("Utilities.EncodeUriComponent - Could not encode: "+t,!0,!1),t}},EncodeUriComponentComponentForQueryString:function(t){try{if(!t||"string"!=typeof t)return t;return t=t.toString().replace(/\+/g," "),discountNinja_Script_Utilities.EncodeUriComponent(t).replace(/%20/g,"+").replace(/ /g,"+")}catch(i){return discountNinja.Logging.LogWarning("Utilities.EncodeUriComponentForQueryString - Could not encode: "+t,!0,!1),t}},GetNumberFromHtmlFragment:function(t){try{return t.match(/\d+/)[0]}catch(i){return t}},GetElementId:function(t){try{if("body"===t)return"body";let i=jQuery(t).attr("id");return i||t}catch(i){return t}},IsInViewport:function(t){let i=jQuery(t).offset().top,n=jQuery(t).offset().left,e=i+jQuery(t).outerHeight(),o=n+jQuery(t).outerWidth(),r=jQuery(window).scrollTop(),a=r+jQuery(window).height(),c=jQuery(window).scrollLeft(),s=c+jQuery(window).width();return e>r&&i<a&&n<s&&o>c},IsValidEmailAddress:function(t){return/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(t.toLowerCase())},GetMutationObserver:function(){try{let t=window.MutationObserver||window.WebKitMutationObserver||window.MozMutationObserver;return void 0===t?discountNinja.Logging.LogWarning("MutationObserver not available, not supporting ListenForDynamicallyAddedElements",!0,!0):t}catch(t){return discountNinja.Logging.LogError("Utilities.GetMutationObserver",t),null}},FormatPercentage:function(t,i){try{return isNaN(t)?t:t.toFixed(i)}catch(i){return discountNinja.Logging.LogError("Utilities.FormatPercentage",i),t}},FormatMoney:function(t,i,n,e,o,r){function a(t,i,n,o){if(n=n||",",o=o||".",isNaN(t)||null===t)return 0;let r=(t=(t/100).toFixed(i)).split("."),a=r[0].replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1"+n);if(0===i)return a;{let t="";return a+(t=e?"<sup>"+(r[1]?r[1]:"")+"</sup>":r[1]?o+r[1]:"")}}try{if(0===t&&!0===r)return window.discountNinjaContext.Labels.Free;e=e||!1,o=o||!1,"string"==typeof t&&(t=t.replace(".",""));let c="",s=/\{\{\s*(\w+)\s*\}\}/,u=discountNinja.Currency.GetCurrencyFormat(),d=null===i||-1===i.indexOf("{{amount")?u:i;switch(d.match(s)[1]){case"amount":c=a(t,n,",",".");break;case"amount_no_decimals":c=a(t,0,",",".");break;case"amount_with_comma_separator":c=a(t,n,".",",");break;case"amount_no_decimals_with_comma_separator":c=a(t,0,".",",");break;case"amount_with_apostrophe_separator":c=a(t,n,"'",".")}return d.replace(s,c)}catch(i){return discountNinja.Logging.LogError("Utilities.FormatMoney",i),t}},GetNoDecimalsCurrencyFormat:function(t){try{return t&&(t=(t=t.replace("{{amount}}","{{amount_no_decimals}}")).replace("{{amount_with_comma_separator}}","{{amount_no_decimals_with_comma_separator}}")),t}catch(t){return discountNinja.Logging.LogError("Utilities.GetNoDecimalsCurrencyFormat",t),""}},GetCurrencyFormatAmountComponent:function(t){try{if(t){let i=t.match(/({{){1}(.)*(}}){1}/);if(null!==i&&i.length>0)return i[0]}return t}catch(t){return discountNinja.Logging.LogError("Utilities.GetCurrencyFormatAmountComponent",t),""}},StringIsIn:function(t,i,n){try{if(null==t||""===t||null==i||""===i)return!1;null==n&&(n=",");let e=t.split(n),o=i.split(n);for(let t=0;t<e.length;t++)for(let i=0;i<o.length;i++){let n=e[t],r=o[i];if(null!=n&&""!==n.trim()&&null!=r&&""!==r.trim()&&n.toLowerCase().trim()===r.toLowerCase().trim())return!0}return!1}catch(t){return discountNinja.Logging.LogError("Utilities.StringIsIn",t),!1}},AppendToStyle:function(t,i,n){try{jQuery(t).attr("style",function(t,e){"string"==typeof e&&null!=e||(e=""),""!==e&&";"!==e.substr(e.length-1)&&(e+=";");let o=new RegExp(i+"([s])*:([^;\n\r])*","g"),r=e.match(o);return null!==r&&r.length>0?e=e.replace(o,i+": "+n):e+i+": "+n+";"})}catch(t){discountNinja.Logging.LogError("Utilities.AppendToStyle",t)}},IsMobilePhone:function(){try{let i=!1;return t=navigator.userAgent||navigator.vendor||window.opera,(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(t)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(t.substr(0,4)))&&(i=!0),i}catch(t){return discountNinja.Logging.LogError("Utilities.IsMobilePhone",t),!1}var t},GetReferrer:function(){try{return-1===document.referrer.indexOf(document.location.hostname)&&discountNinja.Cache.SessionSet("original-referrer",document.referrer),discountNinja.Cache.SessionGet("original-referrer")}catch(t){return discountNinja.Logging.LogError("Utilities.GetReferrer",t),null}},GetEmoji:function(t){return t>65535?(t-=65536,String.fromCharCode(55296+(t>>10),56320+(1023&t))):String.fromCharCode(t)}},discountNinja_Script_VariantChange={UnRegisterEventHandlerForVariantChange:function(){try{jQuery("body").find("form").find("select").each(function(){jQuery(this).off("change.discountninja")})}catch(t){discountNinja.Logging.LogError("VariantChange.UnRegisterEventHandlerForVariantChange",t)}},RegisterEventHandlerForVariantChange:function(){function t(){try{!function(){let t=discountNinja.Cache.SessionGet("last-known-variant"),i=discountNinja.Environment.Shopify.VariantId();t!==i&&(discountNinja.Cache.SessionSet("last-known-variant",i),discountNinja.VariantChangedEvent.Handle(null,i))}()}catch(t){discountNinja.Logging.LogError("VariantChange.VariantChangeDetected",t)}}try{discountNinja.Logging.LogVerbose("Registering event handler for variant change"),discountNinja_Script_VariantChange.UnRegisterEventHandlerForVariantChange(),jQuery("body").find("form").find("select").each(function(){jQuery(this).on("change.discountninja",function(i){t()})}),jQuery(document).on("variantChanged",function(i,n){discountNinja.Logging.LogVerbose(n.variant?n.variant.id:""),t()}),jQuery(document).on("limoniApps:discountNinja:VariantChanged",function(i,n){discountNinja.Logging.LogVerbose(n.variant?n.variant.id:""),t()})}catch(t){discountNinja.Logging.LogError("VariantChange.RegisterEventHandlerForVariantChange",t)}}},discountNinja_Script_XmlHttpRequest={ParseCartAddParameters:function(t,i){let n=function(t){try{if(void 0!==t&&null!=t){let i=discountNinja.QueryParameter.GetQueryParameters(t);if(void 0!==i&&null!=i&&i.id)return{variant:i.id,quantity:i.quantity||1}}return discountNinja.Logging.LogVerbose("ParseCartAddParametersFromUrl could not find id / quantity parameters"),null}catch(t){return discountNinja.Logging.LogError("ParseCartAddParametersFromUrl",t),null}}(t)||function(t){try{return"function"==typeof t.get?function(t){try{return discountNinja.Logging.LogVerbose("ParseCartAddParametersFromFormDataUsingFormDataGetter, parsing "+t),{variant:t.get("id"),quantity:t.get("quantity")}}catch(t){return discountNinja.Logging.LogError("ParseCartAddParametersFromFormDataUsingFormDataGetter",t),null}}(t):"{"===t[0]?function(t){try{discountNinja.Logging.LogVerbose("ParseCartAddParametersFromFormDataUsingJson, parsing "+t);let i=JSON.parse(t);return{variant:i.id,quantity:i.quantity}}catch(t){return discountNinja.Logging.LogError("ParseCartAddParametersFromFormDataUsingJson",t),null}}(t):function(t){try{discountNinja.Logging.LogVerbose("ParseCartAddParametersFromFormDataAsString, parsing "+t);let i=null;if(t.indexOf("id=")>-1&&(i=t.match(/id=(\d)*/)[0].split("=")[1]),!i)return null;let n=1;return t.indexOf("quantity=")>-1&&(n=t.match(/quantity=(\d)*/)[0].split("=")[1]),{variant:i,quantity:n}}catch(t){return discountNinja.Logging.LogError("ParseCartAddParametersFromFormDataAsString",t),null}}(t)}catch(t){return discountNinja.Logging.LogError("ParseCartAddParametersFromFormData",t),null}}(i);return n?discountNinja.Logging.LogVerbose("ParseCartAddParameters found variant: "+n.variant+" quantity: "+n.quantity):discountNinja.Logging.LogWarning("ParseCartAddParameters could not find variant and quantity in url: "+t+" and body "+i,!0),n},HandleFetch:function(t,i){try{discountNinja.Logging.LogVerbose("HandleFetch called "+t);let n=null;try{n=i.body}catch(t){n=null}n?discountNinja_Script_XmlHttpRequest.HandleNetworkRequest(t,n,!0):discountNinja.Logging.LogVerbose("HandleFetch received data it cannot handle: "+i+" for url "+t)}catch(t){discountNinja.Logging.LogError("XMLHttpRequest.HandleFetch",t)}},HandleSend:function(t){try{if(4===this.readyState){if("text"!==this.responseType&&""!==this.responseType&&"string"!=typeof xhr.responseText)return void discountNinja.Logging.LogVerbose("HandleSend cannot handle response of type "+this.responseType);let i=this.responseURL||this._url;discountNinja_Script_XmlHttpRequest.HandleNetworkRequest(i,t,!1)}}catch(t){discountNinja.Logging.LogError("XMLHttpRequest.HandleSend",t)}},HandleNetworkRequest:function(t,i){try{if(void 0!==t&&null!=t)if(t.indexOf("/cart/add")>-1){discountNinja.Logging.LogVerbose("Handling cart add post");let n=discountNinja_Script_XmlHttpRequest.ParseCartAddParameters(t,i);void 0!==n&&n&&n.variant?discountNinja.ServerCartItemsAddedEvent.Handle(null,n.variant,n.quantity||1):discountNinja.Logging.LogWarning("Invalid params in HandleNetworkRequest",!0)}else t.indexOf("/cart/change")>-1?(discountNinja.Logging.LogVerbose("Handling cart change post"),discountNinja.ServerCartItemsChangedEvent.Handle()):t.indexOf("/cart/update")>-1?(discountNinja.Logging.LogVerbose("Handling cart update post"),discountNinja.ServerCartItemsUpdatedEvent.Handle()):(t.indexOf("?page=")>-1||t.indexOf("&page=")>-1)&&(discountNinja.Logging.LogVerbose("Handling paging request"),discountNinja.ServerCollectionProductsPageLoadedEvent.Handle());else discountNinja.Logging.LogWarning("Invalid url in HandleNetworkRequest",!0)}catch(t){discountNinja.Logging.LogError("XMLHttpRequest.HandleNetworkRequest",t)}},SendIntercepted:!1,CreateSendInterceptor:function(t,i,n){return discountNinja_Script_XmlHttpRequest.SendIntercepted?(discountNinja.Logging.LogVerbose("Send handler already registered"),n):function(e){try{discountNinja_Script_XmlHttpRequest.SendIntercepted=!0,discountNinja.Logging.LogVerbose("Send interceptor called, executing custom handler"),this.addEventListener(t,i.bind(this,e)),discountNinja.Logging.LogVerbose("Send interceptor execute original request");try{return n.apply(this,arguments)}catch(t){discountNinja.Logging.LogToConsole("error",t,"red",!1)}}catch(t){discountNinja.Logging.LogError("XMLHttpRequest.CreateSendInterceptor",t)}}},FetchIntercepted:!1,CreateFetchInterceptor:function(t){function i(t){return function(t){if(Array.isArray(t)){for(var i=0,n=new Array(t.length);i<t.length;i++)n[i]=t[i];return n}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function n(t,i,n,e,o,r,a){try{var c=t[r](a),s=c.value}catch(t){return void n(t)}c.done?i(s):Promise.resolve(s).then(e,o)}try{discountNinja.Logging.LogVerbose("Registering fetch interceptor");var e="undefined"!=typeof Promise&&-1!==Promise.toString().indexOf("[native code]"),o=window.fetch;if(discountNinja_Script_XmlHttpRequest.FetchIntercepted||o&&o.toString().indexOf("AsyncWindowFetchHandler")>0)return void discountNinja.Logging.LogVerbose("Fetch handler already registered");if(discountNinja_Script_XmlHttpRequest.FetchIntercepted=!0,e){var r=function(t){"use strict";function i(t,i,n,o){var r=i&&i.prototype instanceof e?i:e,a=Object.create(r.prototype),c=new g(o||[]);return a._invoke=s(t,n,c),a}function n(t,i,n){try{return{type:"normal",arg:t.call(i,n)}}catch(t){return{type:"throw",arg:t}}}function e(){}function o(){}function r(){}function a(t){["next","throw","return"].forEach(function(i){t[i]=function(t){return this._invoke(i,t)}})}function c(t){function i(e,o,r,a){var c=n(t[e],t,o);if("throw"!==c.type){var s=c.arg,u=s.value;return u&&"object"==typeof u&&N.call(u,"__await")?Promise.resolve(u.__await).then(function(t){i("next",t,r,a)},function(t){i("throw",t,r,a)}):Promise.resolve(u).then(function(t){s.value=t,r(s)},function(t){return i("throw",t,r,a)})}a(c.arg)}var e;this._invoke=function(t,n){function o(){return new Promise(function(e,o){i(t,n,e,o)})}return e=e?e.then(o,o):o()}}function s(t,i,e){var o="suspendedStart";return function(r,a){if("executing"===o)throw new Error("Generator is already running");if("completed"===o){if("throw"===r)throw a;return{value:void 0,done:!0}}for(e.method=r,e.arg=a;;){var c=e.delegate;if(c){var s=u(c,e);if(s){if(s===y)continue;return s}}if("next"===e.method)e.sent=e._sent=e.arg;else if("throw"===e.method){if("suspendedStart"===o)throw o="completed",e.arg;e.dispatchException(e.arg)}else"return"===e.method&&e.abrupt("return",e.arg);o="executing";var d=n(t,i,e);if("normal"===d.type){if(o=e.done?"completed":"suspendedYield",d.arg===y)continue;return{value:d.arg,done:e.done}}"throw"===d.type&&(o="completed",e.method="throw",e.arg=d.arg)}}}function u(t,i){var e=t.iterator[i.method];if(void 0===e){if(i.delegate=null,"throw"===i.method){if(t.iterator.return&&(i.method="return",i.arg=void 0,u(t,i),"throw"===i.method))return y;i.method="throw",i.arg=new TypeError("The iterator does not provide a 'throw' method")}return y}var o=n(e,t.iterator,i.arg);if("throw"===o.type)return i.method="throw",i.arg=o.arg,i.delegate=null,y;var r=o.arg;return r?r.done?(i[t.resultName]=r.value,i.next=t.nextLoc,"return"!==i.method&&(i.method="next",i.arg=void 0),i.delegate=null,y):r:(i.method="throw",i.arg=new TypeError("iterator result is not an object"),i.delegate=null,y)}function d(t){var i={tryLoc:t[0]};1 in t&&(i.catchLoc=t[1]),2 in t&&(i.finallyLoc=t[2],i.afterLoc=t[3]),this.tryEntries.push(i)}function l(t){var i=t.completion||{};i.type="normal",delete i.arg,t.completion=i}function g(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(d,this),this.reset(!0)}function p(t){if(t){var i=t[S];if(i)return i.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var n=-1,e=function i(){for(;++n<t.length;)if(N.call(t,n))return i.value=t[n],i.done=!1,i;return i.value=void 0,i.done=!0,i};return e.next=e}}return{next:f}}function f(){return{value:void 0,done:!0}}var m=Object.prototype,N=m.hasOwnProperty,j="function"==typeof Symbol?Symbol:{},S=j.iterator||"@@iterator",h=j.asyncIterator||"@@asyncIterator",C=j.toStringTag||"@@toStringTag";t.wrap=i;var y={},_={};_[S]=function(){return this};var L=Object.getPrototypeOf,P=L&&L(L(p([])));P&&P!==m&&N.call(P,S)&&(_=P);var T=r.prototype=e.prototype=Object.create(_);return o.prototype=T.constructor=r,r.constructor=o,r[C]=o.displayName="GeneratorFunction",t.isGeneratorFunction=function(t){var i="function"==typeof t&&t.constructor;return!!i&&(i===o||"GeneratorFunction"===(i.displayName||i.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,r):(t.__proto__=r,!(C in t)&&(t[C]="GeneratorFunction")),t.prototype=Object.create(T),t},t.awrap=function(t){return{__await:t}},a(c.prototype),c.prototype[h]=function(){return this},t.AsyncIterator=c,t.async=function(n,e,o,r){var a=new c(i(n,e,o,r));return t.isGeneratorFunction(e)?a:a.next().then(function(t){return t.done?t.value:a.next()})},a(T),T[C]="Generator",T[S]=function(){return this},T.toString=function(){return"[object Generator]"},t.keys=function(t){var i=[];for(var n in t)i.push(n);return i.reverse(),function n(){for(;i.length;){var e=i.pop();if(e in t)return n.value=e,n.done=!1,n}return n.done=!0,n}},t.values=p,g.prototype={constructor:g,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(l),!t)for(var i in this)"t"===i.charAt(0)&&N.call(this,i)&&!isNaN(+i.slice(1))&&(this[i]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){function i(i,e){return r.type="throw",r.arg=t,n.next=i,e&&(n.method="next",n.arg=void 0),!!e}if(this.done)throw t;for(var n=this,e=this.tryEntries.length-1;0<=e;--e){var o=this.tryEntries[e],r=o.completion;if("root"===o.tryLoc)return i("end");if(o.tryLoc<=this.prev){var a=N.call(o,"catchLoc"),c=N.call(o,"finallyLoc");if(a&&c){if(this.prev<o.catchLoc)return i(o.catchLoc,!0);if(this.prev<o.finallyLoc)return i(o.finallyLoc)}else if(a){if(this.prev<o.catchLoc)return i(o.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return i(o.finallyLoc)}}}},abrupt:function(t,i){for(var n,e=this.tryEntries.length-1;0<=e;--e)if((n=this.tryEntries[e]).tryLoc<=this.prev&&N.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var o=n;break}o&&("break"===t||"continue"===t)&&o.tryLoc<=i&&i<=o.finallyLoc&&(o=null);var r=o?o.completion:{};return r.type=t,r.arg=i,o?(this.method="next",this.next=o.finallyLoc,y):this.complete(r)},complete:function(t,i){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&i&&(this.next=i),y},finish:function(t){for(var i,n=this.tryEntries.length-1;0<=n;--n)if((i=this.tryEntries[n]).finallyLoc===t)return this.complete(i.completion,i.afterLoc),l(i),y},catch:function(t){for(var i,n=this.tryEntries.length-1;0<=n;--n)if((i=this.tryEntries[n]).tryLoc===t){var e=i.completion;if("throw"===e.type){var o=e.arg;l(i)}return o}throw new Error("illegal catch attempt")},delegateYield:function(t,i,n){return this.delegate={iterator:p(t),resultName:i,nextLoc:n},"next"===this.method&&(this.arg=void 0),y}},t}("object"==typeof module?module.exports:{});try{regeneratorRuntime=r}catch(t){Function("r","regeneratorRuntime = r")(r)}AsyncWindowFetchHandler=function(){var e,r=(e=regeneratorRuntime.mark(function n(e){var r;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return discountNinja.Logging.LogVerbose("Executing original fetch (async)"),n.prev=1,n.next=4,o.apply(void 0,i(e));case 4:r=n.sent,n.next=10;break;case 7:n.prev=7,n.t0=n.catch(1),discountNinja.Logging.LogToConsole("error",n.t0,"red",!1);case 10:discountNinja.Logging.LogVerbose("Calling custom fetch handler (async)");try{t.apply(void 0,i(e))}catch(t){discountNinja.Logging.LogError("XMLHttpRequest.CreateFetchInterceptor - Custom fetch handler (async)",t,!1)}return n.abrupt("return",r);case 13:case"end":return n.stop()}},n,null,[[1,7]])}),function(){var t=this,i=arguments;return new Promise(function(o,r){var a=e.apply(t,i);function c(t){n(a,o,r,c,s,"next",t)}function s(t){n(a,o,r,c,s,"throw",t)}c(void 0)})});return function(t){return r.apply(this,arguments)}}(),window.fetch=function(){for(var t=arguments.length,i=new Array(t),n=0;n<t;n++)i[n]=arguments[n];return AsyncWindowFetchHandler(i)}}else window.fetch=function(){discountNinja.Logging.LogVerbose("Calling custom fetch handler (sync)");for(var i=arguments.length,n=new Array(i),e=0;e<i;e++)n[e]=arguments[e];try{var r;(r=t).apply.apply(r,n)}catch(t){discountNinja.Logging.LogToConsole("error",t,"red",!1)}discountNinja.Logging.LogVerbose("Executing original fetch (sync)");try{return o.apply(window,n)}catch(t){discountNinja.Logging.LogError("XMLHttpRequest.CreateFetchInterceptor - Original fetch handler (sync)",t,!1)}}}catch(t){discountNinja.Logging.LogError("XMLHttpRequest.CreateFetchInterceptor",t,!0)}},XmlHttpRequestObject:function(){return"undefined"!=typeof XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP")},Send:function(t,i,n,e,o,r,a,c,s,u){function d(t,i,n){return""===t?t="?":t+="&",t=t+discountNinja.Utilities.EncodeUriComponentComponentForQueryString(i)+"="+discountNinja.Utilities.EncodeUriComponentComponentForQueryString(n)}try{if(null==u&&(u=10),null==s&&(s=1),s>=u){let i="SendHttpRequest failed. Retry iterations ("+u+") exceeded for url "+t;return discountNinja.Logging.LogErrorMessage("XMLHttpRequest.Send",i),void("function"==typeof c&&null!==c&&c(i))}!function(t,i,e,o,r,a,c,s,u){let l=function(t){try{if("object"!=typeof t||null===t)return"";let i=Object.getOwnPropertyNames(t),n="";for(let e=0;e<i.length;e++){let o=i[e],r=t[o];if("string"==typeof r&&null!==r&&""!==r){let t=r.split(",");for(let i=0;i<t.length;i++)n=d(n,o,t[i])}else n=d(n,o,r)}return n}catch(t){return console.error("CreateQueryStringFromParameters failed",t),""}}(i),g=t+l;discountNinja.Logging.LogVerbose("Sending request to "+g+" from SendXMLHttpRequest",!1);let p=discountNinja_Script_XmlHttpRequest.XmlHttpRequestObject();p.open(e,g,!0),p.onreadystatechange=function(){let d;4===p.readyState&&(200===(d=p.status)?function(t){var i=null;try{if("text"!==t.responseType&&""!==t.responseType&&"string"!=typeof t.responseText)return void discountNinja.Logging.LogVerbose("XMLHttpRequest.Send cannot handle response of type "+t.responseType);let n=t.responseText;i=o?null==n?null:JSON.parse(n):n}catch(t){}"function"==typeof a&&null!==a&&a(i)}(p):function(d){let l="Could not "+e+" data from "+g+" on attempt "+s+". Request status: "+d+" - Parameters: "+JSON.stringify(i);discountNinja.Logging.LogWarning(l,!0,r),setTimeout(function(){discountNinja_Script_XmlHttpRequest.Send(t,i,n,e,o,r,a,c,s+1,u)},500*s)}(d))},null===n?p.send():(p.setRequestHeader("Content-Type","application/json"),p.send(JSON.stringify(n)))}(t,i,e,o,r,a,c,s,u)}catch(i){try{discountNinja.Logging.LogToConsole("error","Error occurred in Send for url "+t+". Error: "+i)}catch(t){}try{"function"==typeof c&&null!==c&&c(i)}catch(t){}}}},discountNinja_Script_TextScaling={ReplacePxWithRem:function(t,i){let n,e=discountNinja.Utilities.IsMobilePhone()?i:1,o=parseFloat(getComputedStyle(document.documentElement).fontSize),r=new RegExp("font-size:(\\s)*(\\d+)(.)?(\\d+)px","g");for(;null!==(n=r.exec(t));){let i=parseFloat(n[0].replace("px","").replace("font-size:","")),r=i/o*e,a=new RegExp("font-size:(\\s)*"+i+"px","g");t=t.replace(a,"font-size:"+r+"rem")}return t}},discountNinja_Script_VariantChangedEvent={Handle:function(t,i){function n(){discountNinja.DynamicPricing.UpdatePrice(!0,!0)}try{discountNinja.Logging.LogInformation("EVENT HANDLED - Variant changed - Variant: "+i),n(),discountNinja.Settings.GetFlag("VariantPriceUpdateRequiresDelay")&&setTimeout(function(){n()},500)}catch(t){discountNinja.Logging.LogError("VariantChangedEvent",t)}},Subscribe:function(){discountNinja.Events.Subscribe("VariantChanged",discountNinja_Script_VariantChangedEvent.Handle)}},discountNinja_Script_ServerCartItemsAddedEvent={Handle:function(t,i,n){try{discountNinja.Logging.LogInformation("EVENT HANDLED - Server cart items added - Variant: "+i+" - Quantity: "+n),discountNinja.Cart.Shopify.OnAddToCart(t,i),discountNinja.Offer.ClearPromotionForProductCache(),discountNinja.Cart.Shopify.IsDirty=!0,discountNinja.Cart.Shopify.UpdateCart(function(){discountNinja.Cart.Shopify.OnUpdateCart()})}catch(t){discountNinja.Logging.LogError("ServerCartItemsAddedEvent",t)}},Subscribe:function(){discountNinja.Events.Subscribe("ServerCartItemsAdded",discountNinja_Script_ServerCartItemsAddedEvent.Handle)}},discountNinja_Script_ServerCartItemsUpdatedEvent={Handle:function(t){try{discountNinja.Logging.LogInformation("EVENT HANDLED - Server cart items updated"),discountNinja.Offer.ClearPromotionForProductCache(),discountNinja.Cart.Shopify.IsDirty=!0,discountNinja.Cart.Shopify.UpdateCart(function(){discountNinja.Cart.Shopify.OnUpdateCart()})}catch(t){discountNinja.Logging.LogError("ServerCartItemsUpdatedEvent",t)}},Subscribe:function(){discountNinja.Events.Subscribe("ServerCartItemsUpdated",discountNinja_Script_ServerCartItemsUpdatedEvent.Handle)}},discountNinja_Script_ServerCartItemsChangedEvent={Handle:function(t){try{discountNinja.Logging.LogInformation("EVENT HANDLED - Server cart items changed"),discountNinja.Offer.ClearPromotionForProductCache(),discountNinja.Cart.Shopify.IsDirty=!0,discountNinja.Cart.Shopify.UpdateCart(function(){discountNinja.Cart.Shopify.OnUpdateCart()})}catch(t){discountNinja.Logging.LogError("ServerCartItemsChangedEvent",t)}},Subscribe:function(){discountNinja.Events.Subscribe("ServerCartItemsChanged",discountNinja_Script_ServerCartItemsChangedEvent.Handle)}},discountNinja_Script_ServerCollectionProductsPageLoadedEvent={Handle:function(t){try{discountNinja.Logging.LogInformation("EVENT HANDLED - Collection loaded next page of products"),discountNinja.DynamicPricing.UpdatePrice(!0,!0),setTimeout(function(){discountNinja.DynamicPricing.UpdatePrice(!0,!0)},1e3)}catch(t){discountNinja.Logging.LogError("ServerCollectionProductsPageLoadedEvent",t)}},Subscribe:function(){discountNinja.Events.Subscribe("ServerCollectionProductsPageLoaded",discountNinja_Script_ServerCollectionProductsPageLoadedEvent.Handle)}},discountNinja_Script_LocalCartUpdatedEvent={Handle:function(t,i,n,e){try{if(discountNinja.Logging.LogInformation("EVENT HANDLED - Local cart updated - IsUpdated: "+n+" - Handle using callback: "+(e?"true":"false")),e)return;n&&discountNinja.DiscountedCart.BuildDiscountedCart(null,!n)}catch(t){discountNinja.Logging.LogError("LocalCartUpdatedEvent",t)}},Subscribe:function(){discountNinja.Events.Subscribe("LocalCartUpdated",discountNinja_Script_LocalCartUpdatedEvent.Handle)}},discountNinja_Script_Checkout_Shopify={InitiatedCheckout:!1,RedirectingToCheckout:!1,ProcessingCheckout:!1,LoadingCheckoutPopUpId:"LimoniApps-DiscountNinja-Checkout",LoadingCheckoutPopUpMessageId:"LimoniApps-DiscountNinja-Checkout-Message",LoadingCheckoutPopUpDotsId:"LimoniApps-DiscountNinja-Checkout-Dots",FallBackEvent:null,ServerUrl:function(){return"prod"===discountNinja.Core.Environment?"https://checkoutapi.discountninja.io":"https://discountninjav2-checkoutapi-dev.azurewebsites.net"},InjectLoadingCheckoutPopUp:function(){if(0===jQuery("#"+discountNinja_Script_Checkout_Shopify.LoadingCheckoutPopUpId).length){let t=discountNinja.Settings.Settings.CheckoutSettings,i='<div id="'+discountNinja_Script_Checkout_Shopify.LoadingCheckoutPopUpId+'" style="display:none;background-color:{{CHECKOUT_OVERLAY_BACKGROUND_COLOR}};" class="limoniapps-popup limoniapps-size-small limoniapps-overlay-5 limoniapps-shape-square limoniapps-align-center limoniapps-content-bottom"><div class="limoniapps-popup-vertical-alignment-helper"><div class="limoniapps-popup-vertical-align-center"><div class="limoniapps-content" style="background-color:{{CHECKOUT_BACKGROUND_COLOR}};"><div id="'+discountNinja_Script_Checkout_Shopify.LoadingCheckoutPopUpMessageId+'" class="limoniapps-body"></div></div></div></div></div>',n=function(t){let i=document.createDocumentFragment(),n=document.createElement("div");for(n.innerHTML=t;n.firstChild;)i.appendChild(n.firstChild);return i}(i=(i=i.replace("{{CHECKOUT_BACKGROUND_COLOR}}",t.CheckoutLoadingBackground||"white")).replace("{{CHECKOUT_OVERLAY_BACKGROUND_COLOR}}",t.CheckoutLoadingOverlay||"rgba(0,0,0,0.7)"));document.body.insertBefore(n,document.body.childNodes[0])}},RegisterEventHandlerForCheckout:function(){function t(){let t="/checkout";try{let i=discountNinja.DiscountCode.GetFirstActiveDiscountCodeForCheckout(!0);""!==i&&(t="/checkout?discount="+i)}catch(t){discountNinja.Logging.LogError("Checkout.Shopify.RegisterEventHandlerForCheckout.FallBack","Error occurred in setting classic checkout link "+t)}let i=function(){let t=null,i=jQuery('form[action="/cart"], form[action^="/cart?"]').attr("action");return i&&(t=discountNinja.QueryParameter.Get("locale",i)),t}();return i&&(t=discountNinja.QueryParameter.AppendToUrl(t,"locale",i)),discountNinja.Logging.LogVerbose("Built classic checkout link: "+t),t}function i(i){try{discountNinja.Logging.LogVerbose("Redirecting to standard checkout, reason: "+i),function t(i,n){if(n>40||discountNinja_Script_Checkout_Shopify.DiscountCodesReady(discountNinja.DiscountCode.GetActiveDiscountCodesForCheckoutAsArray())){discountNinja.Logging.LogVerbose("Redirecting to standard checkout"),discountNinja_Script_Checkout_Shopify.ProcessingCheckout=!1,r(discountNinja.Settings.Settings.CheckoutSettings.LoadingCheckoutMessage3),discountNinja_Script_Checkout_Shopify.RedirectingToCheckout=!0;let t=discountNinja_Script_Checkout_Shopify.FallBackEvent.originalEvent,i=new t.constructor(t.type,t);t.target.dispatchEvent(i)}else setTimeout(function(){t(i,n+1)},500)}(t(),1)}catch(t){discountNinja.Logging.LogError("Checkout.Shopify.RegisterEventHandlerForCheckout.FallBack","Failed "+t),window.location.href="/checkout"}}function n(t){try{if("standard"===t)i("Call to DraftOrder Api determined no discount is required");else if(t&&""!==t){discountNinja.Logging.LogVerbose("Redirecting to checkout url: "+t),r(discountNinja.Settings.Settings.CheckoutSettings.LoadingCheckoutMessage3),setTimeout(function(){window.location=t},500)}else discountNinja.Logging.LogVerbose("Checkout URL empty"),attempt+=1,attempt<3?c():(discountNinja.Logging.LogVerbose("Attempts to get checkout URL exhausted"),i("No valid checkout url received"))}catch(t){discountNinja.Logging.LogErrorMessage("Checkout.Shopify.RegisterEventHandlerForCheckout.onSuccess","Could not redirect to new checkout url, attempting to redirect to standard url: "+t),i("Error in processing onSuccess")}}function e(t){discountNinja.Logging.LogErrorMessage("Checkout.Shopify.RegisterEventHandlerForCheckout.onFailure","Call to DraftOrder Api failed, attempting to redirect to standard url: "+t),i("Call to DraftOrder Api failed")}function o(t){try{let n=jQuery("#"+discountNinja_Script_Checkout_Shopify.LoadingCheckoutPopUpId);t&&function t(){if(discountNinja_Script_Checkout_Shopify.ProcessingCheckout){let i=jQuery("#"+discountNinja_Script_Checkout_Shopify.LoadingCheckoutPopUpMessageId),n=discountNinja.Settings.Settings.CheckoutSettings;""===jQuery(i).html()?r(n.LoadingCheckoutMessage1):jQuery(i).html()===n.LoadingCheckoutMessage1?r(n.LoadingCheckoutMessage2):jQuery(i).html()===n.LoadingCheckoutMessage2&&r(n.LoadingCheckoutMessage1),setTimeout(function(){t()},2500)}}(),t?n.css("display",""):n.css("display","none")}catch(t){discountNinja.Logging.LogError("Checkout.Shopify.RegisterEventHandlerForCheckout.showLoadingCheckoutPopUp",t),i("Failure in showLoadingCheckoutPopUp")}}function r(t){let i=jQuery("#"+discountNinja_Script_Checkout_Shopify.LoadingCheckoutPopUpMessageId),n='<div id="'+discountNinja_Script_Checkout_Shopify.LoadingCheckoutPopUpDotsId+'"></div>';i.html(t+n)}function a(t){try{return void 0!==t&&t&&(t.preventDefault&&t.preventDefault(),t.stopPropagation&&t.stopPropagation(),t.returnValue=!1),t}catch(t){discountNinja.Logging.LogError("Checkout.Shopify.RegisterEventHandlerForCheckout.cancelDefaultBehaviorEvent",t)}}function c(){if(attempt<3){let t=discountNinja_Script_Checkout_Shopify.BuildParameters(),i=discountNinja_Script_Checkout_Shopify.BuildPayLoad();discountNinja.Logging.LogVerbose("Posting to /api/GetCheckoutUrl with query parameters: "+JSON.stringify(t)+" and payload: "+JSON.stringify(i)),discountNinja.Logging.LogVerbose("Getting checkout URL, attempt "+attempt),discountNinja.XmlHttpRequest.Send(discountNinja_Script_Checkout_Shopify.ServerUrl()+"/api/GetCheckoutUrl",t,i,"post",!0,!0,n,e,1,3)}}function s(t){try{return jQuery(".limoniapps-discountninja-checkout-checkbox:not(:checked), .my-terms-conditions-fy:not(.limoniapps-discountninja-ignore) input:checkbox:not(:checked)").length>0&&(discountNinja.Logging.LogVerbose("Abandon checkout because required checkbox(es) is not checked"),1)?null:discountNinja_Script_Checkout_Shopify.ProcessingCheckout?null:(discountNinja_Script_Checkout_Shopify.ProcessingCheckout=!0,discountNinja_Script_Checkout_Shopify.FallBackEvent=t,t=a(t),setTimeout(function(){try{o(!0),discountNinja.Cart.Shopify.IsDirty=!0,discountNinja.Cart.Shopify.UpdateCart(function(){try{discountNinja.DiscountedCart.IsDirty=!0,discountNinja.DiscountedCart.BuildDiscountedCart(function(){!function(t){try{discountNinja_Script_Checkout_Shopify.RequiresAdvancedCheckout()?(setTimeout(function(){discountNinja.Logging.LogErrorMessage("Checkout.Shopify.RegisterEventHandlerForCheckout.onCheckoutViaButtonInner","Timed out, redirecting to standard checkout"),i("Timeout")},3e4),attempt=1,c()):i("No advanced checkout required")}catch(t){discountNinja.Logging.LogErrorMessage("Checkout.Shopify.RegisterEventHandlerForCheckout.onCheckoutViaButtonInner",t),discountNinja_Script_Checkout_Shopify.ProcessingCheckout=!1}}()})}catch(t){discountNinja.Logging.LogError("Checkout.Shopify.RegisterEventHandlerForCheckout.onCheckoutViaButtonAfterUpdateCart",t),discountNinja_Script_Checkout_Shopify.ProcessingCheckout=!0,i("Build discounted cart failed")}})}catch(t){discountNinja.Logging.LogError("Checkout.Shopify.RegisterEventHandlerForCheckout.onCheckoutViaButtonAfterTimeout",t),discountNinja_Script_Checkout_Shopify.ProcessingCheckout=!0,i("UpdateCart failed")}},200),t)}catch(t){discountNinja.Logging.LogError("Checkout.Shopify.RegisterEventHandlerForCheckout.onCheckoutViaButton",t),discountNinja_Script_Checkout_Shopify.ProcessingCheckout=!1}}function u(t){if(discountNinja_Script_Checkout_Shopify.InitiatedCheckout=!0,!discountNinja_Script_Checkout_Shopify.RedirectingToCheckout){let i=s(t);if(null!==i)return t=i,!1}}try{if(!discountNinja.Settings.Settings)return;discountNinja.Logging.LogVerbose("Registering event handler for checkout");let t=discountNinja.Settings.GetFlag("UnregisterThirdPartyCheckoutClickEvents"),i=jQuery('.limoniapps-discountninja-checkoutbutton, :submit[name="checkout"], :submit[value="Checkout"], :submit[value="checkout"], :submit[value="CHECKOUT"], :submit[value="CheckOut"], .limoniapps-discountninja-checkout-submit').not(".limoniapps-discountninja-ignore");i.off(".discountNinja.checkout"),t&&jQuery(i).off("click touch"),i.each(function(){jQuery(this).on("click.discountNinja.checkout touch.discountNinja.checkout",function(t){if(!1===u(t))return!1})});let n=jQuery('a[href^="/checkout"]').not(".limoniapps-discountninja-ignore");n.off(".discountNinja.checkout"),t&&jQuery(n).off("click touch"),n.each(function(){jQuery(this).on("click.discountNinja.checkout touch.discountNinja.checkout",function(t){if(!1===u(t))return!1})});let e=jQuery('button[onclick*="/checkout"]').not(".limoniapps-discountninja-ignore");e.off(".discountNinja.checkout"),t&&jQuery(t).off("click touch"),e.each(function(){jQuery(this).on("click.discountNinja.checkout touch.discountNinja.checkout",function(t){if(!1===u(t))return!1})})}catch(t){discountNinja.Logging.LogError("Checkout.Shopify.RegisterEventHandlerForAddToCart",t)}},DiscountCodesReady:function(){return!0},RequiresAdvancedCheckout:function(){try{if(null===discountNinja.Settings||null===discountNinja.Settings.Settings)return!1;let t=discountNinja.Settings.Settings.CheckoutSettings.CheckoutMode;return"standard"===t?(discountNinja.Logging.LogVerbose("Configured to use standard checkout. Redirecting."),!1):"advanced"!==t||(discountNinja.Logging.LogVerbose("Configured to use advanced checkout mode."),function(){try{let t=discountNinja.DiscountCode.GetAutomaticDiscountCodes();return!(!t||0===t.length)}catch(t){return discountNinja.Logging.LogVerbose("ActivePromotionRequiresDraftOrder failed "+t),!1}}())}catch(t){discountNinja.Logging.LogError("Checkout.Shopify.RequiresDraftOrderCheckout",t)}},BuildParameters:function(){try{let t=discountNinja.DeviceId.Get();return discountNinja.TestMode.TestMode?{shop:discountNinja.Core.Shop,m:t+"-"+moment().format("x"),version:discountNinja.Core.Version,testMode:!0,testModeToken:discountNinja.TestMode.TestModeToken}:{shop:discountNinja.Core.Shop,m:t+"-"+moment().format("x"),version:discountNinja.Core.Version}}catch(t){return discountNinja.Logging.LogError("Checkout.Shopify.BuildParameters",t),null}},BuildPayLoadLogEvent:function(){try{return function(){try{return{DiscountCodes:discountNinja.DiscountCode.GetActiveDiscountCodes(),DeviceId:discountNinja.DeviceId.Get()}}catch(t){return discountNinja.Logging.LogError("Checkout.Shopify.BuildPayLoad.BuildPayLoadLogEvent",t),null}}()}catch(t){return discountNinja.Logging.LogError("Checkout.Shopify.BuildPayLoadLogEvent",t),null}},BuildPayLoad:function(){function t(t){try{let i=[],n=t.properties;if(null===n)return null;for(let t in n)i.push({Name:t,Value:n[t]});return i}catch(t){return null}}function i(){try{let i=[],n=window.discountNinjaContext&&window.discountNinjaContext.Cart&&window.discountNinjaContext.Cart.items?window.discountNinjaContext.Cart.items:null;if(n&&n.length>0)for(let e=0;e<n.length;e++)i.push({Quantity:n[e].quantity,VariantId:n[e].variant_id,ProductHandle:n[e].handle,Token:discountNinja.Offer.GetTokenForProductFromCache(n[e].handle),Properties:t(n[e])});return i}catch(t){return null}}function n(){try{let t=[],i=window.discountNinjaContext&&window.discountNinjaContext.Cart?window.discountNinjaContext.Cart.attributes:null;if(null===i)return null;for(let n in i)t.push({Name:n,Value:i[n]})}catch(t){return null}}function e(){try{let t=jQuery('form[action^="/cart"]').attr("action");return discountNinja.QueryParameter.Get("locale",t)}catch(t){return null}}function o(){try{let t=jQuery('form[action^="/cart"] [name="note"]').val();return void 0===t?null:t}catch(t){return null}}try{return function(){try{return{LineItems:i(),DiscountCodes:discountNinja.DiscountCode.GetActiveDiscountCodes(),Attributes:n(),DeviceId:discountNinja.DeviceId.Get(),Locale:e(),Note:o(),Currency:discountNinjaContext.PresentmentCurrency}}catch(t){return discountNinja.Logging.LogError("Checkout.Shopify.BuildPayLoad.BuildOrderDetailsJson",t),null}}()}catch(t){return discountNinja.Logging.LogError("Checkout.Shopify.BuildPayLoad",t),null}},PrepareAdvancedCheckout:function(){function t(t){discountNinja.Logging.LogVerbose("Prepared advanced checkout: "+t)}function i(){discountNinja.Logging.LogVerbose("Failed to prepare advanced checkout.")}function n(){discountNinja_Script_Checkout_Shopify.RequiresAdvancedCheckout()?discountNinja.XmlHttpRequest.Send(discountNinja_Script_Checkout_Shopify.ServerUrl()+"/api/PrepareCheckoutUrl",discountNinja_Script_Checkout_Shopify.BuildParameters(),discountNinja_Script_Checkout_Shopify.BuildPayLoad(),"post",!0,!0,t,i,1,2):discountNinja.Logging.LogVerbose("Advanced checkout not required")}try{discountNinja.Cart.Shopify.UpdateCart(function(){discountNinja.DiscountedCart.BuildDiscountedCart(n)})}catch(t){discountNinja.Logging.LogError("Checkout.Shopify.PrepareAdvancedCheckout",t)}}},discountNinja_Script_Environment_Shopify={MyShopifyDomain:function(){let t="";try{t=("undefined"!=typeof discountNinjaContext&&discountNinjaContext?discountNinjaContext.Shop:null)||Shopify.shop}catch(t){discountNinja.Logging.LogError("Environment.Shopify.MyShopifyDomain",t)}try{if(null==t||""===t){let i="undefined";"undefined"!=typeof Shopify&&void 0!==Shopify&&(i=JSON.stringify(Shopify)),t=window.top.location.hostname,discountNinja.Logging.LogErrorMessage("Environment.Shopify.MyShopifyDomain","GetMyShopifyDomain could not retrieve domain from Shopify.shop property. Shopify object is "+i+". Falling back to URL hostname ("+t+").")}return t}catch(t){discountNinja.Logging.LogError("Environment.Shopify.MyShopifyDomain",t)}},UrlPath:function(){try{return discountNinja_Script_Environment_Shopify.TrimmedPathName().toLowerCase()}catch(t){return discountNinja.Logging.LogError("Environment.Shopify.UrlPath",t),""}},IsSearchPage:function(){return"/search"===discountNinja_Script_Environment_Shopify.UrlPath()},IsAccountPage:function(){let t=discountNinja_Script_Environment_Shopify.UrlPath();return"/account"===t||t.indexOf("/account/")>-1},IsCartPage:function(){return"/cart"===discountNinja_Script_Environment_Shopify.UrlPath()},IsProductPage:function(){return discountNinja_Script_Environment_Shopify.UrlPath().indexOf("/products/")>-1},IsCollectionPage:function(){let t=discountNinja_Script_Environment_Shopify.UrlPath();return"/collections"===t||-1===t.indexOf("/products/")&&t.indexOf("/collections/")>-1},IsHomePage:function(){let t=discountNinja_Script_Environment_Shopify.UrlPath();return""===t||"/"===t},IsBlogPost:function(){return discountNinja_Script_Environment_Shopify.UrlPath().indexOf("/blogs/")>-1},IsCustomPage:function(){return discountNinja_Script_Environment_Shopify.UrlPath().indexOf("/pages/")>-1},IsCatalogPage:function(){return discountNinja_Script_Environment_Shopify.IsCollectionPage()&&"all"===discountNinja_Script_Environment_Shopify.CollectionHandle().toLowerCase()},BlogHandle:function(){try{let t=discountNinja_Script_Environment_Shopify.TrimmedPathName(),i=t.indexOf("/blogs/");if(-1===i)return null;let n=t.indexOf("/",i+1);if(-1===n)return null;let e=t.indexOf("/",n+1);return-1===e?decodeURIComponent(t).substr(n+1):decodeURIComponent(t).substr(n+1,e-n-1)}catch(t){return discountNinja.Logging.LogError("Environment.Shopify.BlogHandle",t),null}},BlogPostHandle:function(){try{let t=discountNinja_Script_Environment_Shopify.TrimmedPathName(),i=t.indexOf("/blogs/");if(-1===i)return null;let n=t.indexOf("/",i+1);if(-1===n)return null;let e=t.indexOf("/",n+1);return-1===e?null:decodeURIComponent(t).substr(e+1)}catch(t){return discountNinja.Logging.LogError("Environment.Shopify.BlogPostHandle",t),null}},CollectionHandle:function(){try{let t=discountNinja_Script_Environment_Shopify.UrlPath();if(t.indexOf("/collections/")<0)return"";let i=(t=t.replace("/collections/","")).indexOf("/");return i<0?t:t.substr(0,i)}catch(t){return discountNinja.Logging.LogError("Environment.Shopify.CollectionHandle",t),""}},PageType:function(){return discountNinja_Script_Environment_Shopify.IsProductPage()?"product":discountNinja_Script_Environment_Shopify.IsCollectionPage()?"collection":discountNinja_Script_Environment_Shopify.IsHomePage()?"home":discountNinja_Script_Environment_Shopify.IsCartPage()?"cart":discountNinja_Script_Environment_Shopify.IsBlogPost()?"blogpost":discountNinja_Script_Environment_Shopify.IsCustomPage()?"custom":void 0},VariantId:function(){if(!discountNinja_Script_Environment_Shopify.IsProductPage())return null;try{let t=document.querySelector("form[action^='/cart/add'] [name^='id']");null!==t&&0===t.length&&(t=document.querySelector("form [name^='id']"));let i=null;if(null!==t&&"object"==typeof t.options&&"number"==typeof t.selectedIndex&&void 0!==t.options[t.selectedIndex]?i=t.options[t.selectedIndex].value:null!==t&&"string"==typeof t.value&&(i=t.value),null!=i&&""!==i&&0!==i&&!isNaN(i))return discountNinja.Logging.LogVerbose("Returning variant from form: "+i),discountNinja.Utilities.GetNumberFromHtmlFragment(i)}catch(t){discountNinja.Logging.LogError("Environment.Shopify.VariantId",t,!1)}try{let t=discountNinja.QueryParameter.Get("variant");if(null!=t&&""!==t)return discountNinja.Logging.LogVerbose("Returning variant from query parameter: "+t),t}catch(t){discountNinja.Logging.LogError("Environment.Shopify.VariantId",t,!1)}try{let t=discountNinja.LiquidData.ProductDefaultVariantId();if(null!=t&&""!==t)return discountNinja.Logging.LogVerbose("Returning variant from liquid: "+t),t}catch(t){discountNinja.Logging.LogError("Environment.Shopify.VariantId",t,!1)}return discountNinja.Logging.LogErrorMessage("Environment.Shopify.VariantId","No variant information found"),null},TrimmedPathName:function(){try{let t=window.location.pathname;return null===t||""===t?t:("/"===t.slice(-1)&&(t=t.substr(0,t.length-1)),t)}catch(t){return discountNinja.Logging.LogError("Environment.Shopify.GetLastPartOfPathName",t),null}},ProductHandle:function(){try{let t=discountNinja_Script_Environment_Shopify.TrimmedPathName();return-1===t.indexOf("/products/")?null:decodeURIComponent(t).substr(t.lastIndexOf("/")+1)}catch(t){return discountNinja.Logging.LogError("Environment.Shopify.ProductHandle",t),null}},CustomPageHandle:function(){try{let t=discountNinja_Script_Environment_Shopify.TrimmedPathName();return-1===t.indexOf("/pages/")?null:decodeURIComponent(t).substr(t.lastIndexOf("/")+1)}catch(t){return discountNinja.Logging.LogError("Environment.Shopify.CustomPageHandle",t),null}},IsCustomer:function(){return void 0!==window.discountNinjaContext&&null!==window.discountNinjaContext.Customer},CustomerTags:function(){return null!==window.discountNinjaContext.Customer&&null!==window.discountNinjaContext.Customer.Tags?window.discountNinjaContext.Customer.Tags:null}},discountNinja_Script_DiscountCode={HideFeedbackTimeoutHandle:null,ServerUrl:function(){return"prod"===discountNinja.Core.Environment?"https://promotionapi-afd.discountninja.io":"https://discountninjav2-promotionapi-dev.azurewebsites.net"},InjectDiscountCodesInHtmlElements:function(t,i){function n(t,i){try{return discountNinja.QueryParameter.RemoveFromUrl(t,"discount",i).replace(/attributes\[limoniapps\-discounturl\]\=(.)*(\&)?/g,"")}catch(t){discountNinja.Logging.LogError("DiscountCode.UndoInjectDiscountCodeInUrl",t)}}function e(t,i){try{return discountNinja.QueryParameter.AppendToUrl(t,"discount",i,!0)}catch(t){discountNinja.Logging.LogError("DiscountCode.AppendDiscountCodeToUrl",t)}}try{jQuery('a[href^="/checkout"]').each(function(){if(jQuery(this).hasClass("discountninja-ignore"))return;let o=jQuery(this).attr("href"),r=i?n(o,t):e(o,t);jQuery(this).attr("href",r)}),jQuery('form[action^="/checkout"]').each(function(){if(jQuery(this).hasClass("discountninja-ignore"))return;let o=jQuery(this).attr("action"),r=i?n(o,t):e(o,t);jQuery(this).attr("action",r)}),jQuery('button[onclick*="/checkout"]').each(function(){try{if(jQuery(this).hasClass("discountninja-ignore"))return;let o=jQuery(this).attr("onclick"),r=o.match(/(['"]){1}(.)*(['"])/g);if(null!==r&&1===r.length){let a=r[0];if(a.length>2){let r=a.substr(1,a.length-2),c=i?n(r,t):e(r,t);jQuery(this).attr("onclick",o.replace(r,c))}}}catch(t){}}),jQuery('form[action="/cart"], form[action^="/cart?"]').each(function(){if(jQuery(this).hasClass("discountninja-ignore"))return;let o=jQuery(this).attr("method");if(o&&"post"===o.toLowerCase()){let o=jQuery(this).attr("action"),r=i?n(o,t):e(o,t);jQuery(this).attr("action",r)}}),jQuery('form[action^="/checkout"]').find(":submit").addClass("saso-ignore")}catch(t){discountNinja.Logging.LogError("DiscountCode.InjectDiscountCodesInHtmlElements",t)}},UndoInjectDiscountCodesInHtml:function(){try{let t=discountNinja.Offer.Offers;if(!t)return;for(let i=0;i<t.length;i++)discountNinja_Script_DiscountCode.InjectDiscountCodesInHtmlElements(discountNinja_Script_DiscountCode.GetDiscountCode(t[i].Token),!0)}catch(t){discountNinja.Logging.LogError("DiscountCode.UndoInjectDiscountCodesInHtml",t)}},InjectDiscountCodesInHtml:function(){try{let t=discountNinja_Script_DiscountCode.GetFirstActiveDiscountCodeForCheckout(!1);if(""===t)return;discountNinja_Script_DiscountCode.InjectDiscountCodesInHtmlElements(t,!1),function(t){try{let i=jQuery('form[action^="/checkout"]');if(null!==i&&i.length>0){let t=0;i.each(function(){if(jQuery(this).hasClass("discountninja-ignore"))return;let i=jQuery(this).find('input[name="discount"]');null!==i&&0!==i.length||(jQuery("<input>").attr("type","hidden").attr("name","discount").addClass("limoniapps-discountninja-discount-attribute").attr("id","limoniapps-discountninja-discount-attribute-"+t).appendTo(this),t++)})}jQuery('form[action^="/checkout"], form[action^="/cart"] input[name="discount"], .limoniapps-discountninja-discount-attribute').each(function(){jQuery(this).hasClass("discountninja-ignore")||jQuery(this).attr("value",t)})}catch(t){discountNinja.Logging.LogError("UpdateFormInputDiscountCode",t)}}(t),discountNinja.Logging.ShowTimeElapsed("Inject discount code in HTML complete")}catch(t){discountNinja.Logging.LogError("DiscountCode.InjectDiscountCodesInHtml",t)}},GetFromCache:function(){try{let t=discountNinja.Cache.SessionGet("discountcode-data");return null===(t="undefined"===t?[]:JSON.parse(t))?[]:t}catch(t){return discountNinja.Logging.LogError("DiscountCode.GetFromCache",t),[]}},SaveToCache:function(t){try{discountNinja.Cache.SessionSet("discountcode-data",JSON.stringify(t))}catch(t){discountNinja.Logging.LogError("DiscountCode.SaveToCache",t)}},GetExternalDiscountCodesFromCache:function(){try{let t=discountNinja.Cache.SessionGet("discountcode-external-data");return null===(t="undefined"===t?[]:JSON.parse(t))?[]:t}catch(t){return discountNinja.Logging.LogError("DiscountCode.GetExternalDiscountCodesFromCache",t),[]}},LockDiscountCodeFieldIfRequired:function(){let t=jQuery("input.limoniapps-discountninja-cartdiscountfield-input"),i=jQuery(".limoniapps-discountninja-cartdiscountfield-apply");if(!discountNinja.Settings.Settings.CartSettings.AllowMultipleDiscountCodes){if(discountNinja.DiscountCodeTrigger.Get().length>0)return void function(t,i){t.prop("disabled",!0),i.addClass("disabled")}(t,i)}!function(t,i){t.prop("disabled",!1),i.removeClass("disabled")}(t,i)},UpdateTags:function(){let t=".limoniapps-discountninja-cartdiscountfield-",i=jQuery(t+"discountcodes");jQuery(i).empty();let n=jQuery(t+"discountcode-template").html(),e=discountNinja.DiscountCodeTrigger.Get();for(let t=0;t<e.length;t++){let o=n.replace(/\[\[DISCOUNT_CODE\]\]/g,e[t].discountCode);i.append(o)}},Process:function(){discountNinja_Script_DiscountCode.UpdateTags(),discountNinja_Script_DiscountCode.LockDiscountCodeFieldIfRequired();let t=discountNinja_Script_Offer.CombinePromotionsFromTokenAndDiscountCode();discountNinja.Offer.Offers=t.Offers,discountNinja.Offer.Triggers=t.Triggers,discountNinja.Offer.ExpireAll()},AddDiscountCodeFromLookup:function(t){discountNinja_Script_DiscountCode.AddDiscountCode(t,!0)},AddDiscountCode:function(t,i){function n(){d.prop("disabled",!1),l.removeClass("disabled")}function e(){n(),jQuery(c).hide(),jQuery(u).show()}function o(){jQuery(s).show()}function r(t){discountNinja_Script_DiscountCode.HideFeedbackTimeoutHandle=setTimeout(function(){jQuery(s).hide(),jQuery(u).hide()},t)}let a=".limoniapps-discountninja-cartdiscountfield-",c=a+"searching",s=a+"applied",u=a+"notfound",d=jQuery("input"+a+"input"),l=jQuery(".limoniapps-discountninja-cartdiscountfield-apply");try{if(!t||""===t)return;i&&(d.prop("disabled",!0),l.addClass("disabled"),jQuery(c).show(),jQuery(s).hide(),jQuery(u).hide()),discountNinja_Script_DiscountCode.HideFeedbackTimeoutHandle&&clearTimeout(discountNinja_Script_DiscountCode.HideFeedbackTimeoutHandle),discountNinja.XmlHttpRequest.Send(discountNinja_Script_DiscountCode.ServerUrl()+"/api/GetDiscountDetails",function(t){try{let i={},n=null===discountNinja.Cache.SessionGet("discountcode-promotiondata-requested-"+t),e=discountNinja.Core.Shop,o=discountNinja.Utilities.GetReferrer();e&&(i.shop=e),t&&(i.discountCode=t),null!==discountNinja.TestMode.TestMode&&(i.testMode=discountNinja.TestMode.TestMode,i.matchByTokenOnly=discountNinja.TestMode.MatchByTokenOnly,i.testModeToken=discountNinja.TestMode.TestModeToken),null!==n&&(i.firstRequest=n),o&&(i.referrer=o),i.m=moment().format("x");let r=discountNinja.DeviceId.Get();return i.deviceId=r,i}catch(t){return discountNinja.Logging.LogError("Offer.LoadPromotionInfo.BuildParameters",t),null}}(t),null,"get",!0,!0,function(e){i&&(jQuery(c).hide(),n(),d.val("")),e&&"false"!==e?(e.DiscountCodeDetails?(i&&o(),function(t,i,n){try{null===i&&discountNinja.Logging.LogWarning("DiscountCode.AddExternal - No discountcode provided",!0,!1,!1);let e=discountNinja_Script_DiscountCode.GetExternalDiscountCodesFromCache(),o=e.length;for(;o--;)e[o]&&e[o].DiscountCode===i&&e.splice(o,1);e.push({Token:null,DiscountCode:i,PriceRuleId:t,TargetType:n}),discountNinja_Script_DiscountCode.InjectDiscountCodesInHtml(),function(t){try{discountNinja.Cache.SessionSet("discountcode-external-data",JSON.stringify(t))}catch(t){discountNinja.Logging.LogError("DiscountCode.SaveExternalDiscountCodesToCache",t)}}(e)}catch(t){discountNinja.Logging.LogError("DiscountCode.AddExternal",t)}}(e.DiscountCodeDetails.PriceRuleId,e.DiscountCodeDetails.DiscountCode,e.DiscountCodeDetails.TargetType)):null===e.Offers||0===e.Offers.length||null===e.Triggers||0===e.Triggers.length?(jQuery(u).show(),i&&r(4e3)):(i&&o(),discountNinja.DiscountCodeTrigger.Add(t,e),discountNinja.Cache.SessionSet("discountcode-promotiondata-requested-"+t,!0),discountNinja_Script_DiscountCode.Process()),i&&r(4e3)):(jQuery(u).show(),i&&r(4e3)),discountNinja_Script_DiscountCode.LockDiscountCodeFieldIfRequired()},function(){i&&(e(),r(4e3))})}catch(t){discountNinja.Logging.LogError("DiscountCode.AddExternalDiscountCode",t),i&&(e(),discountNinja_Script_DiscountCode.HideFeedbackTimeoutHandle=setTimeout(function(){jQuery(u).hide()},4e3))}},Add:function(t,i,n,e){try{null!==i&&null!==n||discountNinja.Logging.LogWarning("DiscountCode.Add - No discountcode or priceruleid available",!0,!1,!1);let o=discountNinja_Script_DiscountCode.GetFromCache(),r=o.length;for(;r--;)o[r]&&o[r].Token===t&&o.splice(r,1);o.push({Token:t,DiscountCode:i,PriceRuleId:n,TargetType:e}),discountNinja_Script_DiscountCode.InjectDiscountCodesInHtml(),discountNinja_Script_DiscountCode.SaveToCache(o)}catch(t){discountNinja.Logging.LogError("DiscountCode.Add",t)}},Remove:function(t){try{let i=discountNinja_Script_DiscountCode.GetFromCache(),n=[];for(let e=0;e<i.length;e++)i[e].Token!==t&&n.push(i[e]);discountNinja_Script_DiscountCode.SaveToCache(n)}catch(t){discountNinja.Logging.LogError("DiscountCode.Remove",t)}},RemoveTag:function(t){try{let i=jQuery(t).parent(".limoniapps-discountninja-cartdiscountfield-discountcode").attr("data-discountcode");discountNinja.DiscountCodeTrigger.RemoveAndUpdateTags(i)}catch(t){discountNinja.Logging.LogError("DiscountCode.RemoveTag",t)}},Clear:function(){discountNinja.Cache.SessionRemove("discountcode-data")},GetActiveDiscountCodesForCheckoutAsArray:function(){try{let t=discountNinja_Script_DiscountCode.GetActiveDiscountCodes(),i=[];for(let n=0;n<t.length;n++)i.push(t[n].DiscountCode);return i}catch(t){return discountNinja.Logging.LogError("DiscountCode.GetActiveDiscountCodesForCheckoutAsArray",t),[]}},GetAutomaticDiscountCodes:function(t){try{let t=discountNinja_Script_DiscountCode.GetActiveDiscountCodes(),i=[];for(let n=0;n<t.length;n++){let e=t[n].DiscountCode,o=t[n].PriceRuleId;o&&!isNaN(parseInt(o))||i.push(e)}return i}catch(t){return discountNinja.Logging.LogError("DiscountCode.GetAutomaticDiscountCodes",t),[]}},GetFirstActiveDiscountCodeForCheckout:function(t){return function(i){if(null===i||0===i.length)return"";for(let n=0;n<i.length;n++){let e=i[n].DiscountCode;if(i[n].PriceRuleId)return t?discountNinja.Utilities.EncodeUriComponentComponentForQueryString(e):e}return""}(discountNinja_Script_DiscountCode.GetActiveDiscountCodes())},GetActiveDiscountCodes:function(){try{let t=discountNinja_Script_DiscountCode.GetFromCache();discountNinja.Logging.LogVerbose(t.length+" codes found in cache");let i=[];for(let n=0;n<t.length;n++){let e=t[n];if(null!==e&&""!==e.DiscountCode)if("line_item"===e.TargetType){let t=discountNinja.DiscountedCart.DiscountedCart;if(t&&t.items.length>0)for(let n=0;n<t.items.length;n++)if(t.items[n].Token===e.Token){discountNinja.Logging.LogVerbose("Discount code added to active list for token "+e.Token),i.push(e);break}}else discountNinja.Logging.LogVerbose("Shipping code added to active list"),i.push(e)}let n=discountNinja.DiscountedCart.DiscountedCart;if(n&&n.items.length>0)for(let t=0;t<n.items.length;t++){let e=n.items[t],o=e.Token;discountNinja.Logging.LogVerbose("Discount code added to active list for token "+o),i.push({Token:o,DiscountCode:e.DiscountCode,PriceRuleId:e.PriceRuleId,TargetType:e.TargetType})}if(discountNinja.Offer.Offers)for(let t=0;t<discountNinja.Offer.Offers.length;t++){let n=discountNinja.Offer.Offers[t];if("line_item"===n.Entitlement.TargetType&&"across"===n.Entitlement.AllocationMethod){let t=discountNinja.DiscountTier.GetCurrentDiscountTier(n);if(t){let e=t.DiscountCode.Code,o=t.DiscountCode.PriceRuleId;i.push({Token:n.Token,DiscountCode:e,PriceRuleId:o,TargetType:n.Entitlement.TargetType})}}}let e=discountNinja.Cookie.GetDiscountCodeCookie();e&&(discountNinja.Logging.LogVerbose("Native shareable link code added to active list"),i.push({Token:null,DiscountCode:e,PriceRuleId:null,TargetType:null}));let o=discountNinja_Script_DiscountCode.GetExternalDiscountCodesFromCache();if(o)for(let t=0;t<o.length;t++)discountNinja.Logging.LogVerbose("External code added to active list"),i.push(o[t]);let r=[];for(let t=0;t<i.length;t++){let n=!0;if(i[t]&&i[t].DiscountCode){for(let e=0;e<r.length;e++)if(r[e].DiscountCode===i[t].DiscountCode){null===r[e].Token&&i[t].Token,null===r[e].PriceRuleId&&i[t].PriceRuleId,null===r[e].TargetType&&i[t].TargetType,n=!1;break}n&&r.push(i[t])}}return r}catch(t){return discountNinja.Logging.LogError("DiscountCode.GetActiveDiscountCodes",t),[]}},GetActiveDiscountCodesForCheckoutAsString:function(){try{let t=discountNinja_Script_DiscountCode.GetActiveDiscountCodesForCheckoutAsArray(),i=0===t.length?"":t.join(",");return discountNinja.Utilities.EncodeUriComponentComponentForQueryString(i)}catch(t){return discountNinja.Logging.LogError("DiscountCode.GetActiveDiscountCodesForCheckoutAsString",t),""}},GetActiveLineItemDiscountCodes:function(){try{let t=discountNinja_Script_DiscountCode.GetFromCache(),i=[];for(let n=0;n<t.length;n++){let e=t[n];null!==e&&""!==e.DiscountCode&&"line_item"===e.TargetType&&i.push(e.DiscountCode)}return 0===i.length?"":i.join(",")}catch(t){return discountNinja.Logging.LogError("DiscountCode.GetActiveLineItemDiscountCodes",t),""}},GetDiscountCode:function(t){try{let i=discountNinja_Script_DiscountCode.GetFromCache();for(let n=0;n<i.length;n++)if(i[n].Token===t)return i[n].DiscountCode;return null}catch(t){return discountNinja.Logging.LogError("DiscountCode.GetDiscountCode",t),null}},GetPromotionForDiscountCode:function(t){try{let n=discountNinja.Offer.Offers;if(!n)return null;for(let e=0;e<n.length;e++)for(var i=0;i<5;i++)if(n[e].Tiers[i]&&n[e].Tiers[i].DiscountCode.Code===t)return n[e];return null}catch(t){return discountNinja.Logging.LogError("DiscountCode.GetPromotionForDiscountCode",t),null}},EnableDiscountCodeField:function(){try{if(!0===discountNinja.Settings.Settings.CartSettings.CartDiscountField){let t=".limoniapps-discountninja-cartdiscountfield-",i=t+"wrapper",n=t+"placeholder",e=jQuery(n);if(e.length>0){let o=jQuery(i).html();e.html(o);let r=n+" input"+t+"input";jQuery(n+" "+t+"apply").click(function(){let t=jQuery(r).val();discountNinja_Script_DiscountCode.AddDiscountCodeFromLookup(t)}),jQuery(r).keypress(function(t){var i=t.keyCode?t.keyCode:t.which;if("13"===i||13===i){let i=jQuery(this).val();discountNinja_Script_DiscountCode.AddDiscountCodeFromLookup(i),t.preventDefault&&t.preventDefault(),t.stopPropagation&&t.stopPropagation(),t.returnValue=!1}}),e.find(i).show()}}}catch(t){discountNinja.Logging.LogError("DiscountCode.EnableDiscountCodeField",t)}}},discountNinja_Script_DiscountCodeTrigger={SessionStorageKeyTriggers:"triggersfromdiscountcode",Get:function(){let t=discountNinja.Cache.SessionGet(discountNinja_Script_DiscountCodeTrigger.SessionStorageKeyTriggers);return t?JSON.parse(t):[]},Save:function(t){discountNinja.Cache.SessionSet(discountNinja_Script_DiscountCodeTrigger.SessionStorageKeyTriggers,JSON.stringify(t))},FindByDiscountCode:function(t,i){for(let n=0;n<i.length;n++)if(i[n].discountCode.toLowerCase()===t.toLowerCase())return i[n];return null},Add:function(t,i){let n=discountNinja_Script_DiscountCodeTrigger.Get();discountNinja_Script_DiscountCodeTrigger.FindByDiscountCode(t,n)||n.push({discountCode:t,trigger:i}),discountNinja_Script_DiscountCodeTrigger.Save(n)},Remove:function(t){let i=discountNinja_Script_DiscountCodeTrigger.Get(),n=[];for(let e=0;e<i.length;e++)i[e].discountCode.toLowerCase()!==t.toLowerCase()&&n.push(i[e]);discountNinja_Script_DiscountCodeTrigger.Save(n)},RemoveAndUpdateTags:function(t){discountNinja_Script_DiscountCodeTrigger.Remove(t),discountNinja.DiscountCode.Process()}},discountNinja_Script_DiscountedCart={IsDirty:!0,DiscountedCart:null,Get:function(t){try{if(null===discountNinja_Script_DiscountedCart.DiscountedCart)return null;for(let i=0;i<discountNinja_Script_DiscountedCart.DiscountedCart.items.length;i++){let n=discountNinja_Script_DiscountedCart.DiscountedCart.items[i];if(n.Key===t)return n}return null}catch(t){return discountNinja.Logging.LogError("DiscountedCart.Get",t),null}},BuildDiscountedCart:function(t){function i(t,i,n,e,o,r,a,c){try{discountNinja.Logging.LogVerbose("Evaluating if item with key "+i+" and handle "+n+" must be added to discounted cart");let s=i.split(":")[0],u=discountNinja.Offer.GetOfferForCartItem(i,n,s,c,r,e,o),d=e/100;if(u&&"shipping_line"!==u.Entitlement.TargetType){let c=discountNinja.DiscountedProduct.Get(i,s,n,e,o,r,u),l=discountNinja.DiscountedProduct.Get(i,s,n,e,o,r,u,a);if(l){discountNinja.Logging.LogVerbose("Adding "+a+" item(s) with key "+i+" and handle "+n+" to discounted cart, applying offer "+u.Token+", discounted price is "+c.DiscountedPrice);let e=discountNinja.DiscountTier.GetCurrentDiscountTier(u),o=discountNinja.Prerequisite.EntitledQuantity(u,e)||a,r=Math.max(0,a-o);u.AttributedQuantity=u.AttributedQuantity+o;let s=-1;for(let n=0;n<t.items.length;n++)if(t.items[n].Key===i){s=n;break}discountedPrice=l.DiscountedPrice;let g=discountNinja.Utilities.RoundToNumberOfDigits(discountedPrice/a*o,2);g+=discountNinja.Utilities.RoundToNumberOfDigits(d*r,2),t.total_discounted_price+=g,l.DiscountedPrice=g;let p=Math.min(l.Amount/a,d-discountedPrice/a),f=discountNinja.Utilities.RoundToNumberOfDigits(p*o,2);l.Amount=f,l.Percentage=Math.min(0===l.EffectiveCompareAtPrice?0:Math.abs(f/l.EffectiveCompareAtPrice*100),100),l.QuantityDiscounted=o,l.QuantityNotDiscounted=r,t.total_discount+=f;let m=function(t,i,n){let e={Key:i.Key,Product:i,Line:n,Token:t.Token,TargetType:t.Entitlement.TargetType,DiscountCode:discountNinja.Offer.GetPromotionDiscountCode(t),PriceRuleId:discountNinja.Offer.GetPromotionPriceRule(t)};try{delete e.Product.Key,delete e.Line.Key,delete e.Product.Token,delete e.Line.Token}catch(t){}return e}(u,c,l);-1===s?(discountNinja.Logging.LogVerbose("Adding line in discounted cart"),t.items.push(m)):(discountNinja.Logging.LogVerbose("Updating line discounted cart"),t[s]=m)}else t.total_discounted_price+=d*a}else t.total_discounted_price+=d*a;return t.total_original_price+=d*a,t}catch(i){return discountNinja.Logging.LogError("DiscountedCart.AddDiscountedCartItem",i),t}}function n(){for(let t=0;t<discountNinja.Offer.Offers.length;t++)discountNinja.Offer.Offers[t].AttributedQuantity=0}function e(){try{if(discountNinja.Logging.LogVerbose("Building discounted cart - START"),!discountNinja_Script_DiscountedCart.IsDirty)return discountNinja.Logging.LogVerbose("Building discounted cart - Assumed not dirty"),null!=t&&"function"==typeof t?t():null;let o=discountNinja.Offer.Offers;if(o&&0!==o.length){discountNinja.Logging.LogVerbose("Building discounted cart - Offers available, continuing");let t=window.discountNinjaContext.Cart;if(discountNinja_Script_DiscountedCart.IsDirty=!1,discountNinja_Script_DiscountedCart.ClearCartValueCache(),void 0!==t&&void 0!==t.items){let o={items:[],total_discounted_price:(0,0),total_discount:(0,0),total_original_price:0};n();let r=function(t){let i=[];for(let n=0;n<t.items.length;n++)if(t.items[n].properties)for(let e in t.items[n].properties)if(e.indexOf("DiscountNinja.FreeGift")>-1||e.indexOf("DiscountNinja.Discounted")>-1){i.push(t.items[n]);break}for(let n=0;n<t.items.length;n++){let e=!1;for(let o=0;o<i.length;o++)if(t.items[n].key===i[o].key){e=!0;break}e||i.push(t.items[n])}return i.sort(function(t,i){return t.original_price<i.original_price?-1:t.original_price>i.original_price?1:0}),i}(t);for(let t=0;t<r.length;t++){discountNinja.Logging.LogVerbose("Building discounted cart - Evaluating cart item "+t);let n=discountNinja.ProductData.GetByProductHandle(r[t].handle,!0);n?(discountNinja.Logging.LogVerbose("Building discounted cart - Promotion data found for cart item "+t+" with key "+r[t].key+" and handle "+r[t].handle),o=i(o,r[t].key,r[t].handle,r[t].original_price,n.CompareAtPrice,n.Inventory,r[t].quantity,n.Collections)):discountNinja.Logging.LogVerbose("Building discounted cart - No offer data found for cart item "+t+" with key "+r[t].key+" and handle "+r[t].handle)}if(discountNinja.Offer.Offers){var e=[];for(let t=0;t<discountNinja.Offer.Offers.length;t++){let i=discountNinja.Offer.Offers[t];if("line_item"===i.Entitlement.TargetType&&"across"===i.Entitlement.AllocationMethod&&discountNinja.Offer.OfferIsApplicable(i)){let t=discountNinja.DiscountTier.GetCurrentDiscountTier(i);if(t){let n=discountNinja.Offer.EligibleItemsCartValue(i)/100,o=Math.min(n,t.Entitlement.Amount);e.push(o)}}}if(e.length>0)if("sum"===discountNinja.Settings.Settings.CheckoutSettings.DiscountCumulationMode)for(let t=0;t<e.length;t++){let i=e[t];o.total_discounted_price<i&&(i=o.total_discounted_price),o.total_discounted_price-=i,o.total_discount+=i}else{let t=0;for(let i=0;i<e.length;i++){let n=e[i];n>t&&(t=n)}let i=t;o.total_discounted_price<i&&(i=o.total_discounted_price),o.total_discounted_price-=i,o.total_discount+=i}}n(),function(t){try{if(!t)return;let i=t.items;if(!i)return;for(let t=0;t<i.length;t++){let n=i[t];discountNinja.Offer.SetTokenForProductInCache(n.ProductHandle,n.Token)}}catch(t){discountNinja.Logging.LogError("DiscountedCart.EnsureTokensForCartProducts",t)}}(o),function(t){try{discountNinja.Cache.LocalSet("discounted-cart",JSON.stringify(t))}catch(t){discountNinja.Logging.LogError("DiscountedCart.SaveDiscountedCartToCache",t)}}(o),discountNinja_Script_DiscountedCart.DiscountedCart=o,discountNinja_Script_DynamicPricing.DrawerCartIsDirty=!0,discountNinja_Script_DynamicPricing.ClassicCartIsDirty=!0,discountNinja.Events.Publish("CartUpdated",[discountNinja.DiscountedCart.DiscountedCart])}else discountNinja.Logging.LogVerbose("Building discounted cart - Cart empty, aborting")}else discountNinja.Logging.LogVerbose("Building discounted cart - Offers unavailable, aborting");return null!=t&&"function"==typeof t?t():null}catch(t){discountNinja.Logging.LogError("DiscountedCart.BuildDiscountedCart",t)}null!=t&&"function"==typeof t&&t()}var o=0;!function t(){o++;let i=window.discountNinjaContext.Cart,n=!0;for(let t=0;t<i.items.length&&(discountNinja.ProductData.GetByProductHandle(i.items[t].handle,!0)||(n=!1),n);t++);!n||o>5?setTimeout(function(){t()},1e3):e()}()},GetCartItemKeys:function(){try{if(discountNinja_Script_DiscountedCart.DiscountedCart=function(){try{let t=discountNinja.Cache.LocalGet("discounted-cart");return"undefined"===t?null:JSON.parse(t)}catch(t){return discountNinja.Logging.LogError("DiscountedCart.GetDiscountedCartFromCache",t),null}}(),discountNinja_Script_DiscountedCart.DiscountedCart&&discountNinja_Script_DiscountedCart.DiscountedCart.items){let t="";for(let i=0;i<discountNinja_Script_DiscountedCart.DiscountedCart.items.length;i++)""!==t&&(t+=","),t+=discountNinja_Script_DiscountedCart.DiscountedCart.items[i].Key;return t}return""}catch(t){discountNinja.Logging.LogError("DiscountedCart.GetCartItemKeys",t)}},ClearCartValueCache:function(){discountNinja.Cache.SessionSet("CartValue",null)}},discountNinja_Script_DiscountedProduct={Get:function(t,i,n,e,o,r,a,c){try{c||(c=1);let s=discountNinja.DiscountTier.GetCurrentDiscountTier(a);if(null===s)return null;let u=a.Entitlement.ValueType,d=a.Entitlement.DiscountPriceType,l=s.Entitlement.Amount,g=s.Entitlement.Percentage,p=discountNinja.Settings.Settings.CurrencySettings.RoundPrices,f=discountNinja.Settings.Settings.CurrencySettings.RoundToCents,m={Key:t,VariantId:i,ProductHandle:n,OriginalPrice:e*c/100,OriginalCompareAtPrice:o*c/100,Amount:l*c>e*c?e*c:l*c,Percentage:Math.min(g,100)};(void 0===m.OriginalCompareAtPrice||null===m.OriginalCompareAtPrice||0===m.OriginalCompareAtPrice||isNaN(m.OriginalCompareAtPrice)||m.OriginalCompareAtPrice<m.OriginalPrice)&&(m.OriginalCompareAtPrice=m.OriginalPrice),m.EffectiveCompareAtPrice=m.OriginalCompareAtPrice,"price"===d&&(m.EffectiveCompareAtPrice=m.OriginalPrice);let N=m.EffectiveCompareAtPrice;if(N>0){if("fixed_amount"===u)m.DiscountedPrice=discountNinja.Utilities.RoundToNumberOfDigits(N-m.Amount,2),m.Percentage=Math.min(0===N?0:Math.abs(m.Amount/N*100),100);else if("percentage"===u){let t=N*m.Percentage/100,i=discountNinja.Utilities.FloorToNumberOfDigits(t,2);m.DiscountedPrice=discountNinja.Utilities.RoundToNumberOfDigits(N-i,2),m.Amount=Math.max(discountNinja.Utilities.RoundToNumberOfDigits(N-m.DiscountedPrice,2),0)}if(m.DiscountedPrice<0&&(m.DiscountedPrice=0),p){let t=100*m.DiscountedPrice;t>0&&(t=100*Math.floor(t/100)+f),m.DiscountedPrice=Math.round(t)/100}}else m.DiscountedPrice=0,m.Amount=0;return m.InventoryLeft=r,m.Token=a.Token,m.DiscountCode=s.DiscountCode.Code,m}catch(t){return discountNinja.Logging.LogError("DiscountedProduct.Get",t),null}},GetFromProductPage:function(){try{if(discountNinja.Environment.Shopify.IsProductPage()){let t=discountNinja.Environment.Shopify.ProductHandle(),i=discountNinja.Environment.Shopify.VariantId(),n=discountNinja.LiquidData.Price(i);if(null===n)return null;let e=discountNinja.LiquidData.CompareAtPrice(i),o=discountNinja.LiquidData.Inventory(i),r=discountNinja.Offer.GetOfferForProduct(t,i,null,o,n,e,!0,!0);return r?discountNinja_Script_DiscountedProduct.Get(null,i,t,n,e,o,r):null}return null}catch(t){discountNinja.Logging.LogError("DiscountedProduct.GetFromProductPage",t)}}},discountNinja_Script_DiscountTier={GetCurrentDiscountTierNumber:function(t,i){function n(t,i,n){try{if(!i||!t)return!1;let e=i.Prerequisite;if(!discountNinja.Offer.IsOfferAccepted(t.Token,t.Frequency))return!1;if(e.MinimumAmount&&n<100*e.MinimumAmount)return!1;if(e.MaximumAmount&&n>100*e.MaximumAmount)return!1;if(e.MinimumItems>0){if(discountNinja.Prerequisite.PrerequisiteItemsInCart(t,i)<e.MinimumItems)return!1}if(e.MaximumItems>0){if(discountNinja.Prerequisite.PrerequisiteItemsInCart(t,i)>e.MaximumItems)return!1}return!0}catch(t){return discountNinja.Logging.LogError("DiscountTier.DiscountTierIsApplicable",t),!1}}try{if(!discountNinja.Offer.OfferIsApplicable(t))return null;let e=n(t,t.Tiers[0],i),o=n(t,t.Tiers[1],i),r=n(t,t.Tiers[2],i),a=n(t,t.Tiers[3],i);return n(t,t.Tiers[4],i)?5:a?4:r?3:o?2:e?1:i>0?0:-1}catch(t){return discountNinja.Logging.LogError("DiscountTier.GetCurrentDiscountTierNumber",t),-1}},GetMaxDiscountTierNumber:function(t){try{return"object"==typeof t.Tiers[4]?5:"object"==typeof t.Tiers[3]?4:"object"==typeof t.Tiers[2]?3:"object"==typeof t.Tiers[1]?2:1}catch(t){return discountNinja.Logging.LogError("DiscountTier.GetMaxDiscountTierNumber",t),1}},GetCurrentDiscountTier:function(t){try{let i=discountNinja.Offer.PrerequisiteItemsCartValue(t),n=discountNinja_Script_DiscountTier.GetCurrentDiscountTierNumber(t,i);return null===n||0===n||-1===n?null:t.Tiers[n-1]}catch(t){return discountNinja.Logging.LogError("DiscountTier.GetCurrentDiscountTier",t),null}},GetGoalDiscountTierNumber:function(t){try{let i=discountNinja.Offer.PrerequisiteItemsCartValue(t),n=discountNinja_Script_DiscountTier.GetCurrentDiscountTierNumber(t,i);if(null===n)return null;let e=discountNinja_Script_DiscountTier.GetMaxDiscountTierNumber(t);return 5===n?-1:4===n?e<=4?-1:5:3===n?e<=3?-1:4:2===n?e<=2?-1:3:1===n?e<=1?-1:2:1}catch(t){return discountNinja.Logging.LogError("DiscountTier.GetGoalDiscountTier",t),null}},GetGoalDiscountTier:function(t){try{let i=discountNinja_Script_DiscountTier.GetGoalDiscountTierNumber(t);return null===i||-1===i?null:t.Tiers[i-1]}catch(t){return discountNinja.Logging.LogError("DiscountTier.GetGoalDiscountTier",t),null}},GetPercentageAmountFromDiscountTier:function(t){try{return t?{Percentage:t.Entitlement.Percentage,Amount:t.Entitlement.Amount}:null}catch(t){discountNinja.Logging.LogError("DiscountTier.GetPercentageAmountFromDiscountTier",t)}},GoalAchieved:function(t){try{let i=discountNinja.Offer.PrerequisiteItemsCartValue(t),n=discountNinja_Script_DiscountTier.GetCurrentDiscountTierNumber(t,i);return null!==n&&n>0}catch(t){return discountNinja.Logging.LogError("DiscountTier.GoalAchieved",t),!1}}};const discountNinja_Script_DynamicPricing_Classes_Prefix="limoniapps-discountninja-",discountNinja_Script_DynamicPricing_Classes_ProductPrice_Prefix=discountNinja_Script_DynamicPricing_Classes_Prefix+"productprice",discountNinja_Script_DynamicPricing_Attributes_Prefix="data-limoniapps-discountninja-";var discountNinja_Script_DynamicPricing={Classes:{Prefix:discountNinja_Script_DynamicPricing_Classes_Prefix,ProductPrice:{OriginalPrice:discountNinja_Script_DynamicPricing_Classes_ProductPrice_Prefix+"-original",ReplacedPrice:discountNinja_Script_DynamicPricing_Classes_ProductPrice_Prefix+"-replaced",ShowAfterReplace:discountNinja_Script_DynamicPricing_Classes_ProductPrice_Prefix+"-showafterreplace",HideAfterReplace:discountNinja_Script_DynamicPricing_Classes_ProductPrice_Prefix+"-hideafterreplace",Wrapper:discountNinja_Script_DynamicPricing_Classes_ProductPrice_Prefix+"-wrapper"},Cart:{PriceForLevel:"limoniapps-discountninja-cart-[LEVEL]-price",CommentForLevel:"limoniapps-discountninja-cart-[LEVEL]-comment",Root:"limoniapps-discountninja-cart-root",DrawerCartRoot:"limoniapps-discountninja-drawercart-root",ProductPrice:"limoniapps-discountninja-cart-item-product-price",LinePrice:"limoniapps-discountninja-cart-item-line-price",Quantity:"limoniapps-discountninja-cart-item-quantity"},ProductPrice_Legacy:"limoniapps-discounturl-productprice",Blocking:{DotsWrapper:discountNinja_Script_DynamicPricing_Classes_Prefix+"dots-wrapper",BlockPrices:discountNinja_Script_DynamicPricing_Classes_Prefix+"block-prices",Spinner:discountNinja_Script_DynamicPricing_Classes_Prefix+"spinner",Block:discountNinja_Script_DynamicPricing_Classes_Prefix+"block",BlockButtons:discountNinja_Script_DynamicPricing_Classes_Prefix+"block-buttons"}},Attributes:{Shopify:{ProductPrice:"data-price"},DiscountNinja:{Token:"data-token",Ignore:discountNinja_Script_DynamicPricing_Attributes_Prefix+"dynamicpricing-ignore",IgnoreSystem:discountNinja_Script_DynamicPricing_Attributes_Prefix+"dynamicpricing-ignore-system",CartLineItemKey:"data-limoniapps-discountninja-cart-key"}},ReplacingPricesInCart:!1,DrawerCartReplacingPricesInCart:[],ProductPriceSelector:function(){return"."+discountNinja_Script_DynamicPricing_Classes_ProductPrice_Prefix+",."+discountNinja_Script_DynamicPricing.Classes.ProductPrice_Legacy+",["+discountNinja_Script_DynamicPricing.Attributes.Shopify.ProductPrice+"]"},UpdatePrice:function(t,i){function n(o,r){try{if(isNaN(r)&&(r=1),r>10)return!0;let a=!1;if(discountNinja_Script_DynamicPricing.IsDynamicPricingRequired(o,!1)){discountNinja.Logging.LogInformation("FLOW: Updating price"),jQuery(".rc_price__onetime").addClass(discountNinja_Script_DynamicPricing_Classes_ProductPrice_Prefix);let t=discountNinja_Script_DynamicPricing.ProductPriceSelector(),n=jQuery(t);n.length>0&&(discountNinja.Logging.LogVerbose("Replacing product price"),a=!0,n.each(function(t,n){!function(t){try{let o=0,r=0,a=jQuery(t).parents(".limoniapps-discountninja-cart-root");if(null!==a&&a.length>0)return;let c=discountNinja.Environment.Shopify.ProductHandle(),s=jQuery(t).closest("[data-limoniapps-discountninja-product-handle],[data-limoniapps-discounturl-product-handle]"),u=!1,d=null,l=null,g=null,p=!1,f=0,m=null,N=discountNinja.Environment.Shopify.IsProductPage();if(null===s||1!==s.length){if(!N)return void discountNinja.Logging.LogVerbose("No product handle found on non-product page");if(u=!0,discountNinja.Logging.LogVerbose("No product handle found, assuming the product is the product on the current product page"),!(m=discountNinja.Environment.Shopify.VariantId()))return void discountNinja.Logging.LogVerbose("No product variant found on product page");if(null===(o=discountNinja.LiquidData.Price(m)))return void discountNinja.Logging.LogVerbose("No price available");r=discountNinja.LiquidData.CompareAtPrice(m),l=discountNinja.LiquidData.Inventory(m),discountNinja.Logging.LogVerbose("Loading pricing for variant "+m+": price "+o+", compare at:"+r)}else{discountNinja.Logging.LogVerbose("Product handle found, assuming the product is not on the product page, reading price from data tags");let t=s[0];if(d=t,null!==(c=discountNinja.ProductData.GetDataFromCollectionAttribute(t,"Handle"))){discountNinja.ProductData.SaveProductDataUsingDataTags(t);let n=discountNinja.ProductData.GetByProductHandle(c,i);if(!n)return discountNinja.Logging.LogVerbose("No product data found for '"+c+"'. Are you missing Dynamic Pricing data tags? The price will not be updated for the product."),!1;o=n.Price,r=n.CompareAtPrice,l=null,g=n.Collections,(void 0===l||isNaN(l))&&(l=null),(null==o||isNaN(o)||0===o)&&(o=0),(null==r||isNaN(r)||0===r)&&(r=o),r<o&&(r=o),o/=100,r/=100,discountNinja.Logging.LogVerbose("Derived price "+o+" and compare at price "+r+" and inventory level "+l+" from data tags")}else discountNinja.Logging.LogWarning("Could not find product data for "+c,!0,!1);let n=discountNinja.ProductData.GetDataFromCollectionAttribute(t,"Available",c);"false"!==n&&!1!==n||(l=0);let e=discountNinja.ProductData.GetDataFromCollectionAttribute(t,"PriceVaries",c);"true"!==e&&!0!==e||(f=discountNinja.ProductData.GetDataFromCollectionAttribute(t,"PriceMin",c),p=!0)}let j=discountNinja.Offer.GetOfferForProduct(c,m,g,l,o,r,!0,N||!p);if(!j)return discountNinja.Logging.LogVerbose("The price will not be updated for the product variant "+m+" with handle '"+c+"' since the product is not a target of the offer(s)."),N&&(!function(t){let i=jQuery(t).find("."+discountNinja_Script_DynamicPricing.Classes.ProductPrice.ReplacedPrice);i.hide(),i.attr(discountNinja_Script_DynamicPricing.Attributes.DiscountNinja.IgnoreSystem,"");let n=jQuery(t).find("."+discountNinja_Script_DynamicPricing.Classes.ProductPrice.OriginalPrice);n.show(),n.attr(discountNinja_Script_DynamicPricing.Attributes.DiscountNinja.IgnoreSystem,"")}(t),(n=e())&&jQuery(n).each(function(){jQuery(this).hide()})),!1;if(!1===j.UpdatePriceProductPage)return discountNinja.Logging.LogVerbose("The price will not be updated for the product variant "+m+" with handle '"+c+"' since Dynamic Pricing for non-cart pages is disabled for offer "+j.Token+"."),!1;!function(t){jQuery(t).find("."+discountNinja_Script_DynamicPricing.Classes.ProductPrice.ReplacedPrice).removeAttr(discountNinja_Script_DynamicPricing.Attributes.DiscountNinja.IgnoreSystem),jQuery(t).find("."+discountNinja_Script_DynamicPricing.Classes.ProductPrice.OriginalPrice).removeAttr(discountNinja_Script_DynamicPricing.Attributes.DiscountNinja.IgnoreSystem,"")}(t),p&&(o=f/100);let S=discountNinja.DiscountedProduct.Get(null,null,c,100*o,100*r,l,j);S.PriceVaries=p;let h=!0===u?"current ":"";discountNinja.Logging.LogVerbose("Updating price for "+h+"product ("+c+"), price is "+o+" and compare at is "+r+", discounting to "+S.DiscountedPrice);let C=0===jQuery(t).find(".limoniapps-discountninja-shortcode").length,y=N||discountNinja.Environment.Shopify.IsHomePage();if(C){discountNinja.Logging.LogVerbose("Replacing prices first time");let i=u?"product":discountNinja.Environment.Shopify.IsCartPage()?"cart":"other";!function(t,i,n,e,o){try{discountNinja.Logging.LogVerbose("Replacing prices for product first time");let s=jQuery(i).html(),u=jQuery(i).find(".limoniapps-discountninja-productprice-inner"),d=null===u||0===u.length,l=d?s:jQuery(u).prop("outerHTML");d?discountNinja.Logging.LogVerbose("No limoniapps-discountninja-productprice-inner tag detected, using limoniapps-discountninja-productprice"):discountNinja.Logging.LogVerbose("Using limoniapps-discountninja-productprice-inner tag");var r=discountNinja_Script_DynamicPricing.Classes.ProductPrice.OriginalPrice,a=discountNinja_Script_DynamicPricing.Attributes.DiscountNinja.Token;let g='<div class="'+r+'" '+a+'="'+t.Token+'" style="display:none;">'+l+"</div>",p="",f=null!==e.InventoryLeft&&e.InventoryLeft<=0,m=n&&discountNinja.Settings.Settings.LabelSettings.UseSoldOutLabelProductPage||!n&&discountNinja.Settings.Settings.LabelSettings.UseSoldOutLabelCollectionPage;if(f&&discountNinja.Settings.Settings.LabelSettings&&m)p='<div class="limoniapps-discountninja-product-label limoniapps-discountninja-label-soldout">'+window.discountNinjaContext.Labels.SoldOut+"</div>";else{let i=discountNinja.Settings.GetPriceFormat("standard"),o=i.Format.replace(/ /g,"&nbsp"),r=discountNinja.ShortCode.ReplaceAllPlaceHolders(t,o,e);if(discountNinja.Logging.LogVerbose("Replacing price with "+r),i.Animation){let t=i.AnimationIterations>0?' style="animation-iteration-count: '+i.AnimationIterations+' !important;"':"";r='<div class="'+i.Animation+'"'+t+">"+r+"</div>"}if(!n&&e.PriceVaries&&discountNinja.Settings.Settings.LabelSettings.UseFromLabelCollectionPage){let t='<div class="limoniapps-discountninja-product-label limoniapps-discountninja-label-from">'+window.discountNinjaContext.Labels.From+"</div>";r=t+"&nbsp;"+r}let a=!0===n?"limoniapps-discountninja-currentproduct ":"",c="";i.PrefixText&&(c='<div class="limoniapps-discountninja-presuffix prefix '+i.PrefixStyle+'">'+discountNinja.ShortCode.ReplaceAllPlaceHolders(t,i.PrefixText,e)+"</div>");let s="";i.SuffixText&&(s='<div class="limoniapps-discountninja-presuffix suffix '+i.SuffixStyle+'">'+discountNinja.ShortCode.ReplaceAllPlaceHolders(t,i.SuffixText,e)+"</div>"),p='<div class="limoniapps-discountninja-discountedprice '+a+'">'+c+r+s+"</div>"}var c=discountNinja_Script_DynamicPricing.Classes.ProductPrice.ReplacedPrice;newHtml='<div class="'+c+" limoniapps-discountninja-"+o+'page" data-token="'+t.Token+'" style="display:none;">'+p+"</div>";let N="";N=d?newHtml+g:s.replace(l,newHtml+g),jQuery(i).html(N)}catch(t){discountNinja.Logging.LogError("DynamicPricing.UpdatePriceForProduct",t)}}(j,t,u,S,i),y&&function(t,i){if(!t.PromotionCardSettings)return;var n=e();n&&jQuery(n).each(function(){let n=discountNinja.TextSettings.WrapInColor(t.PromotionCardSettings.ProductPageTextColor,discountNinja.ShortCode.ReplaceAllPlaceHolders(t,discountNinja.TextSettings.GetText(t.PromotionCardSettings.ProductPageText,t),i));jQuery(this).html(n),jQuery(this).show()})}(j,S)}else discountNinja.Logging.LogVerbose("Replacing prices after first time"),discountNinja.ShortCode.RefreshResolvedPlaceholders(t,j,S),y&&function(t,i){var n=e();n&&jQuery(n).each(function(n){discountNinja.ShortCode.RefreshResolvedPlaceholders(this,t,i),jQuery(this).show()})}(j,S);!function(t,i){try{let n=jQuery(".afterpay-instalments,.afterpay_instalments,#afterpay-instalments,#afterpay_instalments");if(n&&n.length>0){discountNinja.Logging.LogVerbose("Replacing AfterPay instalments amount");let e=discountNinja.ShortCode.ReplaceAllPlaceHolders(t,"{{DISCOUNTED_PRICE_AFTERPAY_INSTALLMENT}}",i);jQuery(n).html(e)}}catch(t){return discountNinja.Logging.LogError("DynamicPricing.UpdatePriceForProductWrapper",t),!1}}(j,S);let _=null!==S.InventoryLeft&&S.InventoryLeft<=0;return _||discountNinja.Badge.Add(j,S,d),!0}catch(t){return discountNinja.Logging.LogError("DynamicPricing.UpdatePriceForProductWrapper",t),!1}var n}(n)}))}else discountNinja.Logging.LogInformation("FLOW: Not updating price",!0,!1);t||discountNinja_Script_DynamicPricing.ReplacePricesInCart(),discountNinja_Script_DynamicPricing.Show();let c=discountNinja.Settings.GetFlag("ProductsAreLoadedAsynchronously");return!(!a&&c)||(discountNinja.Logging.LogVerbose("Didn't find any prices to replace, assuming they are loaded asynchronously. Attempting again after delay."),r+=1,setTimeout(function(){n(o,r)},100))}catch(t){discountNinja.Logging.LogError("DynamicPricing.UpdatePriceInternal",t)}}function e(){return jQuery(".limoniapps-discountninja-promotioncard-productpage")}try{let t=discountNinja.Settings.Settings;if(!t)return void discountNinja.Logging.LogVerbose("UpdatePrice - Cancel, no settings");if(discountNinja.Environment.Shopify.IsCollectionPage()){!function t(i,n){try{let e=discountNinja_Script_DynamicPricing.ProductPriceSelector(),o=jQuery("[data-limoniapps-discountninja-product-handle]").last().find(e).first();if(o&&1===o.length&&jQuery(o).is(":visible")||100===i)return i<100?(discountNinja.Logging.LogVerbose("Collection product cards are assumed to be ready"),n.apply(this,arguments)):(discountNinja.Logging.LogVerbose("Collection product cards may not be ready, timed out"),n.apply(this,arguments));setTimeout(function(){t(i+1,n)},50)}catch(t){discountNinja.Logging.LogError("DynamicPricing.WaitForProductCards",t)}}(1,n.bind(this,t,!0,1))}else n(t,1)}catch(t){discountNinja.Logging.LogError("DynamicPricing.UpdatePriceInternal",t)}},UnblockPrices:function(){discountNinja.Logging.LogVerbose("Unblocking prices");let t=discountNinja_Script_DynamicPricing.Classes.Blocking.DotsWrapper,i=discountNinja_Script_DynamicPricing.Classes.Blocking.BlockPrices;jQuery("."+t).removeClass(t),jQuery("."+i).removeClass(i)},UnblockButtons:function(){discountNinja.Logging.LogVerbose("Unblocking buttons");let t=discountNinja_Script_DynamicPricing.Classes.Blocking.Spinner,i=discountNinja_Script_DynamicPricing.Classes.Blocking.Block,n=discountNinja_Script_DynamicPricing.Classes.Blocking.BlockButtons;jQuery("."+t).removeClass(t),jQuery("."+i).removeClass(i),jQuery("."+n).removeClass(n)},UnblockPricesAndButtons:function(){discountNinja_Script_DynamicPricing.UnblockButtons(),discountNinja_Script_DynamicPricing.UnblockPrices()},Show:function(t){function i(t){return function(i,n){try{t?jQuery(n).show():jQuery(n).hide()}catch(t){discountNinja.Logging.LogError("DynamicPricing.SetDynamicPricingVisibility",t)}}}var n="."+discountNinja_Script_DynamicPricing.Classes.ProductPrice.ReplacedPrice,e="."+discountNinja_Script_DynamicPricing.Classes.ProductPrice.Wrapper,o="."+discountNinja_Script_DynamicPricing.Classes.ProductPrice.ShowAfterReplace,r="."+discountNinja_Script_DynamicPricing.Classes.ProductPrice.HideAfterReplace,a=":not(["+discountNinja_Script_DynamicPricing.Attributes.DiscountNinja.Ignore+"],["+discountNinja_Script_DynamicPricing.Attributes.DiscountNinja.IgnoreSystem+"])",c="."+discountNinja_Script_DynamicPricing.Classes.ProductPrice.OriginalPrice;function s(t,c){let s=c?"[data-token='"+c+"']":"";priceMatches=jQuery(n+s+a),priceMatches.each(i(t)),discountNinja.Environment.Shopify.IsProductPage()?priceMatches=jQuery(o):priceMatches=jQuery(n+s).closest(e).find(o),priceMatches.each(i(t)),discountNinja.Environment.Shopify.IsProductPage()?priceMatches=jQuery(n+s).closest(e).find(r):priceMatches=jQuery(r),priceMatches.each(i(!t))}try{let n=void 0===t?discountNinja_Script_DynamicPricing.HasActiveDiscountCode():t;if(discountNinja.Logging.LogVerbose("Setting visibility of Dynamic Pricing to "+n),discountNinja.MultiCurrency.UpdateCurrency(),discountNinja_Script_DynamicPricing.UnblockPrices(),jQuery(c+a).each(i(!n)),n){for(var u=0;u<discountNinja.Offer.Offers.length;u++){s(n,discountNinja.Offer.Offers[u].Token)}s(n,"ALL-TOKENS")}else s(n,null)}catch(t){return discountNinja.Logging.LogError("DynamicPricing.Show",t),!1}},FindElementInCart:function(t,i,n){try{if(!t)return null;let e=jQuery(t).find(i);return e&&0!==e.length||(e=jQuery(t).parent().find(i)),e&&0!==e.length?e:(n&&discountNinja.Logging.LogVerbose("Could not find "+i+" in cart element"),null)}catch(t){discountNinja.Logging.LogError("DynamicPricing.FindElementInCart",t)}},DrawerCartIsDirty:!0,ReplacePricesInDrawerCart:function(t){try{if(!discountNinja_Script_DynamicPricing.DrawerCartIsDirty)return;if(discountNinja_Script_DynamicPricing.DrawerCartIsDirty=!1,!(t=t||discountNinja.Settings.Settings))return;discountNinja_Script_DynamicPricing.IsDynamicPricingRequired(t,!0)&&(discountNinja.Logging.LogVerbose("Replace prices in drawer cart"),discountNinja_Script_DynamicPricing.ReplacePricesInCartInner(!0))}catch(t){discountNinja.Logging.LogError("DynamicPricing.ReplacePricesInDrawerCart",t)}},ClassicCartIsDirty:!0,ReplacePricesInClassicCart:function(t){try{if(!discountNinja_Script_DynamicPricing.ClassicCartIsDirty)return;if(discountNinja_Script_DynamicPricing.ClassicCartIsDirty=!1,!(t=t||discountNinja.Settings.Settings))return;(discountNinja.Environment.Shopify.IsCartPage()||jQuery(".limoniapps-discountninja-cart-root").length>0)&&discountNinja_Script_DynamicPricing.IsDynamicPricingRequired(t,!1)&&(discountNinja.Logging.LogVerbose("Replace prices in classic cart"),discountNinja_Script_DynamicPricing.ReplacePricesInCartInner(!1))}catch(t){discountNinja.Logging.LogError("DynamicPricing.ReplacePricesInClassicCart",t)}},ReplacePricesInCartInner:function(t){function i(t,i){try{if(null===discountNinja.DiscountedCart.DiscountedCart)return;let e=discountNinja.DiscountedCart.GetCartItemKeys();discountNinja.Logging.LogVerbose("Replacing prices in cart for root - Discounted: "+e);let o=100*discountNinja.DiscountedCart.DiscountedCart.total_discount,r=[];jQuery(t).find(".limoniapps-discountninja-cart-item-product-price, .limoniapps-discountninja-cart-item-line-price").each(function(t,i){let n=jQuery(i).attr("data-limoniapps-discountninja-cart-key");if(n){let t=!0;for(let i=0;i<r.length;i++)if(r[i]===n){t=!1;break}t&&(discountNinja.Logging.LogVerbose("Adding key to cart item keys to process: "+n),r.push(n))}});for(let e=0;e<r.length;e++){let o=n(t,r[e],i);discountNinja.Logging.LogVerbose("Calculated savings for item in cart: "+o+" cents")}discountNinja.Logging.LogVerbose("Replacing subtotal");let c=function(t,i){try{let n=i/100,e=t/100,o=Math.round(100*(e-n))/100;return o<0&&(o=0),{OriginalPrice:e,Amount:n,Percentage:n/e*100,DiscountedPrice:o}}catch(t){discountNinja.Logging.LogError("DynamicPricing.BuildProductInfoFromAmount",t)}}(100*discountNinja.DiscountedCart.DiscountedCart.total_original_price,o);a(null,null,t,!0,(i?discountNinja.Settings.Settings.PriceUpdateSettings.EnableOnDrawerCart:discountNinja.Settings.Settings.PriceUpdateSettings.EnableOnCartPage)&&o>0,"subtotal",function(t){let i=discountNinja.DiscountCode.GetActiveDiscountCodes();if(!i||0===i.length)return"";let n=[],e=0,o=0;for(let r=0;r<i.length;r++){let a=discountNinja.Offer.GetOfferByToken(i[r].Token);if(a&&a.CartSettings){let i=!1;if("line_item"===a.Entitlement.TargetType&&0===e&&discountNinja.Offer.OfferIsApplicable(a)&&discountNinja.Offer.EligibleItemsCartValue(a)>0&&discountNinja.DiscountTier.GetCurrentDiscountTier(a)&&(e++,i=!0),"shipping_line"===a.Entitlement.TargetType&&0===o&&(o++,i=!0),i){let i=t?a.DrawerCartSettings.SubtotalSavingsLabel:a.CartSettings.SubtotalSavingsLabel,e=t?a.DrawerCartSettings.SubtotalSavingsTextColor:a.CartSettings.SubtotalSavingsTextColor,o=discountNinja.TextSettings.WrapInColor(e,discountNinja.TextSettings.GetText(i,a));n.push({Offer:a.Token,Label:o,ProductInfo:null})}}}return n}(i),c,i,!1),l()}catch(t){discountNinja_Script_DynamicPricing.ReplacingPricesInCart=!1,discountNinja.Logging.LogError("DynamicPricing.ReplacePricesInCartForRoot",t)}}function n(t,i,n){try{let e="Replacing prices in cart - Key "+i;discountNinja.Logging.LogVerbose(e);let o=i.split(":")[0],c=discountNinja.LiquidData.QuantityFromCartByKey(i);if(0===c)return 0;let s=100*discountNinja.LiquidData.PriceFromCartByKey(i);discountNinja.Logging.LogVerbose(e+" - Price "+s+" and quantity "+c);discountNinja.LiquidData.CompareAtPrice(o);if(discountNinja.ProductData.GetByVariant(o,!0)){let o=discountNinja.DiscountedCart.Get(i),u=o?discountNinja.Offer.GetOfferByToken(o.Token):null,d=u&&!1!==u.UpdatePriceCartPage;if(u&&d&&"line_item"===u.Entitlement.TargetType&&"each"===u.Entitlement.AllocationMethod){let e=o.Product,r=o.Line,d=n?discountNinja.Settings.Settings.PriceUpdateSettings.EnableOnDrawerCart:discountNinja.Settings.Settings.PriceUpdateSettings.EnableOnCartPage,l=u.CartSettings?n?u.DrawerCartSettings.ProductSavingsLabel:u.CartSettings.ProductSavingsLabel:null,g=u.CartSettings?n?u.DrawerCartSettings.ProductSavingsTextColor:u.CartSettings.ProductSavingsTextColor:null,p=[];if(l){let t=discountNinja.TextSettings.WrapInColor(g,discountNinja.TextSettings.GetText(l,null));p.push({Offer:u.Token,Label:t,ProductInfo:r})}let f=function(t){try{let i=discountNinja.LiquidData.CartItemByKey(t).properties;if(i)for(let t in i)if(t.indexOf("DiscountNinja.FreeGift")>-1)return!0;return!1}catch(t){return discountNinja.Logging.LogError("DynamicPricing.IsFreeGift",t),!1}}(i);return a(i,u,t,!0,d,"item-product",p,e,n,f),a(i,u,t,!0,d,"item-line",null,r,n,f),(s-100*e.DiscountedPrice)*c}return u&&!d?discountNinja.Logging.LogVerbose(e+" - Cart line item price is not replaced, the offer "+u.Token+" has disabled Dynamic Pricing at cart level. The price will be reset instead."):discountNinja.Logging.LogVerbose(e+" - Cart line item price is not replaced. The price will be reset instead."),r(i,t,"item-product"),r(i,t,"item-line"),0}return discountNinja.Logging.LogVerbose(e+" - No match found in discounted cart"),0}catch(t){discountNinja.Logging.LogError("DynamicPricing.ReplacePricesForCartItem",t)}}function e(t){return discountNinja_Script_DynamicPricing.Classes.Cart.PriceForLevel.replace("[LEVEL]",t)}function o(t){return discountNinja_Script_DynamicPricing.Classes.Cart.CommentForLevel.replace("[LEVEL]",t)}function r(t,i,n){try{let r=discountNinja_Script_DynamicPricing.Attributes.DiscountNinja.CartLineItemKey,a="["+r+'="'+t+'"]',c="."+e(n),s=null===t?jQuery(i).find(c):jQuery(i).find(c+a);if(null===s||0===s.length)return;if(null===t||jQuery(s).attr(r)===t){let i=discountNinja.LiquidData.CartItemByKey(t),e=null;if("item-product"===n&&i?e={OriginalPrice:i.original_price/100}:"item-line"===n&&i&&(e={OriginalPrice:i.original_line_price/100}),null===e&&"subtotal"!==n)discountNinja.Logging.LogVerbose("ResetCartItemLevel - No match found for level "+n+" for key "+t);else{let t="{{ORIGINAL_PRICE}}";"subtotal"===n&&(t="{{TOTAL_PRICE}}"),price=discountNinja.ShortCode.ReplaceAllPlaceHolders(null,t,e,n),jQuery(s).html(price)}}let u="."+o(n),d=null===t?jQuery(i).find(u):jQuery(i).find(u+a);if(null===d||0===d.length)return;if(null!==t&&jQuery(d).attr(r)!==t||jQuery(d).html(""),"subtotal"!==n){let n="."+discountNinja_Script_DynamicPricing.Classes.Cart.Quantity,e=jQuery(i).find(n+a);null!==e&&0!==e.length||(e=i),jQuery(e).attr(r)===t&&jQuery(e).removeClass("limoniapps-discountninja-cart-item-quantity-hide")}}catch(t){discountNinja.Logging.LogError("DynamicPricing.ResetCartItemLevel",t)}}function a(t,i,n,a,c,s,u,d,l,g){try{r(t,n,s);let p="Replacing prices in cart - Level "+s+" - ";if(a){let r=discountNinja.Settings.GetPriceFormat(s,l).Format;discountNinja.Logging.LogVerbose(p+"Discounted");let a=discountNinja_Script_DynamicPricing.Attributes.DiscountNinja.CartLineItemKey,f="["+a+'="'+t+'"]';if(c){let o=discountNinja.ShortCode.ReplaceAllPlaceHolders(i,r||"{{DISCOUNTED_PRICE}} {{ORIGINAL_PRICE,STRIKETHROUGH}}",d,s),c="."+e(s),u=null===t?jQuery(n).find(c):jQuery(n).find(c+f);if(null===u||0===u.length)discountNinja.Logging.LogVerbose(p+"Cart price field not found for level "+s);else if(null===t||jQuery(u).attr(a)===t){!function(t,i,n,e,o){try{let r=discountNinja_Script_DynamicPricing.FindElementInCart(t,".limoniapps-discountninja-cart-"+i+"-price",!0);if(r){let t='<span class="'+discountNinja_Script_DynamicPricing.Classes.ProductPrice.ReplacedPrice+'" '+discountNinja_Script_DynamicPricing.Attributes.DiscountNinja.Token+'="'+o+'" style="display:none;">'+e+"</span>";jQuery(r).html(t+n)}}catch(t){return discountNinja.Logging.LogError("ReplacePriceInCart",t),null}}(u,s,function(t,i,n){try{let r="GetOriginalPriceHtmlFromCartItem - Level "+i+" - ",a=discountNinja_Script_DynamicPricing.Classes.ProductPrice.OriginalPrice;var o=discountNinja_Script_DynamicPricing.Attributes.DiscountNinja.Token;let c="."+e(i),s=discountNinja_Script_DynamicPricing.FindElementInCart(t,c,!0);if(s){let t=discountNinja_Script_DynamicPricing.FindElementInCart(s,"."+a,!1),i='<span class="'+a+'" '+o+'="'+n+'" style="display:none;">'+s.html()+"</span>";if(null===t)return i;{let i=t[0],n=i?jQuery(i).prop("outerHTML"):"";return n||""}}return discountNinja.Logging.LogVerbose(r+"No match found for price element"),""}catch(t){return discountNinja.Logging.LogError("DynamicPricing.GetOriginalPriceHtmlFromCartItem",t),null}}(u,s,i?i.Token:"ALL-TOKENS"),o,i?i.Token:"ALL-TOKENS")}}else discountNinja.Logging.LogVerbose(p+"Dynamic Pricing on cart not enabled for level "+s);if(u){let i="."+o(s),e=null===t?jQuery(n).find(i):jQuery(n).find(i+f);null!==e&&0!==e.length||(e=n),null===e||0===e.length?discountNinja.Logging.LogVerbose(p+"Cart comment field not found for level "+s):null!==t&&jQuery(e).attr(a)!==t||function(t,i,n){try{let r="."+o(n),a=discountNinja_Script_DynamicPricing.FindElementInCart(t,r,!0);if(i&&i.length>0&&a){discountNinja.Logging.LogVerbose("Adding comment for level: "+n);let t="";for(let o=0;o<i.length;o++){let r=i[o].Label,a=i[o].ProductInfo,c=i[o].Offer,s=discountNinja.Offer.GetOfferByToken(c),u=discountNinja.ShortCode.ReplaceAllPlaceHolders(s,r,a);var e=discountNinja_Script_DynamicPricing.Classes.ProductPrice.ReplacedPrice;let d=discountNinja_Script_DynamicPricing.Attributes.DiscountNinja.Token,l="";"subtotal"===n?(l='<div class="'+e+'" '+d+'="'+c+'" style="display:none;">'+u+"</div>",t=""===t?l:t+l):(l='<span class="'+e+'" '+d+'="'+c+'" style="display:none;">'+u+"</span>",t=""===t?l:t+"&nbsp;"+l)}jQuery(a).html(t),a.show()}else i&&0!==i.length||discountNinja.Logging.LogVerbose("No comment for level: "+n)}catch(t){return discountNinja.Logging.LogError("DynamicPricing.AddCartComment",t),null}}(e,u,s)}if(g&&"subtotal"!==s){let i="."+discountNinja_Script_DynamicPricing.Classes.Cart.Quantity,e=jQuery(n).find(i+f);null!==e&&0!==e.length||(e=n),null===e||0===e.length?discountNinja.Logging.LogVerbose(p+"Cart quantity field not found for level "+s):null!==t&&jQuery(e).attr(a)!==t||jQuery(e).addClass("limoniapps-discountninja-cart-item-quantity-hide")}}else discountNinja.Logging.LogVerbose(p+"Not discounted")}catch(t){discountNinja.Logging.LogError("DynamicPricing.ReplacePricesForCartItemLevel",t)}}function c(){discountNinja_Script_DynamicPricing.UnblockPricesAndButtons(),discountNinja_Script_DynamicPricing.ReplacingPricesInCart=!1}function s(){jQuery(".limoniapps-discountninja-drawercart-root .limoniapps-discountninja-cart-subtotal-comment").hide(),jQuery(".limoniapps-discountninja-drawercart-root .limoniapps-discountninja-cart-subtotal-price .limoniapps-discountninja-shortcode-discounted_price").text("0"),jQuery(".limoniapps-discountninja-drawercart-root .limoniapps-discountninja-cart-subtotal-price .limoniapps-discountninja-shortcode-original_price").hide()}function u(t,i,n,e){try{var o=null;if(discountNinja_Script_DynamicPricing.DrawerCartReplacingPricesInCart)for(let t=0;t<discountNinja_Script_DynamicPricing.DrawerCartReplacingPricesInCart.length;t++)if(discountNinja_Script_DynamicPricing.DrawerCartReplacingPricesInCart[t].Item===e&&discountNinja_Script_DynamicPricing.DrawerCartReplacingPricesInCart[t].Ready)return;if(i.find(".limoniapps-discountninja-cart-subtotal-price").length>0&&function(t){let i=!1;return jQuery(t).each(function(){jQuery(this).is(":visible")&&(i=!0)}),i}(i)&&function(t){let i=!1;return jQuery(t).each(function(){discountNinja.Utilities.IsInViewport(this)&&(i=!0)}),i}(i)||200===t)return t<200?(discountNinja.Logging.LogVerbose("Drawer cart is ready"),discountNinja_Script_DynamicPricing.DrawerCartReplacingPricesInCart.push({Item:e,Ready:!0}),null!==o&&clearTimeout(o),n.call(this,i)):(discountNinja.Logging.LogVerbose("Drawer cart not ready, timed out"),discountNinja_Script_DynamicPricing.DrawerCartReplacingPricesInCart.push({Item:e,Ready:!1,Expired:!0}),c());t+=1,o=setTimeout(function(){u(t,i,n,e)},100)}catch(t){discountNinja.Logging.LogError("DynamicPricing.WaitForDrawerCart",t)}}function d(t){try{discountNinja.Logging.LogVerbose("Replace prices in drawer cart - starting"),i(t,!0),setTimeout(function(){i(t,!0)},100),setTimeout(function(){i(t,!0)},500),discountNinja.Logging.LogVerbose("Replace prices in drawer cart - done")}catch(t){l(),discountNinja.Logging.LogError("DynamicPricing.ReplacePricesInCartForRootAfterWait",t)}}function l(){discountNinja_Script_DynamicPricing.UnblockPricesAndButtons(),discountNinja_Script_DynamicPricing.Show(!0),discountNinja_Script_DynamicPricing.ReplacingPricesInCart=!1}try{if(null===discountNinja.Settings.Settings)return;if(null===discountNinja.DiscountedCart.DiscountedCart)return;if(!discountNinja_Script_DynamicPricing.HasActiveDiscountCode())return c(),void s();let n=t?"drawer cart":"classic cart";if(discountNinja.Logging.LogVerbose("Replace prices in "+n+" (inner)"),0===window.discountNinjaContext.Cart.items.length)return discountNinja.Logging.LogVerbose("Replace prices in "+n+" stopped: no items in cart"),c(),void s();let e=t?jQuery(".limoniapps-discountninja-drawercart-root"):jQuery(".limoniapps-discountninja-cart-root");if(void 0===e||0===e.length)return discountNinja.Logging.LogVerbose(t?"Could not find limoniapps-discountninja-drawercart-root":"Could not find limoniapps-discountninja-cart-root"),void c();if(discountNinja_Script_DynamicPricing.ReplacingPricesInCart=!0,t){discountNinja.Logging.LogVerbose("Found "+e.length+" drawer cart roots, waiting until they are rendered");discountNinja_Script_DynamicPricing.DrawerCartReplacingPricesInCart=[];let t=1;jQuery(e).each(function(){u(1,jQuery(this),d,t),t++})}else jQuery(e).each(function(){i(this,!1)})}catch(t){discountNinja_Script_DynamicPricing.ReplacingPricesInCart=!1,discountNinja.Logging.LogError("DynamicPricing.ReplacePricesInCartInner",t)}},ReplacePricesInCart:function(){discountNinja.Logging.LogVerbose("Requested ReplacePricesInCart"),discountNinja.Cart.Shopify.UpdateCart(function(){discountNinja.DiscountedCart.BuildDiscountedCart(function(){!function(){try{let t=discountNinja.Settings.Settings;discountNinja.Logging.LogVerbose("Replacing prices in cart and drawer cart"),discountNinja_Script_DynamicPricing.ReplacePricesInDrawerCart(t),discountNinja_Script_DynamicPricing.ReplacePricesInClassicCart(t),discountNinja.Logging.LogVerbose("Hiding checkout buttons"),""!==discountNinja.DiscountCode.GetActiveDiscountCodesForCheckoutAsString()&&discountNinja.PromotionFlow.HideAdditionalCheckoutButtons(),discountNinja.Logging.LogVerbose("Inject in Html"),discountNinja.DiscountCode.InjectDiscountCodesInHtml()}catch(t){discountNinja_Script_DynamicPricing.ReplacingPricesInCart=!1,discountNinja.Logging.LogError("DynamicPricing.ReplacePricesInCart.Inner",t)}discountNinja.Logging.LogVerbose("Unblock"),discountNinja_Script_DynamicPricing.UnblockPricesAndButtons()}()})})},IsDynamicPricingRequired:function(t,i){let n="";if(i){if(!1!==t.PriceUpdateSettings.EnableOnDrawerCart)return!0;n="Dynamic Pricing is not required since the offer configuration specifies not to dynamically replace prices on the drawer cart."}return""===n&&discountNinja.Environment.Shopify.IsHomePage()&&!1===t.PriceUpdateSettings.EnableOnHomePage&&(n="Dynamic Pricing is not required since the offer configuration specifies not to dynamically replace prices on the home page."),""===n&&discountNinja.Environment.Shopify.IsCollectionPage()&&!1===t.PriceUpdateSettings.EnableOnCollectionPages&&(n="Dynamic Pricing is not required since the offer configuration specifies not to dynamically replace prices on collection pages."),""===n&&discountNinja.Environment.Shopify.IsProductPage()&&!1===t.PriceUpdateSettings.EnableOnProductPages&&(n="Dynamic Pricing is not required since the offer configuration specifies not to dynamically replace prices on product pages."),""===n&&discountNinja.Environment.Shopify.IsBlogPost()&&!1===t.PriceUpdateSettings.EnableOnBlogPages&&(n="Dynamic Pricing is not required since the offer configuration specifies not to dynamically replace prices on blog pages."),""===n&&discountNinja.Environment.Shopify.IsCustomPage()&&!1===t.PriceUpdateSettings.EnableOnCustomPages&&(n="Dynamic Pricing is not required since the offer configuration specifies not to dynamically replace prices on custom pages."),""===n&&discountNinja.Environment.Shopify.IsCartPage()&&!1===t.PriceUpdateSettings.EnableOnCartPage&&(n="Dynamic Pricing is not required since the offer configuration specifies not to dynamically replace prices on the cart page."),discountNinja.PromotionFlow.HandleFlowErrorMessage(n)},HasActiveLineItemDiscountCode:function(){let t=discountNinja.DiscountCode.GetActiveLineItemDiscountCodes();return null!=t&&""!==t},HasActiveDiscountCode:function(){let t=discountNinja.DiscountCode.GetActiveDiscountCodes();return null!=t&&""!==t}},discountNinja_Script_LiquidData={WaitForLiquidAsset:function(t){try{let i=void 0!==window.discountNinjaContext;if(i)t&&t();else{discountNinja.Logging.LogVerbose("Waiting for liquid asset to be returned");let n=0,e=function(){if(n++,!(i=void 0!==window.discountNinjaContext))return 150===n?(discountNinja.Logging.LogTestMode("A Discount Ninja liquid asset (limoniapps-discountninja-header/limoniapps-discountninja-context) is missing in your theme. Contact support@discountninja.io to have the issue resolved.",!0,!0,!0,!0),discountNinja.Logging.LogErrorMessage("LiquidData.WaitForLiquidAsset","Waiting for liquid asset (limoniapps-discountninja-header/limoniapps-discountninja-context) to be returned timed out. Either the asset does not exist or it is not included in the theme.liquid file. Exiting.")):setTimeout(e,100);discountNinja.Logging.LogVerbose("LiquidData.WaitForLiquidAsset","Waiting for liquid asset to be available - DONE"),t&&t()};e()}}catch(t){return discountNinja.Logging.LogError("LiquidData.WaitForLiquidAsset",t),""}},Cart:function(){try{return void 0!==window.discountNinjaContext&&void 0!==window.discountNinjaContext.Cart&&void 0!==window.discountNinjaContext.Cart.total_price?window.discountNinjaContext.Cart:null}catch(t){discountNinja.Logging.LogError("LiquidData.Cart",t)}},CartValue:function(){try{let t=discountNinja_Script_LiquidData.Cart();return null===t?null:t.total_price}catch(t){discountNinja.Logging.LogError("LiquidData.CartValue",t)}},VariantIdsFromCart:function(){try{let t="",i=discountNinja_Script_LiquidData.Cart();if(i&&"object"==typeof i.items)for(let n=0;n<i.items.length;n++)""!==t&&(t+=","),t+=i.items[n].variant_id;return t.split(",")}catch(t){return discountNinja.Logging.LogError("LiquidData.VariantIdsFromCart",t),null}},ProductCollections:function(){try{return window.discountNinjaContext.Product?window.discountNinjaContext.Product.Collections:null}catch(t){return discountNinja.Logging.LogError("LiquidData.ProductCollections",t),null}},ProductDefaultVariantId:function(){try{return window.discountNinjaContext.Product?window.discountNinjaContext.Product.VariantId:null}catch(t){return discountNinja.Logging.LogError("LiquidData.ProductDefaultVariantId",t),null}},VariantInfoFromLiquid:function(t){try{if(window.discountNinjaContext.ProductVariants)for(let i=0;i<window.discountNinjaContext.ProductVariants.length;i++)if(window.discountNinjaContext.ProductVariants[i].VariantId===parseInt(t))return window.discountNinjaContext.ProductVariants[i];return null}catch(t){return discountNinja.Logging.LogError("LiquidData.VariantInfoFromLiquid",t),null}},CompareAtPrice:function(t){try{let i=discountNinja_Script_LiquidData.VariantInfoFromLiquid(t);return null===i?null:i.CompareAtPrice/100}catch(t){return discountNinja.Logging.LogError("LiquidData.CompareAtPrice",t),null}},Price:function(t){try{let i=discountNinja_Script_LiquidData.VariantInfoFromLiquid(t);return null===i?null:i.Price/100}catch(t){return discountNinja.Logging.LogError("LiquidData.Price",t),null}},Inventory:function(t){try{let i=discountNinja_Script_LiquidData.VariantInfoFromLiquid(t);return null===i?null:"null"===i.Inventory?null:i.Inventory}catch(t){return discountNinja.Logging.LogError("LiquidData.Inventory",t),null}},CollectionProductByHandle:function(t){try{let i=window.discountNinjaContext.CollectionProducts;for(let n=0;n<i.length;n++)if(i[n].Handle===t)return i[n];return null}catch(t){return discountNinja.Logging.LogError("LiquidData.CartItemByProductHandle",t),null}},CartItemByVariantAndProperty:function(t,i,n){function e(t,i,n){return t.properties&&t.properties[i]===n}try{let o=window.discountNinjaContext.Cart.items;for(let r=0;r<o.length;r++){let a=o[r];if(a.variant_id.toString()===t.toString()&&e(a,i,n))return a}return null}catch(t){return discountNinja.Logging.LogError("LiquidData.CartItemByVariant",t),null}},CartItemByDelegate:function(t){try{if("object"!=typeof window.discountNinjaContext||!window.discountNinjaContext.Cart||!window.discountNinjaContext.Cart.items||0===window.discountNinjaContext.Cart.items.length)return null;let i=window.discountNinjaContext.Cart.items;for(let n=0;n<i.length;n++){let e=i[n];if(t(e))return e}return null}catch(t){return discountNinja.Logging.LogError("LiquidData.CartItemByDelegate",t),0}},CartItemsByDelegate:function(t){try{let i=[];if("object"!=typeof window.discountNinjaContext||!window.discountNinjaContext.Cart||!window.discountNinjaContext.Cart.items||0===window.discountNinjaContext.Cart.items.length)return i;let n=window.discountNinjaContext.Cart.items;for(let e=0;e<n.length;e++){let o=n[e];t(o)&&i.push(o)}return i}catch(t){return discountNinja.Logging.LogError("LiquidData.CartItemsByDelegate",t),0}},CartItemByKey:function(t){return discountNinja_Script_LiquidData.CartItemByDelegate(function(i){return i.key===t})},CartItemByVariant:function(t){return discountNinja_Script_LiquidData.CartItemByDelegate(function(i){return i.variant_id&&t&&i.variant_id.toString()===t.toString()})},CartItemByProductHandle:function(t){return discountNinja_Script_LiquidData.CartItemByDelegate(function(i){return i.handle===t})},CartItemsByVariant:function(t){return discountNinja_Script_LiquidData.CartItemsByDelegate(function(i){return i.variant_id&&t&&i.variant_id.toString()===t.toString()})},CartItemsByProductHandle:function(t){return discountNinja_Script_LiquidData.CartItemsByDelegate(function(i){return i.handle===t})},PriceFromCartByProductHandle:function(t){try{let i=discountNinja_Script_LiquidData.CartItemByProductHandle(t);return null===i?null:i.original_price/100}catch(t){return discountNinja.Logging.LogError("LiquidData.PriceFromCartByProductHandle",t),null}},PriceFromCartByKey:function(t){try{let i=discountNinja_Script_LiquidData.CartItemByKey(t);return null===i?null:i.original_price/100}catch(t){return discountNinja.Logging.LogError("LiquidData.PriceFromCartByProductHandle",t),null}},QuantityFromCartByKey:function(t){try{let i=discountNinja_Script_LiquidData.CartItemByKey(t);return null===i?null:i.quantity}catch(t){return discountNinja.Logging.LogError("LiquidData.PriceFromCartByProductHandle",t),null}},PriceFromCart:function(t){try{let i=discountNinja_Script_LiquidData.CartItemByVariant(t);return null===i?null:i.original_price/100}catch(t){return discountNinja.Logging.LogError("LiquidData.PriceFromCart",t),null}},ProductHandleFromCart:function(t){try{let i=discountNinja_Script_LiquidData.CartItemByVariant(t);return null===i?null:i.handle}catch(t){return discountNinja.Logging.LogError("LiquidData.ProductHandleFromCart",t),null}},SubTotalPriceFromCart:function(t){try{return void 0!==window.discountNinjaContext&&"object"==typeof window.discountNinjaContext.Cart?window.discountNinjaContext.Cart.total_price/100:null}catch(t){return discountNinja.Logging.LogError("LiquidData.SubTotalPriceFromCart",t),null}},ItemIsInCollection:function(t,i){let n=discountNinja.ProductData.GetByProductHandle(t.handle);if(n){if(i.indexOf("%")>-1){var e=discountNinja.ProductData.GetByVariant(29141038104669,!1);if(e&&e.CompareAtPrice>t.original_price)return!1}let o=n.Collections;return discountNinja.Utilities.StringIsIn(i,o)}return!1},GetQuantityFromItems:function(t){try{let i=0;if(t)for(let n=0;n<t.length;n++)i+=t[n].quantity;return i}catch(t){return discountNinja.Logging.LogError("LiquidData.GetQuantityFromItems",t),0}},GetOriginalLinePriceFromItems:function(t){try{let i=0;if(t)for(let n=0;n<t.length;n++)i+=t[n].original_price*t[n].quantity;return i}catch(t){return discountNinja.Logging.LogError("LiquidData.GetQuantityFromItems",t),0}},ItemsInCartFromCollections:function(t,i){try{return discountNinja_Script_LiquidData.CartItemsByDelegate(function(n){return discountNinja_Script_LiquidData.ItemIsInCollection(n,t)&&(!i||!discountNinja_Script_LiquidData.ItemIsInCollection(n,i))})}catch(t){return discountNinja.Logging.LogError("LiquidData.ItemsInCartFromCollections",t),0}},ItemsInCartFromProducts:function(t,i){try{return discountNinja_Script_LiquidData.CartItemsByDelegate(function(n){return discountNinja.Utilities.StringIsIn(t,n.handle)&&(!i||!discountNinja_Script_LiquidData.ItemIsInCollection(n,i))})}catch(t){return discountNinja.Logging.LogError("LiquidData.ItemsInCartFromProducts",t),0}},ItemsInCart:function(t){try{return discountNinja_Script_LiquidData.CartItemsByDelegate(function(i){return!t||!discountNinja_Script_LiquidData.ItemIsInCollection(i,t)})}catch(t){return discountNinja.Logging.LogError("LiquidData.ItemsInCart",t),0}},ItemsInCartOfVariant:function(t,i){try{return discountNinja_Script_LiquidData.CartItemsByDelegate(function(n){return n.variant_id&&t&&n.variant_id.toString()===t.toString()&&(!i||!discountNinja_Script_LiquidData.ItemIsInCollection(n,i))})}catch(t){return discountNinja.Logging.LogError("LiquidData.ItemsInCart",t),0}},ItemsInCartWithoutProperty:function(t,i){try{return discountNinja_Script_LiquidData.CartItemsByDelegate(function(n){let e=!1;if(n.properties)for(let i in n.properties)if(i.indexOf(t)>-1){e=!0;break}return!(e||i&&discountNinja_Script_LiquidData.ItemIsInCollection(n,i))})}catch(t){return discountNinja.Logging.LogError("LiquidData.ItemsInCartWithoutProperty",t),0}},ItemsInCartAddedByOffer:function(t){try{return discountNinja_Script_LiquidData.CartItemsByDelegate(function(i){return void 0!==i.properties["DiscountNinja.FreeGift."+t.Token]})}catch(t){return discountNinja.Logging.LogError("LiquidData.ItemsInCartAddedByOffer",t),0}},QuantityInCartFromCollections:function(t,i){let n=discountNinja_Script_LiquidData.ItemsInCartFromCollections(t,i);return discountNinja_Script_LiquidData.GetQuantityFromItems(n)},QuantityInCartFromProducts:function(t,i){let n=discountNinja_Script_LiquidData.ItemsInCartFromProducts(t,i);return discountNinja_Script_LiquidData.GetQuantityFromItems(n)},QuantityInCart:function(t){let i=discountNinja_Script_LiquidData.ItemsInCart(t);return discountNinja_Script_LiquidData.GetQuantityFromItems(i)},QuantityInCartOfVariant:function(t,i){let n=discountNinja_Script_LiquidData.ItemsInCartOfVariant(t,i);return discountNinja_Script_LiquidData.GetQuantityFromItems(n)},QuantityInCartExcludingGifts:function(t){let i=discountNinja_Script_LiquidData.ItemsInCartWithoutProperty("DiscountNinja.FreeGift",t);return discountNinja_Script_LiquidData.GetQuantityFromItems(i)},ValueInCartFromCollections:function(t,i){let n=discountNinja_Script_LiquidData.ItemsInCartFromCollections(t,i);return discountNinja_Script_LiquidData.GetOriginalLinePriceFromItems(n)},ValueInCartFromProducts:function(t,i){let n=discountNinja_Script_LiquidData.ItemsInCartFromProducts(t,i);return discountNinja_Script_LiquidData.GetOriginalLinePriceFromItems(n)},ValueInCart:function(t){let i=discountNinja_Script_LiquidData.ItemsInCart(t);return discountNinja_Script_LiquidData.GetOriginalLinePriceFromItems(i)},ValueInCartExcludingGifts:function(t){let i=discountNinja_Script_LiquidData.ItemsInCartWithoutProperty("DiscountNinja.FreeGift",t);return discountNinja_Script_LiquidData.GetOriginalLinePriceFromItems(i)},ValueInCartOfVariant:function(t,i){let n=discountNinja_Script_LiquidData.ItemsInCartOfVariant(t,i);return discountNinja_Script_LiquidData.GetOriginalLinePriceFromItems(n)}},discountNinja_Script_Offer={Offers:null,Triggers:null,PrimaryOffer:null,ServerUrl:function(){return"prod"===discountNinja.Core.Environment?"https://promotionapi-afd.discountninja.io":"https://discountninjav2-promotionapi-dev.azurewebsites.net"},GetOfferByToken:function(t){if(discountNinja_Script_Offer.Offers)for(let i=0;i<discountNinja_Script_Offer.Offers.length;i++)if(discountNinja_Script_Offer.Offers[i].Token===t)return discountNinja_Script_Offer.Offers[i];return null},SetPrimaryOffer:function(){try{if(discountNinja_Script_Offer.PrimaryOffer=null,discountNinja.Environment.Shopify.IsProductPage()){let t=discountNinja.Environment.Shopify.ProductHandle(),i=discountNinja.Environment.Shopify.VariantId(),n=discountNinja.LiquidData.Inventory(i);discountNinja.Logging.LogVerbose("Selecting primary offer based on product handle: "+t+" (inventory: "+n+")");let e=discountNinja.LiquidData.Price(i),o=discountNinja.LiquidData.CompareAtPrice(i);discountNinja_Script_Offer.PrimaryOffer=discountNinja_Script_Offer.GetOfferForProduct(t,i,null,n,e,o,!1,!0)}if(null===discountNinja_Script_Offer.PrimaryOffer){discountNinja.Logging.LogVerbose("Selecting primary offer based on first applicable");let t=discountNinja_Script_Offer.Offers;if(null===t)return;let i=[];for(let n=0;n<t.length;n++)discountNinja_Script_Offer.IsOfferAccepted(t[n].Token,t[n].Frequency)&&i.push(t[n]);if(0===i.length)discountNinja.Logging.LogInformation("No primary offer detected");else if(1===i.length)discountNinja_Script_Offer.PrimaryOffer=i[0];else{let t=[];for(let n=0;n<i.length;n++){let e=i[n];t.push(e)}if(0===t.length)discountNinja_Script_Offer.PrimaryOffer=i[0];else if(1===t.length)discountNinja_Script_Offer.PrimaryOffer=t[0];else{for(let i=0;i<t.length;i++){let n=t[i];if(!discountNinja_Script_Offer.IsOfferAccepted(n.Token,n.Frequency))return void(discountNinja_Script_Offer.PrimaryOffer=n)}discountNinja_Script_Offer.PrimaryOffer=t[0]}}}}catch(t){discountNinja.Logging.LogError("Offer.SetPrimaryOffer",t)}},CombinePromotionsFromTokenAndDiscountCode:function(){let t=JSON.parse(discountNinja.Cache.SessionGet("triggersfromtoken")),i=discountNinja.DiscountCodeTrigger.Get();return{Offers:function(t,i){try{t||(t=[]);for(let n=0;n<i.length;n++){let e=!1;for(let o=0;o<i[n].trigger.Offers.length;o++){for(let r=0;r<t.length;r++)if(t[r].Token===i[n].trigger.Offers[o].Token){e=!0;break}e||t.push(i[n].trigger.Offers[o])}}return t}catch(t){return discountNinja.Logging.LogError("Offer.CombineOffersFromTokenAndDiscountCode",t),null}}(t.Offers,i),Triggers:function(t,i){try{t||(t=[]);for(let e=0;e<i.length;e++){let o=!1;for(let r=0;r<i[e].trigger.Triggers.length;r++){for(let n=0;n<t.length;n++)if(t[n].Token===i[e].trigger.Triggers[r].Token){o=!0;break}if(!o){var n=i[e].trigger.Triggers[r];n.Offers=[];for(let t=0;t<i[e].trigger.Offers.length;t++)n.Offers.push(i[e].trigger.Offers[t].Token);t.push(n)}}}return t}catch(t){return discountNinja.Logging.LogError("Offer.CombineTriggersFromTokenAndDiscountCode",t),null}}(t.Triggers,i)}},LoadApplicableOffers:function(t,i){try{let n=discountNinja.Token.GetNonAutomaticToken();!function(t,i,n,e){function o(t){try{if(discountNinja_Script_Offer.Offers=null,discountNinja_Script_Offer.Triggers=null,discountNinja_Script_Offer.PrimaryOffer=null,!discountNinja.Settings.SettingsAreValid(discountNinja.Settings.Settings))return discountNinja.Logging.LogWarning("Settings invalid",!0,!1),null;if(discountNinja_Script_Offer.Offers=function(t){try{if(!t)return null;discountNinja.Logging.LogVerbose("Before filter "+t.length+" offers available");let i=[];for(let n=0;n<t.length;n++){let e=t[n];discountNinja_Script_Offer.OfferIsApplicable(e)&&i.push(e)}return discountNinja.Logging.LogVerbose("After filter "+i.length+" offers available"),i}catch(t){return discountNinja.Logging.LogError("Offer.FilterOffers",t),null}}(t.Offers),discountNinja_Script_Offer.Offers=function(t){try{if(!t)return null;let i=discountNinjaContext.PresentmentCurrency,n=discountNinjaContext.ShopCurrency;if(!i||!n)return t;for(let e=0;e<t.length;e++){let o=t[e];for(let t=0;t<o.Tiers.length;t++){let e=o.Tiers[t];e.Prerequisite&&e.Prerequisite.MinimumAmount&&(e.Prerequisite.MinimumAmount=n===i?e.Prerequisite.MinimumAmountBaseCurrency:discountNinja.Currency.Convert(e.Prerequisite.MinimumAmountBaseCurrency,i)),e.Prerequisite&&e.Prerequisite.MaximumAmount&&(e.Prerequisite.MaximumAmount=n===i?e.Prerequisite.MaximumAmountBaseCurrency:discountNinja.Currency.Convert(e.Prerequisite.MaximumAmountBaseCurrency,i)),e.Entitlement&&e.Entitlement.Amount&&(e.Entitlement.Amount=n===i?e.Entitlement.AmountBaseCurrency:discountNinja.Currency.Convert(e.Entitlement.AmountBaseCurrency,i))}}return t}catch(t){return discountNinja.Logging.LogError("Offer.ConvertRates",t),null}}(discountNinja_Script_Offer.Offers),!discountNinja_Script_Offer.Offers)return discountNinja.Logging.LogInformation("No offers available after filter",!1),null;if(discountNinja_Script_Offer.Triggers=function(t){try{if(!t)return null;discountNinja.Logging.LogVerbose("Before filter "+t.length+" triggers available");let i=[];for(let n=0;n<t.length;n++){let e=t[n];discountNinja_Script_Offer.TriggerIsApplicable(e)&&i.push(e)}return discountNinja.Logging.LogVerbose("After filter "+i.length+" triggers available"),i}catch(t){return discountNinja.Logging.LogError("Offer.FilterOffers",t),null}}(t.Triggers),!discountNinja_Script_Offer.Triggers)return discountNinja.Logging.LogInformation("No triggers available after filter",!1),null;discountNinja.Trigger.TrackExitIntent(),function(t){try{discountNinja.Cache.SessionSet("offerinfo-"+i,JSON.stringify(t))}catch(t){discountNinja.Logging.LogError("Offer.SavePromotionInfoToCache",t)}}(t)}catch(t){return discountNinja.Logging.LogError("Offer.ProcessPromotionInfo",t),null}}function r(t){try{!1===t||"false"===t?(discountNinja.Logging.LogInformation("No applicable offer(s) detected",!1),t={Offers:[],Triggers:[]}):null==t||void 0===t.Offers||null===t.Offers||void 0===t.Offers||null===t.Offers||void 0===t.Triggers||null===t.Triggers?(discountNinja.Logging.LogErrorMessage("Offer.PromotionInfoReady","Offer Info null or no offers/triggers available"),t={Offers:[],Triggers:[]}):!1===t||0===t.Triggers.length?(discountNinja.Logging.LogInformation("No applicable trigger(s) detected",!1),t={Offers:[],Triggers:[]}):!1!==t&&0!==t.Offers.length||(discountNinja.Logging.LogInformation("No applicable offer(s) detected",!1),t={Offers:[],Triggers:[]}),discountNinja.Cache.SessionSet("triggersfromtoken",JSON.stringify(t));let i=discountNinja_Script_Offer.CombinePromotionsFromTokenAndDiscountCode();t.Offers=i.Offers,t.Triggers=i.Triggers,discountNinja.Logging.LogVerbose("Promotion info from server and session combined."),o(t);let r=discountNinja.Token.GetTokenFromQueryParameter();return null!==r&&""!==r&&discountNinja.Token.SetNonAutomaticTokenInSession(r),discountNinja.Events.Publish("PromotionsLoaded",[discountNinja.Offer.Offers]),n?n(t):void 0}catch(t){return discountNinja.Logging.LogError("Offer.PromotionInfoReady",t),e?e():void 0}}try{let n=function(){try{let t=discountNinja.Cache.SessionGet("offerinfo-"+i);return"undefined"===t?null:JSON.parse(t)}catch(t){return discountNinja.Logging.LogError("Offer.GetPromotionInfoFromCache",t),null}}();if(null!==n)return discountNinja.Logging.LogVerbose("Offer info available in cache"),r(n);{discountNinja.Logging.LogVerbose("Loading offer info from server");let n=null===discountNinja.Cache.SessionGet("offerinfo-requested-"+i),e=discountNinja.Core.Shop,o=discountNinja.Utilities.GetReferrer();discountNinja.XmlHttpRequest.Send(discountNinja_Script_Offer.ServerUrl()+"/api/ApplicablePromotions",function(t,i,n,e){try{let o={};t&&(o.shop=t),i&&(o.token=i),null!==discountNinja.TestMode.TestMode&&(o.testMode=discountNinja.TestMode.TestMode,o.matchByTokenOnly=discountNinja.TestMode.MatchByTokenOnly,o.testModeToken=discountNinja.TestMode.TestModeToken),null!==n&&(o.firstRequest=n),e&&(o.referrer=e),o.version=discountNinja.Core.Version;let r=discountNinja.DeviceId.Get();return o.deviceId=r,o.m=r+"-"+moment().format("x"),o}catch(t){return discountNinja.Logging.LogError("Offer.LoadPromotionInfo.BuildParameters",t),null}}(e,t,n,o),null,"get",!0,!0,r),discountNinja.Cache.SessionSet("offerinfo-requested-"+i,!0)}}catch(t){discountNinja.Logging.LogError("Offer.LoadApplicableOffersInner",t),e()}}(n,function(t){let i="";return i=t?"token-"+t:"anytoken",discountNinja.Logging.LogVerbose("Checking offer info cache for key: "+i),i}(n),t,i)}catch(t){discountNinja.Logging.LogError("Offer.LoadPromotionInfo",t),i()}},TriggerIsApplicable:function(t){return!0},OfferIsApplicable:function(t){try{return!!t&&(null!==t.StartsAt&&void 0!==t.StartsAt&&""!==t.StartsAt&&moment().utc().diff(moment(t.StartsAt).utc(),"seconds")<0&&(discountNinja.Logging.LogTestMode("Offer would normally not be displayed because the start date ("+t.StartsAt+") of the offer is in the future, it is only shown because you are in test mode. Check the start date of your offer and the start date of your discount code (Discount module). Learn more <a style='color: blue; text-decoration: underline;' href='http://support.limoniapps.com/discount-url-support-center/schedule/how-to-startend-a-offer-automatically' target='_blank'>here</a>.",null,!0,!0,!1),!1===discountNinja.TestMode.TestMode)?(discountNinja_Script_Offer.Stop(t.Token),!1):null!==t.EndsAt&&void 0!==t.EndsAt&&""!==t.EndsAt&&moment().utc().diff(moment(t.EndsAt).utc(),"seconds")>=0&&(discountNinja.Logging.LogTestMode("Offer would normally not be displayed because the expiration date ("+t.EndsAt+")  of the discount code "+t.Tiers[0].DiscountCode.Code+" is in the past or the timer has expired. Check the end date of your offer, the expiration date of your discount code and the end date of your discount code (Discount module). Learn more <a style='color: blue; text-decoration: underline;' href='http://support.limoniapps.com/discount-url-support-center/schedule/how-to-startend-a-offer-automatically' target='_blank'>here</a>.",null,!0,!0,!1),!1===discountNinja.TestMode.TestMode)?(discountNinja_Script_Offer.Stop(t.Token),!1):(discountNinja.Logging.LogVerbose("The offer is applicable"),!0))}catch(t){return discountNinja.Logging.LogError("Offer.PromotionIsApplicable",t),null}},GetOfferservedInSession:function(t,i){return discountNinja.Cache.SessionGet("offer-served-session-"+t+"-"+i)},SetOfferservedInSession:function(t,i,n){discountNinja.Cache.SessionSet("offer-served-session-"+t+"-"+i,n)},GetOfferservedOnDevice:function(t,i){return discountNinja.Cache.LocalGet("offer-served-device-"+t+"-"+i)},SetOfferservedOnDevice:function(t,i,n){discountNinja.Cache.LocalSet("offer-served-device-"+t+"-"+i,n)},IsOfferAccepted:function(t,i){if("onceperdevice"===i){let i="true"===discountNinja.Cache.LocalGet("offer-accepted-"+t);return discountNinja.Logging.LogVerbose("The offer is accepted on device: "+i),i}{let i="true"===discountNinja.Cache.SessionGet("offer-accepted-"+t);return discountNinja.Logging.LogVerbose("The offer is accepted in the session: "+i),i}},SetPromotionAccepted:function(t,i,n){"onceperdevice"===i?discountNinja.Cache.LocalSet("offer-accepted-"+t,n):(discountNinja.Cache.LocalSet("offer-accepted-"+t,""),discountNinja.Cache.SessionSet("offer-accepted-"+t,n))},SetPromotionExpired:function(t,i){discountNinja.Cache.LocalSet("offer-expired-"+t,"true")},ExpireOffersAccepted:function(){if(discountNinja_Script_Offer.Offers)for(let t=0;t<discountNinja_Script_Offer.Offers.length;t++)discountNinja_Script_Offer.SetPromotionExpired(discountNinja_Script_Offer.Offers[t].Token)},GetPromotionPriceRule:function(t){t||(t=discountNinja_Script_Offer.PrimaryOffer);let i=t?discountNinja.DiscountTier.GetCurrentDiscountTier(t):null;return i?i.DiscountCode.PriceRuleId:null},GetPromotionDiscountCode:function(t){t||(t=discountNinja_Script_Offer.PrimaryOffer);let i=t?discountNinja.DiscountTier.GetCurrentDiscountTier(t):null;return i?i.DiscountCode.Code:null},PromotionForProductCacheKey:"OfferForProduct-v3.1",PromotionForCartItemCacheKey:"OfferForCartItem-v3.1",ClearPromotionForProductCache:function(){discountNinja.Cache.SessionSet(discountNinja_Script_Offer.PromotionForProductCacheKey,null),discountNinja.Cache.SessionSet(discountNinja_Script_Offer.PromotionForCartItemCacheKey,null)},GetOfferForProductFromCache:function(t,i,n,e){try{let o=discountNinja.Cache.SessionGet(discountNinja_Script_Offer.PromotionForProductCacheKey),r=void 0===o?null:JSON.parse(o);if(null!==r)for(let o=0;o<r.length;o++)if(r[o].ProductHandle===t&&r[o].VariantId===i&&r[o].CheckForProductPrice.toString()===n.toString()&&r[o].CheckForDiscountedVariant.toString()===e.toString()){let t=r[o].OfferNumber;return discountNinja_Script_Offer.OfferIsApplicable(discountNinja_Script_Offer.Offers[t])?t:null}return null}catch(t){return discountNinja.Logging.LogError("Offer.GetOfferForProductFromCache",t),null}},AddPromotionForProductToCache:function(t,i,n,e,o){try{let a=discountNinja.Cache.SessionGet(discountNinja_Script_Offer.PromotionForProductCacheKey),c=void 0===a?null:JSON.parse(a);c||(c=[]);var r=c.filter(function(n,r,a){return n.ProductHandle!==t&&n.VariantId!==i&&n.CheckForProductPrice.toString()===e.toString()&&n.CheckForDiscountedVariant.toString()===o.toString()});r.push({ProductHandle:t,VariantId:i,OfferNumber:n,CheckForProductPrice:e,CheckForDiscountedVariant:o}),discountNinja.Cache.SessionSet(discountNinja_Script_Offer.PromotionForProductCacheKey,JSON.stringify(r))}catch(t){discountNinja.Logging.LogError("Offer.AddPromotionForProductToCache",t)}},GetOfferForCartItemFromCache:function(t){try{let i=discountNinja.Cache.SessionGet(discountNinja_Script_Offer.PromotionForCartItemCacheKey),n=void 0===i?null:JSON.parse(i);if(null!==n)for(let i=0;i<n.length;i++)if(n[i].Key===t){let t=n[i].OfferNumber;return discountNinja_Script_Offer.OfferIsApplicable(discountNinja_Script_Offer.Offers[t])?t:null}return null}catch(t){return discountNinja.Logging.LogError("Offer.GetOfferForCartItemFromCache",t),null}},AddPromotionForCartItemToCache:function(t,i){try{let e=discountNinja.Cache.SessionGet(discountNinja_Script_Offer.PromotionForCartItemCacheKey),o=void 0===e?null:JSON.parse(e);o||(o=[]);var n=o.filter(function(i,n,e){return i.Key!==t});n.push({Key:t,OfferNumber:i}),discountNinja.Cache.SessionSet(discountNinja_Script_Offer.PromotionForCartItemCacheKey,JSON.stringify(n))}catch(t){discountNinja.Logging.LogError("Offer.AddPromotionForCartItemToCache",t)}},GetOfferForProduct:function(t,i,n,e,o,r,a,c){try{if(null==t)return discountNinja.Logging.LogWarning("No product handle passed",!0,!1),null;let s=discountNinja_Script_Offer.Offers;if(!s)return discountNinja.Logging.LogInformation("No offers available",!1),null;let u=discountNinja_Script_Offer.GetOfferForProductFromCache(t,i,a,c);return null!==u?"no_applicable_offer"===u?(discountNinja.Logging.LogVerbose("Returning from cache: no applicable offer for product "+t),null):(discountNinja.Logging.LogVerbose("Returning from cache: using offer "+s[u].Token+" for product "+t),s[u]):null===(u=discountNinja_Script_Offer.GetApplicableOfferNumberInternal(s,t,i,n,e,o,r,a,!1,c))?(discountNinja_Script_Offer.AddPromotionForProductToCache(t,i,"no_applicable_offer",a,c),discountNinja.Logging.LogInformation("No applicable offer available for product "+t,!1),null):(discountNinja_Script_Offer.AddPromotionForProductToCache(t,i,u,a,c),discountNinja.Logging.LogVerbose("Using offer "+s[u].Token+" for product "+t),s[u])}catch(t){discountNinja.Logging.LogError("Offer.GetOfferForProduct",t)}},GetOfferForCartItem:function(t,i,n,e,o,r,a){try{let c=discountNinja_Script_Offer.Offers;if(!c)return discountNinja.Logging.LogInformation("No offers available",!1),null;let s=discountNinja_Script_Offer.GetOfferForCartItemFromCache(t);return null!==s?"no_applicable_offer"===s?(discountNinja.Logging.LogVerbose("Returning from cache: no applicable offer for product "+i),null):(discountNinja.Logging.LogVerbose("Returning from cache: using offer "+c[s].Token+" for product "+i),c[s]):null===(s=discountNinja_Script_Offer.GetApplicableOfferNumberInternal(c,i,n,e,o,r,a,!1,!0,!0))?(discountNinja_Script_Offer.AddPromotionForCartItemToCache(t,"no_applicable_offer"),discountNinja.Logging.LogInformation("No applicable offer available for product "+i,!1),null):(discountNinja_Script_Offer.AddPromotionForCartItemToCache(i,s),discountNinja.Logging.LogVerbose("Using offer "+c[s].Token+" for product "+i),c[s])}catch(t){discountNinja.Logging.LogError("Offer.GetOfferForProduct",t)}},GetApplicableOfferNumberInternal:function(t,i,n,e,o,r,a,c,s,u){function d(t,i){let n=discountNinja.Prerequisite.EntitledQuantity(t,i);return null===n||n>0}function l(t,i,e,o){try{if("line_item"!==t.Entitlement.TargetType)return discountNinja.Logging.LogVerbose("Offer with token "+t.Token+" not valid for product "+i+" - Shipping only"),!1;if("each"!==t.Entitlement.AllocationMethod)return discountNinja.Logging.LogVerbose("Offer with token "+t.Token+" not valid for product "+i+" - Cart level only"),!1;if(u&&t.Entitlement.ExcludeCollectionHandles&&t.Entitlement.ExcludeCollectionHandles.indexOf("%")>-1&&a>r)return discountNinja.Logging.LogVerbose("Offer with token "+t.Token+" not valid for variant "+n+" - Discounted variant"),!1;if(discountNinja.Utilities.StringIsIn(e,t.Entitlement.ExcludeCollectionHandles))return discountNinja.Logging.LogVerbose("The offer is not valid for product "+i+" because that product is in an exclude collection."),!1;if("collection"===t.Entitlement.EntitledItemType){if(!discountNinja.Utilities.StringIsIn(e,t.Entitlement.EntitledCollectionHandles))return discountNinja.Logging.LogVerbose("The offer is not valid for product "+i+" because that product is not in the set of promoted collections."),discountNinja.Logging.LogVerbose("The offer applies to products in the collections '"+t.Entitlement.EntitledCollectionHandles+"' the product '"+i+" is in collections '"+e+"'."),!1}else if("product"===t.Entitlement.EntitledItemType){if(!discountNinja.Utilities.StringIsIn(t.Entitlement.EntitledProductHandles,i))return discountNinja.Logging.LogVerbose("The offer is not valid for product "+i+" because that product is not in the set of promoted products."),discountNinja.Logging.LogVerbose("The offer applies to products '"+t.Entitlement.EntitledProductHandles+"' the product '"+i+" is not in that list."),!1}else if("site"!==t.Entitlement.EntitledItemType)return discountNinja.Logging.LogErrorMessage("Offer.OfferIsValidForProduct","TargetType unknown"),!1;return discountNinja.Logging.LogVerbose("Offer is valid for product"),!0}catch(t){return discountNinja.Logging.LogError("Offer.OfferIsValidForProduct",t),!1}}function g(t,i,n){try{let e=t.Entitlement.ValueType,o=i.Amount,r=i.Percentage,a=discountNinja.Settings.Settings.CurrencySettings.RoundPrices,c=discountNinja.Settings.Settings.CurrencySettings.RoundToCents,s=0;if("fixed_amount"===e?s=n-o:"percentage"===e&&(s=parseFloat((n-Math.floor(n*r)/100).toFixed(4))),s<0&&(s=0),a){let t=100*s;if(t>0){t=100*Math.floor(t/100)+c}s=Math.round(t)/100}return Math.round(100*s)/100}catch(t){discountNinja.Logging.LogError("Offer.TestDiscountedPrice",t)}}try{let n=e||discountNinja.LiquidData.ProductCollections(),o=null,a=null;for(let e=0;e<t.length;e++){let c=t[e];if(discountNinja.Logging.LogVerbose("Checking offer "+(e+1)+" with token "+c.Token),discountNinja_Script_Offer.OfferIsApplicable(c)&&l(c,i,n)&&discountNinja_Script_Offer.IsOfferAccepted(c.Token,c.Frequency)){discountNinja.Logging.LogVerbose("Offer "+(e+1)+" with token "+c.Token+" - Valid");let t=discountNinja.DiscountTier.GetCurrentDiscountTier(c);if(t)if(!s||d(c,t)){let i=g(c,discountNinja.DiscountTier.GetPercentageAmountFromDiscountTier(t),r);(null===a||i<a)&&(o=e,a=i)}else discountNinja.Logging.LogVerbose("Offer with token "+c.Token+" is over allocated - Not valid");else discountNinja.Logging.LogVerbose("No tier detected for offer with token "+c.Token+" - Not valid")}else discountNinja.Logging.LogVerbose("Offer "+(e+1)+" with token "+c.Token+" - Not valid")}return o}catch(t){return discountNinja.Logging.LogError("Offer.GetOfferForProductInternal",t),!1}},GetTokenForProductFromCache:function(t){return discountNinja.Cache.SessionGet("token-forproduct-"+t)},SetTokenForProductInCache:function(t,i){discountNinja.Cache.SessionSet("token-forproduct-"+t,i)},GetFromCache:function(t){try{let i=discountNinja.Cache.SessionGet("offer-data-"+t);return"undefined"===i?[]:JSON.parse(i)}catch(t){return discountNinja.Logging.LogError("Offer.GetFromCache",t),null}},SaveToCache:function(t){try{discountNinja.Cache.SessionSet("offer-data-"+t.Token,JSON.stringify(t))}catch(t){discountNinja.Logging.LogError("Offer.SaveToCache",t)}},RemoveFromCache:function(t){try{discountNinja.Cache.SessionRemove("offer-data-"+t)}catch(t){return discountNinja.Logging.LogError("Offer.RemoveFromCache",t),null}},Stop:function(t){try{discountNinja.Logging.LogVerbose("Stopping offer."),discountNinja.DiscountCode.Remove(t),discountNinja.Notification.Remove(t),discountNinja.PopUp.Hide(t),discountNinja.StickyBar.Remove(t),discountNinja.DynamicPricing.Show(!1),discountNinja_Script_Offer.SetPromotionExpired(t)}catch(t){discountNinja.Logging.LogError("Offer.Stop",t)}},UnApply:function(t){try{discountNinja.Logging.LogVerbose("Unapplying offer."),discountNinja.DiscountCode.Remove(t),discountNinja.Notification.Remove(t)}catch(t){discountNinja.Logging.LogError("Offer.UnApply",t)}},ExpireAll:function(){try{discountNinja.Logging.LogVerbose("Expired. Stopping all offers with timers. Undoing all side effects"),discountNinja.DiscountCode.Clear(),discountNinja.ShortCode.HideShortcodePlaceholders(),discountNinja.Notification.Clear(),discountNinja.Notification.Hide(!1),discountNinja.StickyBar.Clear(),discountNinja.StickyBar.Hide(!1);let t=discountNinja_Script_Offer.PrimaryOffer;t&&discountNinja.PopUp.Hide(t.Token),discountNinja.DynamicPricing.Show(!1),discountNinja_Script_Offer.ExpireOffersAccepted(),discountNinja.DiscountedCart.IsDirty=!0,discountNinja.DiscountedCart.BuildDiscountedCart(function(){discountNinja.PromotionFlow.StartFlow()})}catch(t){discountNinja.Logging.LogError("Offer.ExpireAll",t)}},GetTier:function(t,i){try{return t.Tiers.length>i?offers.Tiers[i]:null}catch(t){return discountNinja.Logging.LogError("Offer.GetTier",t),null}},PrerequisiteItemsCartValue:function(t){try{let i=function(t){try{let i=discountNinja.Cache.SessionGet("PrerequisiteItemsCartValue"),n=void 0===i?null:JSON.parse(i);if(null!==n)for(let i=0;i<n.length;i++)if(n[i].Token===t)return n[i].Value;return null}catch(t){discountNinja.Logging.LogError("DiscountedCart.GetPrerequisiteItemsCartValueFromCache",t)}}(t.Token);if(null!==i)return i;let n=0;return"*"===t.Prerequisite.PrerequisiteCollections?n=discountNinja.LiquidData.ValueInCartExcludingGifts(t.Prerequisite.PrerequisiteExcludeCollections):t.Prerequisite.PrerequisiteCollections?n=discountNinja.LiquidData.ValueInCartFromCollections(t.Prerequisite.PrerequisiteCollections,t.Prerequisite.PrerequisiteExcludeCollections):t.Prerequisite.PrerequisiteProducts&&(n=discountNinja.LiquidData.ValueInCartFromProducts(t.Prerequisite.PrerequisiteProducts,t.Prerequisite.PrerequisiteExcludeCollections)),discountNinja.Logging.LogVerbose("Cart value for prerequisite items of offer "+t.Token+" is "+n),function(t,i){try{let n=discountNinja.Cache.SessionGet("PrerequisiteItemsCartValue"),e=void 0===n?null:JSON.parse(n);e||(e=[]),e.push({Token:t,Value:i}),discountNinja.Cache.SessionSet("CartValue",JSON.stringify(e))}catch(t){discountNinja.Logging.LogError("DiscountedCart.AddPrerequisiteItemsCartValueToCache",t)}}(t.Token,n),n}catch(t){return discountNinja.Logging.LogError("Offer.PrerequisiteItemsCartValue",t),0}},EligibleItemsCartValue:function(t){try{let i=function(t){try{let i=discountNinja.Cache.SessionGet("EligibleItemsCartValue"),n=void 0===i?null:JSON.parse(i);if(null!==n)for(let i=0;i<n.length;i++)if(n[i].Token===t)return n[i].Value;return null}catch(t){discountNinja.Logging.LogError("DiscountedCart.GetEligibleItemsCartValueFromCache",t)}}(t.Token);if(null!==i)return i;let n=0;return t.Entitlement.EntitledCollectionHandles?n=discountNinja.LiquidData.ValueInCartFromCollections(t.Entitlement.EntitledCollectionHandles,t.Entitlement.ExcludeCollectionHandles):"*"===t.Entitlement.EntitledProductHandles?n=discountNinja.LiquidData.ValueInCartExcludingGifts(t.Entitlement.ExcludeCollectionHandles):t.Entitlement.EntitledProductHandles&&(n=discountNinja.LiquidData.ValueInCartFromProducts(t.Entitlement.EntitledProductHandles,t.Entitlement.ExcludeCollectionHandles)),discountNinja.Logging.LogVerbose("Cart value for eligible items of offer "+t.Token+" is "+n),function(t,i){try{let n=discountNinja.Cache.SessionGet("EligibleItemsCartValue"),e=void 0===n?null:JSON.parse(n);e||(e=[]),e.push({Token:t,Value:i}),discountNinja.Cache.SessionSet("CartValue",JSON.stringify(e))}catch(t){discountNinja.Logging.LogError("DiscountedCart.AddEligibleItemsCartValueToCache",t)}}(t.Token,n),n}catch(t){return discountNinja.Logging.LogError("Offer.EligibleItemsCartValue",t),0}}},discountNinja_Script_ProductData={CachePrefix:function(){return"productdata-v3.1-"},ServerUrl:function(){return"prod"===discountNinja.Core.Environment?"https://promotionapi-afd.discountninja.io":"https://discountninjav2-promotionapi-dev.azurewebsites.net"},SaveProductDataToCache:function(t,i,n,e,o,r,a){try{discountNinja.Logging.LogVerbose("Saving product data for handle: "+t);let c={CompareAtPrice:i,Price:n,Inventory:r,Collections:e,CollectionsComplete:o,Source:a},s=discountNinja_Script_ProductData.GetByProductHandle(t,!1);if(!s)return void discountNinja.Cache.LocalSet(discountNinja_Script_ProductData.CachePrefix()+t,JSON.stringify(c));if("product"===a||"collection"===a){if(discountNinja.Cache.SessionSet(discountNinja_Script_ProductData.CachePrefix()+"session-"+t,"true"),"product"===a)return void discountNinja.Cache.LocalSet(discountNinja_Script_ProductData.CachePrefix()+t,JSON.stringify(c));if("collection"===a)return s.CollectionsComplete&&!c.CollectionsComplete?c.Collections=s.Collections:null===s.Collections&&(c.CollectionsComplete||null!==c.Collections||discountNinja.Environment.Shopify.IsCollectionPage()&&!discountNinja.Environment.Shopify.IsCatalogPage()&&(c.Collections=discountNinja.Environment.Shopify.CollectionHandle(),c.CollectionsComplete=!1,discountNinja.Logging.LogVerbose("No collections data, setting current collection for: "+t))),void discountNinja.Cache.LocalSet(discountNinja_Script_ProductData.CachePrefix()+t,JSON.stringify(c))}else{if("product"!==s.Source||!discountNinja.Cache.SessionGet(discountNinja_Script_ProductData.CachePrefix()+"session-"+t))return"server"===a?void discountNinja.Cache.LocalSet(discountNinja_Script_ProductData.CachePrefix()+t,JSON.stringify(c)):"product"===s.Source||"collection"===s.Source||"server"===s.Source?void discountNinja.Logging.LogVerbose("Current cached product data is from "+s.Source+" and new data is from a less trustworthy source "+c.Source+" , skipping save for handle: "+t):void discountNinja.Cache.LocalSet(t,JSON.stringify(c));discountNinja.Logging.LogVerbose("Current cached product data is from product page and new data is not from liquid, skipping save for handle: "+t)}}catch(t){return discountNinja.Logging.LogError("ProductData.SaveProductDataToCache",t),null}},GetDataFromCollectionAttribute:function(t,i,n){try{let e=i.toLowerCase(),o=jQuery(t).attr("data-limoniapps-discountninja-product-"+e);if(o||(o=jQuery(t).attr("data-limoniapps-discounturl-product-"+e)),!o&&n){let t=discountNinja.LiquidData.CollectionProductByHandle(n);t&&(o=t[i])}return void 0===o?null:o}catch(t){return discountNinja.Logging.LogError("GetDataFromCollectionAttribute",t),null}},SaveProductDataUsingDataTags:function(t){try{let i=!0,n=discountNinja_Script_ProductData.GetDataFromCollectionAttribute(t,"Handle"),e=discountNinja_Script_ProductData.GetDataFromCollectionAttribute(t,"Price",n),o=discountNinja_Script_ProductData.GetDataFromCollectionAttribute(t,"CompareAtPrice",n),r=discountNinja_Script_ProductData.GetDataFromCollectionAttribute(t,"Collections",n);if(r||!discountNinja.Environment.Shopify.IsCollectionPage()||discountNinja.Environment.Shopify.IsCatalogPage()||(r=discountNinja.Environment.Shopify.CollectionHandle(),i=!1),!(null!=n&&null!=e&&null!=o&&null!=r))return void discountNinja.Logging.LogVerbose("Incomplete data in tags for handle: "+n+", aborting");discountNinja.Logging.LogVerbose("Saving product data for collection product with handle: "+n),discountNinja_Script_ProductData.SaveProductDataToCache(n,o,e,r,i,null,"collection")}catch(t){return discountNinja.Logging.LogError("ProductData.SaveProductDataUsingDataTags",t),null}},Save:function(){try{discountNinja.Logging.LogVerbose("Saving product data for products on page");let t=jQuery("[data-limoniapps-discountninja-product-handle]");for(let i=0;i<t.length;i++)discountNinja.ProductData.SaveProductDataUsingDataTags(t[i]);if(discountNinja.Environment.Shopify.IsProductPage()){handle=discountNinja.Environment.Shopify.ProductHandle();let t=discountNinja.LiquidData.ProductDefaultVariantId(handle);if(t){let i=discountNinja.LiquidData.Inventory(t);if(price=discountNinja.LiquidData.Price(t),null===price)return void discountNinja.Logging.LogVerbose("No price available");price*=100,compareAtPrice=100*discountNinja.LiquidData.CompareAtPrice(t),collections=discountNinja.LiquidData.ProductCollections(),discountNinja.Logging.LogVerbose("Saving product data for products on page - detected product page product with handle: "+handle),discountNinja_Script_ProductData.SaveProductDataToCache(handle,compareAtPrice,price,collections,!0,i,"product")}}if(window.discountNinjaContext&&window.discountNinjaContext.Cart&&window.discountNinjaContext.Cart.items&&window.discountNinjaContext.Cart.length>0)for(let t=0;t<window.discountNinjaContext.Cart.length;t++){handle=window.discountNinjaContext.Cart.items[t].handle,discountNinja_Script_ProductData.GetByProductHandle(handle,!0)||(variant=discountNinja.LiquidData.ProductDefaultVariantId(handle),inventory=discountNinja.LiquidData.Inventory(variant),price=discountNinja.LiquidData.Price(variant),null!==originalPrice?(price*=100,compareAtPrice=100*discountNinja.LiquidData.CompareAtPrice(variant),discountNinja.Logging.LogVerbose("Saving product data for products on page - detected cart product with handle: "+handle),discountNinja_Script_ProductData.SaveProductDataToCache(handle,compareAtPrice,price,null,!1,inventory,"cart")):discountNinja.Logging.LogVerbose("No price available"))}}catch(t){return void discountNinja.Logging.LogError("ProductData.Save",t)}},SaveOnAddToCart:function(t){try{let i=100*discountNinja.LiquidData.PriceFromCartByProductHandle(t);discountNinja_Script_ProductData.SaveProductDataToCache(t,null,i,null,!1,null,"addtocart")}catch(t){return discountNinja.Logging.LogError("ProductData.Save",t),null}},GetByVariant:function(t,i){try{let n=discountNinja.LiquidData.ProductHandleFromCart(t);return discountNinja_Script_ProductData.GetByProductHandle(n,i)}catch(t){return discountNinja.Logging.LogError("ProductData.Get",t),null}},GetProductDataFromServer:function(t){function i(t){try{if(!t)return;discountNinja.Cache.SessionSet(discountNinja_Script_ProductData.CachePrefix()+"session-"+t.Handle,"true"),discountNinja.Cache.SessionSet(n(t.Handle),JSON.stringify(t)),discountNinja.Logging.LogVerbose("Retrieved product data from server for product with handle: "+t.Handle),discountNinja_Script_ProductData.SaveProductDataToCache(t.Handle,t.CompareAtPrice,t.Price,t.Collections,!0,0,"server"),discountNinja.DynamicPricing.UpdatePriceDebouncedAfterServerUpdate()}catch(t){return discountNinja.Logging.LogError("ProductData.GetProductDataFromServer.ProductDataReady",t),null}}function n(t){return"productdata-servercache-"+t}try{let o=discountNinja.Cache.SessionGet(n(t));if(o)return i(JSON.parse(o));let r="productdata-servercache-requested-"+t,a=discountNinja.Cache.SessionGet(r);if("5"===a)return"attempts-exhausted";var e=a?parseInt(a):0;isNaN(e)&&(e=0),discountNinja.Cache.SessionSet(r+1,!0);let c=discountNinja.Core.Shop,s=t;discountNinja.Logging.LogVerbose("Getting product data from server for product with handle: "+s),discountNinja.XmlHttpRequest.Send(discountNinja_Script_ProductData.ServerUrl()+"/api/ProductData",function(t,i){try{let n={};t&&(n.shop=t),i&&(n.handle=i);let e=discountNinja.DeviceId.Get();return n.m=e+"-"+moment().format("x"),n.version=discountNinja.Core.Version,n}catch(t){return discountNinja.Logging.LogError("ProductData.GetProductDataFromServer.GetProductDataFromServer",t),null}}(c,s),null,"get",!0,!0,i)}catch(t){discountNinja.Logging.LogError("ProductData.GetProductDataFromServer",t)}},GetByProductHandle:function(t,i,n,e){function o(i){try{if(null===i)return!1;let n=("server"===i.Source||"product"===i.Source)&&"true"===discountNinja.Cache.SessionGet(discountNinja_Script_ProductData.CachePrefix()+"session-"+t);return"collection"===i.Source&&i.CollectionsComplete&&void 0!==i.Price&&null!==i.Price&&void 0!==i.CompareAtPrice&&null!==i.CompareAtPrice||n}catch(t){discountNinja.Logging.LogError("ProductData.GetByProductHandle.IsComplete",t)}}try{let r=discountNinja.Cache.LocalGet(discountNinja_Script_ProductData.CachePrefix()+t),a="undefined"===r?null:JSON.parse(r);null===i&&(i=!1);let c=o(a);return!c&&n&&e&&(discountNinja.ProductData.SaveProductDataUsingDataTags(e),c=o(a="undefined"===(r=discountNinja.Cache.LocalGet(discountNinja_Script_ProductData.CachePrefix()+t))?null:JSON.parse(r))),i&&!c&&discountNinja_Script_ProductData.GetProductDataFromServer(t),a}catch(t){return discountNinja.Logging.LogError("ProductData.GetByProductHandle",t),null}}},discountNinja_Script_PromotionEvent={Queue:"promotionevent-queue",ServerUrl:function(){return"prod"===discountNinja.Core.Environment?"https://promotioneventsapi.discountninja.io":"https://discountninjav2-promotioneventsapi-dev.azurewebsites.net"},PromotionEventKey:function(t,i,n){return"offerevent-sent-"+t+"-"+i+"-"+n},GetPromotionEventSentInSession:function(t,i,n){return discountNinja.Cache.SessionGet(discountNinja_Script_PromotionEvent.PromotionEventKey(t,i,n))},SetPromotionEventSentInSession:function(t,i,n,e){discountNinja.Cache.SessionSet(discountNinja_Script_PromotionEvent.PromotionEventKey(t,i,n),e)},GetQueue:function(){try{let t=discountNinja.Cache.LocalGet(discountNinja_Script_PromotionEvent.Queue);return JSON.parse(t)}catch(t){return discountNinja.Logging.LogError("PromotionEvent.GetQueue",t),null}},AddToQueue:function(t,i){try{if(discountNinja.TestMode.TestMode)return;let n=discountNinja_Script_PromotionEvent.GetQueue();null===n&&(n=[]),n.push({offerToken:t.Token,eventType:i,processed:!1}),discountNinja_Script_PromotionEvent.SaveQueue(n)}catch(t){discountNinja.Logging.LogError("PromotionEvent.AddToQueue",t)}},SaveQueue:function(t){try{let i=[];for(let n=0;n<t.length;n++){let e=t[n];e.processed||i.push(e)}discountNinja.Cache.LocalSet(discountNinja_Script_PromotionEvent.Queue,JSON.stringify(i))}catch(t){discountNinja.Logging.LogError("PromotionEvent.SaveQueue",t)}},ProcessQueue:function(){function t(t){try{if("sent"===discountNinja_Script_PromotionEvent.GetPromotionEventSentInSession(t.offerToken,"",t.eventType))return discountNinja.Logging.LogVerbose("Event of type "+t.eventType+" already sent for offer with token "+t.offerToken),void(t.processed=!0);discountNinja.Logging.LogVerbose("Logging event of type "+t.eventType),discountNinja.XmlHttpRequest.Send(discountNinja_Script_PromotionEvent.ServerUrl()+"/api/AddPromotionEvent",function(t){try{let i={};i.token=t.offerToken,i.deviceId=discountNinja.DeviceId.Get(),i.eventType=t.eventType,i.shop=discountNinja.Core.Shop,i.version=discountNinja.Core.Version;let n=discountNinja.DeviceId.Get();return i.m=n+"-"+moment().format("x"),i}catch(t){return discountNinja.Logging.LogError("PromotionEvent.LogPromotionEvent.BuildParameters",t),null}}(t),null,"get",!0,!0,function(i){try{i?(discountNinja.Logging.LogVerbose("Log event of type "+t.eventType+" completed successfully"),function(t){try{let i=discountNinja_Script_PromotionEvent.GetQueue();for(let n=0;n<i.length;n++){let e=i[n];e.offerToken===t.offerToken&&e.eventType===t.eventType&&(e.processed=!0)}discountNinja.Cache.LocalSet(discountNinja_Script_PromotionEvent.Queue,JSON.stringify(i))}catch(t){discountNinja.Logging.LogError("PromotionEvent.SaveQueue",t)}}(t),discountNinja_Script_PromotionEvent.SetPromotionEventSentInSession(t.offerToken,"",t.eventType,"sent")):discountNinja.Logging.LogErrorMessage("PromotionEvent.LogPromotionEvent.onLogComplete","Could not log event of type "+t.eventType)}catch(t){discountNinja.Logging.LogError("PromotionEvent.LogPromotionEvent.onLogComplete",t)}})}catch(t){discountNinja.Logging.LogError("PromotionEvent.LogPromotionEvent",t)}}try{let i=discountNinja_Script_PromotionEvent.GetQueue();null===i&&(i=[]);for(let n=0;n<i.length;n++){let e=i[n];e.processed||t(e)}discountNinja_Script_PromotionEvent.SaveQueue(i)}catch(t){discountNinja.Logging.LogError("PromotionEvent.ProcessQueue",t)}}},discountNinja_Script_PromotionFlow={HandlingDrawerCartTimeoutHandle:null,HandlingDrawerCartTimeout:!1,ShowStickyBar:function(){try{if(function(){try{let t="",i=discountNinja.Settings.Settings.StickyBarSettings;return i.Enabled||(t="Sticky bar is not required because that building block is disabled"),"mobileonly"!==i.DisplayOnDevices||discountNinja.Utilities.IsMobilePhone()?"desktoponly"===i.DisplayOnDevices&&discountNinja.Utilities.IsMobilePhone()&&(t="Sticky bar is not displayed on mobile phones"):t="Sticky bar is only displayed on mobile phones",discountNinja_Script_PromotionFlow.HandleFlowErrorMessage(t,!1)}catch(t){return discountNinja.Logging.LogError("PromotionFlow.ShowStickyBar.IsStickyBarRequired",t),!1}}()){discountNinja.StickyBar.Clear();let t=discountNinja.Offer.Offers;if(t){for(let i=0;i<t.length;i++){let n=t[i];""===discountNinja_Script_PromotionFlow.IsBuildingBlockEnabledForPage(discountNinja.Settings.Settings.StickyBarSettings,"","Sticky bar")?n.StickyBarSettings&&(n.StickyBarSettings.Body||n.StickyBarSettings.TimerFooter)?(discountNinja.Logging.LogVerbose("Adding sticky bar message for offer with token "+n.Token),discountNinja.StickyBar.Add(n.Token)):discountNinja.Logging.LogVerbose("No sticky bar message for offer with token "+n.Token):discountNinja.Logging.LogVerbose("Sticky bar message for offer with token "+n.Token+" not added")}discountNinja.StickyBar.Show()}}else discountNinja.Logging.LogVerbose("Sticky bar not added")}catch(t){discountNinja.Logging.LogError("PromotionFlow.ShowStickyBar",t)}},HideAdditionalCheckoutButtons:function(){function t(t,i){try{return t+" "+i}catch(t){discountNinja.Logging.LogError("PromotionFlow.HideAdditionalCheckoutButtons.AppendToStyleString",t)}}function i(t){try{return t+" { display: none !important; }"}catch(t){discountNinja.Logging.LogError("PromotionFlow.HideAdditionalCheckoutButtons.CreateHideClassStyle",t)}}try{let n="limoniapps-additionalcheckoutbuttons-style";if(discountNinja.Settings.Settings.PriceUpdateSettings.HideAdditionalCheckoutButtons){!function(n,e,o,r){try{let r="";for(let n=0;n<e.length;n++)r=t(r,i(e[n]));o&&function(t){try{return 0===jQuery("#"+t).length}catch(t){discountNinja.Logging.LogError("PromotionFlow.HideAdditionalCheckoutButtons.AdditionalCheckoutButtonsStyleSheetNotInjected",t)}}(n)&&function(t,i){try{discountNinja.Logging.LogVerbose("Adding css :"+t);let n=document.createElement("style");n.type="text/css",n.id=i,n.styleSheet?n.styleSheet.cssText=t:n.appendChild(document.createTextNode(t)),document.getElementsByTagName("head")[0].appendChild(n)}catch(t){discountNinja.Logging.LogError("PromotionFlow.HideAdditionalCheckoutButtons.AddInlineCssToDocument",t)}}(r,n)}catch(t){discountNinja.Logging.LogError("PromotionFlow.HideAdditionalCheckoutButtons.HideAdditionalCheckoutButtonsInternal",t)}}(n,[".additional-checkout-buttons",".additional-checkout-button",".shopify-payment-button",'[data-shopify="dynamic-checkout-cart"]',".paypal-buttons"],!0)}jQuery('form[action^="/checkout"]').find(":submit").addClass("saso-ignore")}catch(t){discountNinja.Logging.LogError("PromotionFlow.HideAdditionalCheckoutButtons",t)}},SwitchToCustomCheckoutButton:function(){try{jQuery(".limoniapps-discountninja-checkoutbutton-hide").hide(),jQuery(".limoniapps-discountninja-checkoutbutton-show").show()}catch(t){discountNinja.Logging.LogError("PromotionFlow.SwitchToCustomCheckoutButton",t)}},DisplayAppliedOffers:function(){try{discountNinja.DiscountCode.InjectDiscountCodesInHtml(),discountNinja.DynamicPricing.UpdatePrice(!1,!0),""!==discountNinja.DiscountCode.GetActiveDiscountCodesForCheckoutAsString()&&(discountNinja_Script_PromotionFlow.HideAdditionalCheckoutButtons(),!0===discountNinjaContext.Flags.CustomCheckoutButton&&discountNinja_Script_PromotionFlow.SwitchToCustomCheckoutButton()),discountNinja.ShortCode.ShowShortcodePlaceholders(),discountNinja_Script_PromotionFlow.ShowNotifications(),discountNinja_Script_PromotionFlow.ShowStickyBar()}catch(t){discountNinja.Logging.LogError("PromotionFlow.DisplayAppliedOffers",t)}},StartFlow:function(){try{if(!discountNinja.Settings.Settings)return void discountNinja.Logging.LogInformation("FLOW: Canceling since no settings are available");discountNinja.Logging.LogInformation("FLOW: Starting flow"),discountNinja.Offer.PrimaryOffer=null,discountNinja.StickyBar.Clear(),discountNinja.Notification.Clear(),discountNinja.Trigger.Clear(),discountNinja.DiscountCode.EnableDiscountCodeField(),discountNinja.Environment.Shopify.IsCartPage()||discountNinja.VariantChange.RegisterEventHandlerForVariantChange(),discountNinja.Offer.ClearPromotionForProductCache(),discountNinja.DiscountCode.UndoInjectDiscountCodesInHtml(),function(){let t=discountNinja.Offer.Offers;if(t)for(let i=0;i<t.length;i++){let n=t[i];if(discountNinja.Offer.OfferIsApplicable(n)){let e=discountNinja.Offer.PrerequisiteItemsCartValue(n);discountNinja.DiscountTier.GetCurrentDiscountTierNumber(n,e)!==discountNinja.DiscountTier.GetMaxDiscountTierNumber(n)&&discountNinja.Offer.UnApply(t[i].Token)}else discountNinja.Offer.Stop(t[i].Token)}}(),function(){try{let t=new(discountNinja.Utilities.GetMutationObserver())(function(t){try{for(let i=0;i<t.length;i++)for(let n=0;n<t[i].addedNodes.length;n++){let e=t[i].addedNodes[n];if(null!=e&&null!==e.nodeName&&void 0!==e.nodeName&&-1===e.nodeName.indexOf("text")){let t=e.nodeName.toLowerCase(),i=jQuery(e).html(),n=jQuery("body").css("margin-top");"form"===t?(discountNinja.Logging.LogVerbose("Form added"),discountNinja.Checkout.Shopify.RegisterEventHandlerForCheckout()):null!=i&&"function"==typeof i.indexOf&&(i.indexOf("<a")>-1||i.indexOf("<button")>-1)&&(i.indexOf("/checkout")>-1||i.indexOf("/cart")>-1)?(discountNinja.Logging.LogVerbose("Anchor or button with link to checkout added"),discountNinja.Checkout.Shopify.RegisterEventHandlerForCheckout()):"div"===t&&"function"==typeof e.getAttribute&&"spurit-occ-popup"===e.getAttribute("id")?(discountNinja.Logging.LogVerbose("Div spurit-occ-popup added"),discountNinja.Checkout.Shopify.RegisterEventHandlerForCheckout()):"div"===t&&"function"==typeof e.getAttribute&&"qab_bar"===e.getAttribute("id")?(discountNinja.Logging.LogVerbose("Div qab_bar added"),jQuery("#qab_bar").css("top",n)):"div"===t&&"function"==typeof e.getAttribute&&"fsb_background"===e.getAttribute("id")?(discountNinja.Logging.LogVerbose("Div fsb_background added"),discountNinja.Utilities.IsMobilePhone()||jQuery("#fsb_background").css("top",n)):"div"===t&&"function"==typeof e.getAttribute&&"spb-information-bar"===e.getAttribute("id")?(discountNinja.Logging.LogVerbose("Div spb-information-bar added"),jQuery("#spb-information-bar").css("top",n)):"div"===t&&"function"==typeof e.getAttribute&&"wheelio_holder"===e.getAttribute("class")?(discountNinja.Logging.LogVerbose("Wheelio popup added, registering hook"),jQuery(".wheelio_holder .wlo_btn.wlo_copy_code").on("click",function(t){discountNinja.Logging.LogVerbose("Offer triggered via wheelio apply button");let i=jQuery(".wheelio_holder .wlo_input_code").val();discountNinja_Script_PromotionFlow.TriggerPromotion(i)})):"function"==typeof e.getAttribute&&e.getAttribute("class")&&e.getAttribute("class").indexOf("limoniapps-discountninja-cart-root")>0?(discountNinja.Logging.LogVerbose("Cart added, updating prices"),setTimeout(discountNinja.DynamicPricing.ReplacePricesInCart(),1e3)):"function"==typeof e.getAttribute&&e.getAttribute("class")&&e.getAttribute("class").indexOf("limoniapps-discountninja-productprice")>0&&(discountNinja.Logging.LogVerbose("Product price element dynamically added, updating prices"),discountNinja.DynamicPricing.UpdatePriceDebouncedAfterInject())}}}catch(t){discountNinja.Logging.LogError("PromotionFlow.ListenForDynamicallyAddedElements.mutationObserver",t)}}),i={attributes:!1,childList:!0,subtree:!0,characterData:!1};t.observe(document.body,i)}catch(t){discountNinja.Logging.LogError("PromotionFlow.ListenForDynamicallyAddedElements",t)}}(),function(){try{let t=jQuery(".limoniapps-discountninja-drawercart-anchor");t.length>0&&(targetNode=t.get()[0],new MutationObserver(function(){let t=jQuery(targetNode).is(":visible");null!==discountNinja_Script_PromotionFlow.HandlingDrawerCartTimeoutHandle&&clearTimeout(discountNinja_Script_PromotionFlow.HandlingDrawerCartTimeoutHandle),discountNinja_Script_PromotionFlow.HandlingDrawerCartTimeoutHandle=setTimeout(function(){!function(t){try{discountNinja_Script_PromotionFlow.HandlingDrawerCartTimeoutHandle=null,discountNinja_Script_PromotionFlow.HandlingDrawerCartTimeout||(discountNinja_Script_PromotionFlow.HandlingDrawerCartTimeout=!0,discountNinja.Logging.LogVerbose("Drawer cart modified"),t?(discountNinja.Logging.LogVerbose("Drawer cart visible: minimizing notification"),discountNinja.Notification.Minimize(),discountNinja.DiscountCode.InjectDiscountCodesInHtml()):discountNinja.Logging.LogVerbose("Drawer cart hidden"),discountNinja_Script_PromotionFlow.HandlingDrawerCartTimeout=!1)}catch(t){discountNinja.Logging.LogError("PromotionFlow.HandleDrawerCartChange",t),discountNinja_Script_PromotionFlow.HandlingDrawerCartTimeoutHandle=null,discountNinja_Script_PromotionFlow.HandlingDrawerCartTimeout=!1}}(t)},500)}).observe(targetNode,{attributes:!0}))}catch(t){discountNinja.Logging.LogError("PromotionFlow.ListenForDrawerCartChanges",t)}}(),discountNinja.Trigger.MarkPageAsVisited(),discountNinja.Trigger.WaitForTriggerConditions(discountNinja.Offer.Triggers)}catch(t){discountNinja.Logging.LogError("PromotionFlow.StartFlow",t)}},IsNotificationRequired:function(){let t="",i=discountNinja.Settings.Settings.NotificationSettings;return i.Enabled||(t="Notification is not required because that building block is disabled"),"mobileonly"!==i.DisplayOnDevices||discountNinja.Utilities.IsMobilePhone()?"desktoponly"===i.DisplayOnDevices&&discountNinja.Utilities.IsMobilePhone()&&(t="Notification is not displayed on mobile phones"):t="Notification is only displayed on mobile phones",""===t&&(t=discountNinja_Script_PromotionFlow.IsBuildingBlockEnabledForPage(i,t,"Notification")),discountNinja_Script_PromotionFlow.HandleFlowErrorMessage(t,!1)},ViewPromotion:function(t){discountNinja.Logging.LogInformation("FLOW: Viewing offer"),discountNinja.PromotionEvent.AddToQueue(t,0)},AcceptPromotion:function(t){try{discountNinja.Logging.LogInformation("FLOW: Accepting offer"),discountNinja.Offer.SetPromotionAccepted(t.Token,t.Frequency,"true"),discountNinja.Offer.SaveToCache(t),discountNinja.Offer.ClearPromotionForProductCache(),discountNinja_Script_PromotionFlow.ApplyPromotionIfApplicable(t),discountNinja_Script_PromotionFlow.EvaluateBOGOProductEligibility(t)}catch(t){discountNinja.Logging.LogError("PromotionFlow.AcceptPromotion",t)}},UnAcceptPromotion:function(t){discountNinja.Offer.SetPromotionAccepted(t.Token,t.Frequency,"false")},ApplyPromotionIfApplicable:function(t){let i=discountNinja.Offer.PrerequisiteItemsCartValue(t),n=discountNinja.DiscountTier.GetCurrentDiscountTierNumber(t,i);if(null!==n&&n>0){let i=discountNinja.Offer.GetPromotionDiscountCode(t),n=discountNinja.Offer.GetPromotionPriceRule(t);discountNinja_Script_PromotionFlow.ApplyPromotion(t,i,n)}},EvaluateBOGOProductEligibility:function(offer){function HandleEntitledProductsForBOGO(goalAchieved,bogoSettings,entitledProductsIncart,token,tier){function CapUsingAllocationLimit(t){let i=offer.Entitlement.AllocationLimit;return i>0?Math.min(i,t):t||0}function RemainingQuantity(t,i){return(t||0)-(i||0)}function ExecuteDrawerCartRefreshMethod(){try{let callback=discountNinja.Settings.GetFlag("DrawerCartRefreshMethod");callback&&""!==callback&&setTimeout(function(){try{discountNinja.Logging.LogVerbose("Executing DrawerCartRefreshMethod"),eval(callback)}catch(t){discountNinja.Logging.LogError("PromotionFlow.ExecuteDrawerCartRefreshMethod.Eval",t)}},500)}catch(t){discountNinja.Logging.LogError("PromotionFlow.ExecuteDrawerCartRefreshMethod",t)}}function AfterAddToCart(){if(!offer.BogoSettings)return;let t=discountNinja.LiquidData.ItemsInCartOfVariant(offer.Entitlement.EntitledVariantIds);if(null===t&&(t=0),CapUsingAllocationLimit(goalAchieved?discountNinja.Prerequisite.EntitledQuantity(offer,tier):0)!==t){if(discountNinja.Environment.Shopify.IsCartPage()&&!1!==discountNinja.Settings.GetFlag("ReloadPageAfterAddingFreeGiftOnCart")||!0===discountNinja.Settings.GetFlag("ReloadPageAfterAddingFreeGift")){let t=discountNinja.Settings.GetFlag("CallbackAfterReloadPageAddingFreeGift");discountNinja.Cache.SessionSet("CallbackAfterReloadPageAddingFreeGift",t),location.reload()}else ExecuteDrawerCartRefreshMethod()}}if(bogoSettings){let t=goalAchieved?discountNinja.Prerequisite.EntitledQuantity(offer,tier):0;t>0&&discountNinja.PromotionEvent.AddToQueue(offer,2);let i="cartadjustment-"+token+"-"+discountNinjaContext.Cart.token,n=CapUsingAllocationLimit(t),e=RemainingQuantity(n,entitledProductsIncart),o=0;try{o=parseInt(discountNinja.Cache.SessionGet(i))}catch(t){let i=0}if(isNaN(o)&&(o=0),discountNinja.Cache.SessionSet(i,n),n!==o){let t="DiscountNinja.FreeGift."+token;if(e<0&&bogoSettings.RemoveFromCartAutomatically)discountNinja.Cart.Shopify.ChangeQuantityInCart(offer.Entitlement.EntitledVariantIds,n,t,"",function(){AfterAddToCart()});else if(e>0&&bogoSettings.AddToCartAutomatically){let i={};i[t]="",discountNinja.Cart.Shopify.AddToCart(offer.Entitlement.EntitledVariantIds,e,i,function(){AfterAddToCart()})}}}}if(null===offer)return;let bogoSettings=offer?offer.BogoSettings:null,entitledProductsIncart=bogoSettings?discountNinja.LiquidData.QuantityInCartOfVariant(offer.Entitlement.EntitledVariantIds):null,goalAchieved=discountNinja.DiscountTier.GoalAchieved(offer),tier=discountNinja.DiscountTier.GetCurrentDiscountTier(offer);HandleEntitledProductsForBOGO(goalAchieved,bogoSettings,entitledProductsIncart,offer.Token,tier)},ApplyPropertiesToLineItems:function(){if(!discountNinja.Cart.Shopify.IsDirty&&!discountNinja.DiscountedCart.IsDirty){let t=discountNinja.LiquidData.ItemsInCartWithoutProperty("DiscountNinja.");for(let i=0;i<t.length;i++){let n=discountNinja.DiscountedCart.Get(t[i].key),e=null===n?null:n.Token;discountNinja.Cart.Shopify.AddPropertiesToCartItem(t[i].key,"DiscountNinja."+(null!==n?"":"Not")+"Discounted"+(e?"."+e:""),"")}}},ApplyPromotion:function(t,i,n){try{if(null===t)return;if(discountNinja.Logging.LogInformation("FLOW: Applying offer"),discountNinja.DiscountCode.Add(t.Token,i,n,t.Entitlement.TargetType),discountNinja.Timer.ShouldStartOnAccept(t))discountNinja.Timer.Start(t);else if(discountNinja.Timer.ShouldStartOnGoalAchieved(t)){discountNinja.DiscountTier.GoalAchieved(t)&&discountNinja.Timer.Start(t)}t.NotificationSettings&&t.NotificationSettings.Body?(discountNinja.Logging.LogVerbose("Adding notification message for offer with token "+t.Token),discountNinja.Notification.Add(t.Token)):discountNinja.Logging.LogVerbose("No notification message for offer with token "+t.Token),discountNinja.PromotionEvent.AddToQueue(t,1)}catch(t){discountNinja.Logging.LogError("PromotionFlow.ApplyPromotion",t)}},ShowNotifications:function(){try{if(null===discountNinja.Offer.Offers||discountNinja.Offer.Offers.length<1)return;discountNinja_Script_PromotionFlow.IsNotificationRequired()&&discountNinja.Notification.Show(),discountNinja.TestMode.ShowTestModeOutput()}catch(t){discountNinja.Logging.LogError("PromotionFlow.ShowNotifications",t)}},StopFlow:function(){discountNinja.Logging.LogInformation("FLOW: Stopped",!0,!1),discountNinja.DiscountedCart.IsDirty=!0,discountNinja.Offer.Offers&&discountNinja.Offer.Offers.length>0&&discountNinja.PromotionFlow.DisplayAppliedOffers(),discountNinja.DynamicPricing.UnblockPricesAndButtons(),discountNinja.Checkout.Shopify.PrepareAdvancedCheckout()},IsBuildingBlockEnabledForPage:function(t,i,n){return""!==i||t.Enabled||(i=n+" is disabled"),""===i&&discountNinja.Environment.Shopify.IsProductPage()&&!t.ShowOn.ShowOnProductPages&&(i=n+" is not displayed because it is disabled for product pages"),""===i&&discountNinja.Environment.Shopify.IsHomePage()&&!t.ShowOn.ShowOnHomePage&&(i=n+" is not displayed because it is disabled for the home page"),""===i&&discountNinja.Environment.Shopify.IsBlogPost()&&!t.ShowOn.ShowOnBlogPosts&&(i=n+" is not displayed because it is disabled for blog posts"),""===i&&discountNinja.Environment.Shopify.IsCollectionPage()&&!t.ShowOn.ShowOnCollectionPages&&(i=n+" is not displayed because it is disabled for collection pages"),""===i&&discountNinja.Environment.Shopify.IsCustomPage()&&!t.ShowOn.ShowOnCustomPages&&(i=n+" is not displayed because it is disabled for custom pages"),""===i&&discountNinja.Environment.Shopify.IsCartPage()&&!t.ShowOn.ShowOnCartPage&&(i=n+" is not displayed because it is disabled for cart page"),i},HandleFlowErrorMessage:function(t,i){return!t||""===t||(i?discountNinja.Logging.LogTestMode(t,null,!0,!1,!1):discountNinja.Logging.LogVerbose(t),!1)},HasPopUpBeenShownForLevel:function(t){let i=t.Token;return"shown"===function(t){return discountNinja.Cache.LocalGet("popup-displayed-"+t)}(i)&&"onceperdevice"===t.PopUpSettings.Frequency?(discountNinja.Logging.LogInformation("FLOW: Pop-up will not be displayed for offer with token "+i+", because it has already been shown on this device. Learn more <a style='color: blue; text-decoration: underline;' href='http://support.limoniapps.com/discount-url-support-center/when-to-display-the-pop-up' target='_blank'>here</a>."),!0):"shown"===function(t){return discountNinja.Cache.SessionGet("popup-displayed-"+t)}(i)&&"oncepersession"===t.PopUpSettings.Frequency&&(discountNinja.Logging.LogInformation("FLOW: Pop-up will not be displayed for offer with token "+i+", because it has already been shown during this session. Learn more <a style='color: blue; text-decoration: underline;' href='http://support.limoniapps.com/discount-url-support-center/when-to-display-the-pop-up' target='_blank'>here</a>."),!0)}},discountNinja_Script_Settings={Settings:null,GetPriceFormat:function(t,i){return"item-product"===t?i?discountNinja_Script_Settings.Settings.PriceUpdateSettings.DrawerCartProductPriceFormat||discountNinja_Script_Settings.Settings.PriceUpdateSettings.ProductPagePriceFormat:discountNinja_Script_Settings.Settings.PriceUpdateSettings.CartProductPriceFormat||discountNinja_Script_Settings.Settings.PriceUpdateSettings.ProductPagePriceFormat:"item-line"===t?i?discountNinja_Script_Settings.Settings.PriceUpdateSettings.DrawerCartLinePriceFormat||discountNinja_Script_Settings.Settings.PriceUpdateSettings.ProductPagePriceFormat:discountNinja_Script_Settings.Settings.PriceUpdateSettings.CartLinePriceFormat||discountNinja_Script_Settings.Settings.PriceUpdateSettings.ProductPagePriceFormat:"subtotal"===t?i?discountNinja_Script_Settings.Settings.PriceUpdateSettings.DrawerCartSubtotalPriceFormat||discountNinja_Script_Settings.Settings.PriceUpdateSettings.ProductPagePriceFormat:discountNinja_Script_Settings.Settings.PriceUpdateSettings.CartSubtotalPriceFormat||discountNinja_Script_Settings.Settings.PriceUpdateSettings.ProductPagePriceFormat:"standard"===t?discountNinja.Environment.Shopify.IsProductPage()?discountNinja_Script_Settings.Settings.PriceUpdateSettings.ProductPagePriceFormat:discountNinja_Script_Settings.Settings.PriceUpdateSettings.NonProductPagePriceFormat||discountNinja_Script_Settings.Settings.PriceUpdateSettings.OtherPagePriceFormat||discountNinja_Script_Settings.Settings.PriceUpdateSettings.ProductPagePriceFormat:(discountNinja.Logging.LogWarning("GetPriceFormat - Unexpected level '"+t+"'",!0),discountNinja_Script_Settings.Settings.PriceUpdateSettings.ProductPagePriceFormat)},SettingsAreValid:function(t){try{return null==t?(discountNinja.Logging.LogWarning("No settings available",!0),!1):(discountNinja.Logging.LogVerbose("Settings valid"),!0)}catch(t){discountNinja.Logging.LogError("Settings.SettingsAreValid",t)}},GetFlag:function(t){try{return"object"!=typeof window.discountNinjaContext.Flags?null:window.discountNinjaContext.Flags[t]}catch(t){return discountNinja.Logging.LogError("Settings.GetFlag",t),null}}};const discountNinja_Script_ShortCode_Prefix_ClassName="limoniapps-discountninja-shortcode",discountNinja_Script_ShortCode_Prefix_Attribute="data-limoniapps-discountninja-shortcode";var discountNinja_Script_ShortCode={Attributes:{Offer:discountNinja_Script_ShortCode_Prefix_Attribute+"-offer",OfferToken:discountNinja_Script_ShortCode_Prefix_Attribute+"-offer-token",Product:discountNinja_Script_ShortCode_Prefix_Attribute+"-product"},Classes:{Placeholder:discountNinja_Script_ShortCode_Prefix_ClassName+"-placeholder"},HideShortcodePlaceholders:function(){try{jQuery("."+discountNinja_Script_ShortCode.Classes.Placeholder).css("display","none")}catch(t){discountNinja.Logging.LogError("ShortCode.HideShortcodePlaceholders",t)}},ShowShortcodePlaceholders:function(){try{let t="."+discountNinja_Script_ShortCode.Classes.Placeholder;jQuery(t).each(function(){jQuery(this).html(discountNinja_Script_ShortCode.ReplaceAllPlaceHolders(jQuery(this).html()))}),jQuery(t).css("display","block")}catch(t){discountNinja.Logging.LogError("ShortCode.ShowShortcodePlaceholders",t)}},RefreshResolvedPlaceholders:function(t,i,n){try{discountNinja.Logging.LogVerbose("Refreshing all resolved placeholders");let e=discountNinja_Script_ShortCode.Attributes.Product;jQuery(t).find("["+e+"]").each(function(){let t="{{"+jQuery(this).attr(e)+"}}";discountNinja.Logging.LogVerbose("Refreshing shortcode "+t),jQuery(this).html(discountNinja_Script_ShortCode.ReplaceProductLevelPlaceHolders(t,n,!1))});let o=discountNinja_Script_ShortCode.Attributes.Offer,r=discountNinja_Script_ShortCode.Attributes.OfferToken;jQuery(t).find("["+o+"]").each(function(){let t="{{"+jQuery(this).attr(o)+"}}",e=i?i.Token:jQuery(this).attr(r);if(i||(i=discountNinja.Offer.GetOfferByToken(e)),!n){let t=discountNinja.DiscountTier.GetCurrentDiscountTier(i);n=discountNinja.DiscountTier.GetPercentageAmountFromDiscountTier(t)}discountNinja.Logging.LogVerbose("Refreshing shortcode "+t+" context: offer "+e),jQuery(this).html(discountNinja_Script_ShortCode.ReplacePromotionLevelPlaceHolders(i,t,!1))}),discountNinja.MultiCurrency.UpdateCurrency()}catch(t){discountNinja.Logging.LogError("ShortCode.RefreshResolvedPlaceholders",t)}},BuildResolvedPlaceHolderAmount:function(t,i,n,e,o,r,a,c,s,u,d,l,g,p,f,m){function N(t,i,n,e,o,r,a,c,s,u,d,l,g,f,m,N,j){let S=function(t,i){return i?"{{"+t.replace("{{","").replace("}}","")+","+i+"}}":t}(e,o);return discountNinja_Script_ShortCode.ContainsPlaceHolder(i,S)&&(i=discountNinja_Script_ShortCode.BuildResolvedPlaceHolder(t,i,n,S,a,c,discountNinja.Utilities.FormatMoney(s,u,f,m,r,j),p,N,!0,r),r||(i=discountNinja_Script_ShortCode.BuildResolvedPlaceHolder(t,i,n,"<del>"+S+"</del>",a,c,discountNinja.Utilities.FormatMoney(s,d,f,m,!0,j),p,N,!0,r)),r||(i=discountNinja_Script_ShortCode.BuildResolvedPlaceHolder(t,i,n,"<strike>"+S+"</strike>",c,a,discountNinja.Utilities.FormatMoney(s,d,f,m,!0,j),p,N,!0,r)),r||(i=discountNinja_Script_ShortCode.BuildResolvedPlaceHolder(t,i,n,"<s>"+S+"</s>",c,a,discountNinja.Utilities.FormatMoney(s,d,f,m,!0,j),p,N,!0,r))),i}try{return void 0===a?i:(discountNinja_Script_ShortCode.ContainsPlaceHolder(i,e)&&(i=N(t,i,n,e,"",!1,o,r,a,c,s,0,0,l,g,f,m),i=N(t,i,n,e,"NO_DECIMALS",!1,o,r,a,c,s,0,0,l,g,f,m),i=N(t,i,n,e,"NO_CURRENCY",!1,o,r,a,c,s,0,0,l,g,f,m),i=N(t,i,n,e,"NO_DECIMALS,NO_CURRENCY",!1,o,r,a,c,s,0,0,l,g,f,m),i=N(t,i,n,e,"STRIKETHROUGH",!0,o,r,a,c,s,0,0,l,g,f,m),i=N(t,i,n,e,"STRIKETHROUGH,NO_DECIMALS",!0,o,r,a,c,s,0,0,l,g,f,m),i=N(t,i,n,e,"STRIKETHROUGH,NO_CURRENCY",!0,o,r,a,c,s,0,0,l,g,f,m),i=N(t,i,n,e,"STRIKETHROUGH,NO_DECIMALS,NO_CURRENCY",!0,o,r,a,c,s,0,0,l,g,f,m)),i)}catch(t){return discountNinja.Logging.LogError("ShortCode.BuildResolvedPlaceHolderAmount",t),i}},BuildResolvedPlaceHolder:function(t,i,n,e,o,r,a,c,s,u,d){if(void 0===a)return i;let l="",g=u?'<span class="money">'+a+"</span>":a,p=null==r?"":'class="limoniapps-discountninja-shortcode limoniapps-discountninja-shortcode-'+r+(d?" limoniapps-discountninja-strikethrough":"")+(null==s?"":" "+s)+'" ',f=discountNinja_Script_ShortCode.Attributes.OfferToken,m=t?" "+f+'="'+t.Token+'" ':"",N=(l=n?"<span "+p+discountNinja_Script_ShortCode_Prefix_Attribute+"-"+o+'="'+e.replace("{{","").replace("}}","")+'"'+m+">"+g+"</span>":g).toString().replace("$","$$$");return i.toString().replace(new RegExp(e,"g"),N)},ReplacePromotionLevelPlaceHolders:function(t,i,n){try{if(void 0===i||""===i||null===i)return i;discountNinja.Logging.LogVerbose("Replacing offer level placeholders");let e=discountNinja.Settings.Settings.CountdownClockSettings,o=window.discountNinjaContext.Labels.Here,r=discountNinja.Currency.GetCurrencyFormat(),a=discountNinja.Utilities.GetNoDecimalsCurrencyFormat(r),c=discountNinja.Utilities.GetCurrencyFormatAmountComponent(r),s=discountNinja.Utilities.GetCurrencyFormatAmountComponent(a),u=2,d=e.FormattingTemplateOnDate,l=e.FormattingTemplateOnTime,g="",p="",f=t.ScheduleSettings.EndsOnDate;if(f){let t=moment(f).utc();g=discountNinja.Timer.FormatDate(t,d),p=discountNinja.Timer.FormatDate(t,l)}let m="",N="",j=t.EndsAt;if(j){let t=moment(j).utc();m=discountNinja.Timer.FormatDate(t,d),N=discountNinja.Timer.FormatDate(t,l)}let S=0;discountNinja.DiscountedCart&&discountNinja.DiscountedCart.DiscountedCart&&discountNinja.DiscountedCart.DiscountedCart.total_discount&&(S=100*discountNinja.DiscountedCart.DiscountedCart.total_discount);let h=0,C=0;discountNinja.DiscountedCart.DiscountedCart&&(C=100*discountNinja.DiscountedCart.DiscountedCart.total_original_price),S>0&&C>0&&(h=100*Math.min(S/C,100));let y=discountNinja.DiscountTier.GetCurrentDiscountTier(t);null===y&&(y=t.Tiers[0]);let _=discountNinja.DiscountTier.GetGoalDiscountTier(t);null===_&&(_=t.Tiers[0]);let L=0,P=0,T=0;if(_&&_.Prerequisite.MaximumAmount>0&&(T=_.Prerequisite.MaximumAmount),_&&_.Prerequisite.MinimumAmount>0){(L=(100*(P=_.Prerequisite.MinimumAmount)-discountNinja.Offer.PrerequisiteItemsCartValue(t))/100)<0&&(L=0)}let v=0,E=0,D=0;if(_&&_.Prerequisite.MaximumItems&&(D=_.Prerequisite.MaximumItems),_&&_.Prerequisite.BogoPrerequisiteQuantity){(v=(E=_.Prerequisite.BogoPrerequisiteQuantity)-discountNinja.Prerequisite.PrerequisiteItemsInCart(t,_))<0&&(v=0)}else if(_&&_.Prerequisite.MinimumItems){(v=(E=_.Prerequisite.MinimumItems)-discountNinja.Prerequisite.PrerequisiteItemsInCart(t,_))<0&&(v=0)}y.Entitlement.Percentage,y.Entitlement.Amount;let b=t.Tiers[t.Tiers.length-1].Entitlement,I=y.Entitlement?y.Entitlement.EntitledQuantity:null,k=discountNinja.Prerequisite.EntitledQuantity(t,y)||I;return discountNinja_Script_ShortCode.ContainsPlaceHolder(i,"MAXIMUM_ITEMS")&&(i=discountNinja_Script_ShortCode.BuildResolvedPlaceHolder(t,i,n,"{{MAXIMUM_ITEMS}}","offer","maximum_items",t.EntitledQuantity||"N/A")),discountNinja_Script_ShortCode.ContainsPlaceHolder(i,"ENTITLED_QUANTITY")&&(i=discountNinja_Script_ShortCode.BuildResolvedPlaceHolder(t,i,n,"{{ENTITLED_QUANTITY}}","offer","entitled_quantity",k||"N/A")),discountNinja_Script_ShortCode.ContainsPlaceHolder(i,"MINIMUM_CART_VALUE")&&(i=discountNinja_Script_ShortCode.BuildResolvedPlaceHolderAmount(t,i,n,"{{MINIMUM_CART_VALUE}}","offer","minimum_cart_value",100*P,r,a,c,s,u,!1,null,null,!1)),discountNinja_Script_ShortCode.ContainsPlaceHolder(i,"MAXIMUM_CART_VALUE")&&(i=discountNinja_Script_ShortCode.BuildResolvedPlaceHolderAmount(t,i,n,"{{MAXIMUM_CART_VALUE}}","offer","maximum_cart_value",100*T,r,a,c,s,u,!1,null,null,!1)),discountNinja_Script_ShortCode.ContainsPlaceHolder(i,"AMOUNT_LEFT_BEFORE_DISCOUNT")&&(i=discountNinja_Script_ShortCode.BuildResolvedPlaceHolderAmount(t,i,n,"{{AMOUNT_LEFT_BEFORE_DISCOUNT}}","offer","amount_left_before_discount",100*L,r,a,c,s,u,!1,null,null,!1)),discountNinja_Script_ShortCode.ContainsPlaceHolder(i,"MINIMUM_CART_PRODUCTS")&&(i=discountNinja_Script_ShortCode.BuildResolvedPlaceHolder(t,i,n,"{{MINIMUM_CART_PRODUCTS}}","offer","minimum_cart_products",E)),discountNinja_Script_ShortCode.ContainsPlaceHolder(i,"MAXIMUM_CART_PRODUCTS")&&(i=discountNinja_Script_ShortCode.BuildResolvedPlaceHolder(t,i,n,"{{MAXIMUM_CART_PRODUCTS}}","offer","maximum_cart_products",D)),discountNinja_Script_ShortCode.ContainsPlaceHolder(i,"PRODUCTS_LEFT_BEFORE_DISCOUNT")&&(i=discountNinja_Script_ShortCode.BuildResolvedPlaceHolder(t,i,n,"{{PRODUCTS_LEFT_BEFORE_DISCOUNT}}","offer","products_left_before_discount",v)),discountNinja_Script_ShortCode.ContainsPlaceHolder(i,"DISCOUNT_CODE")&&(i=discountNinja_Script_ShortCode.BuildResolvedPlaceHolder(t,i,n,"{{DISCOUNT_CODE}}","offer","discount_code",discountNinja.Offer.GetPromotionDiscountCode(t))),discountNinja_Script_ShortCode.ContainsPlaceHolder(i,"ENDS_AT_DATE")&&(i=discountNinja_Script_ShortCode.BuildResolvedPlaceHolder(t,i,n,"{{ENDS_AT_DATE}}","offer","ends_at_date",g)),discountNinja_Script_ShortCode.ContainsPlaceHolder(i,"ENDS_AT_TIME")&&(i=discountNinja_Script_ShortCode.BuildResolvedPlaceHolder(t,i,n,"{{ENDS_AT_TIME}}","offer","ends_at_time",p)),discountNinja_Script_ShortCode.ContainsPlaceHolder(i,"EXPIRES_AT_DATE")&&(i=discountNinja_Script_ShortCode.BuildResolvedPlaceHolder(t,i,n,"{{EXPIRES_AT_DATE}}","offer","expires_at_date",m)),discountNinja_Script_ShortCode.ContainsPlaceHolder(i,"EXPIRES_AT_TIME")&&(i=discountNinja_Script_ShortCode.BuildResolvedPlaceHolder(t,i,n,"{{EXPIRES_AT_TIME}}","offer","expires_at_time",N)),discountNinja_Script_ShortCode.ContainsPlaceHolder(i,"OFFER_LINK_HERE")&&(i=discountNinja_Script_ShortCode.BuildResolvedPlaceHolder(t,i,n,"{{OFFER_LINK_HERE}}","offer","offer_link_here","<a class='limoniapps-targetlink' href='"+t.Entitlement.EntitledItemLinks+"'>"+o+"</a>")),discountNinja_Script_ShortCode.ContainsPlaceHolder(i,"OFFER_LINK")&&(i=discountNinja_Script_ShortCode.BuildResolvedPlaceHolder(t,i,n,"{{OFFER_LINK}}","offer","offer_link",t.Entitlement.EntitledItemLinks)),discountNinja_Script_ShortCode.ContainsPlaceHolder(i,"PREREQUISITE_LINK")&&(i=discountNinja_Script_ShortCode.BuildResolvedPlaceHolder(t,i,n,"{{PREREQUISITE_LINK}}","offer","prerequisite_link",t.Prerequisite.PrerequisiteLinks)),discountNinja_Script_ShortCode.ContainsPlaceHolder(i,"PREREQUISITE_EXCLUSIONS_LINK")&&(i=discountNinja_Script_ShortCode.BuildResolvedPlaceHolder(t,i,n,"{{PREREQUISITE_EXCLUSIONS_LINK}}","offer","prerequisite_exclusions_link",t.Prerequisite.PrerequisiteExclusionLinks)),discountNinja_Script_ShortCode.ContainsPlaceHolder(i,"MINIMUM_PREREQUISITE_PRODUCTS")&&(i=discountNinja_Script_ShortCode.BuildResolvedPlaceHolder(t,i,n,"{{MINIMUM_PREREQUISITE_PRODUCTS}}","offer","minimum_prerequisite_products",_.Prerequisite.BogoPrerequisiteQuantity)),discountNinja_Script_ShortCode.ContainsPlaceHolder(i,"EXCLUSIONS_LINK")&&(i=discountNinja_Script_ShortCode.BuildResolvedPlaceHolder(t,i,n,"{{EXCLUSIONS_LINK}}","offer","exclusions_link",t.Entitlement.ExcludeCollectionLinks)),discountNinja_Script_ShortCode.ContainsPlaceHolder(i,"MAXIMUM_GIFTS")&&(i=discountNinja_Script_ShortCode.BuildResolvedPlaceHolder(t,i,n,"{{MAXIMUM_GIFTS}}","offer","target_link",t.Entitlement.AllocationLimit)),discountNinja_Script_ShortCode.ContainsPlaceHolder(i,"MAXIMUM_DISCOUNTED_ITEMS")&&(i=discountNinja_Script_ShortCode.BuildResolvedPlaceHolder(t,i,n,"{{MAXIMUM_DISCOUNTED_ITEMS}}","offer","target_link",t.Entitlement.AllocationLimit)),discountNinja_Script_ShortCode.ContainsPlaceHolder(i,"TOTAL_DISCOUNT_AMOUNT")&&(i=discountNinja_Script_ShortCode.BuildResolvedPlaceHolderAmount(t,i,n,"{{TOTAL_DISCOUNT_AMOUNT}}","offer","total_discount_amount",S,r,a,c,s,u,!1,null,null,!0)),discountNinja_Script_ShortCode.ContainsPlaceHolder(i,"TOTAL_DISCOUNT_PERCENTAGE")&&(i=discountNinja_Script_ShortCode.BuildResolvedPlaceHolder(t,i,n,"{{TOTAL_DISCOUNT_PERCENTAGE}}","offer","total_discount_percentage",discountNinja.Utilities.FormatPercentage(h,0)+"%")),discountNinja_Script_ShortCode.ContainsPlaceHolder(i,"TOTAL_DISCOUNT_CODES")&&(i=discountNinja_Script_ShortCode.BuildResolvedPlaceHolder(t,i,n,"{{TOTAL_DISCOUNT_CODES}}","offer","total_discount_codes",t.UsageLimit?t.UsageLimit.Total:null)),discountNinja_Script_ShortCode.ContainsPlaceHolder(i,"REMAINING_DISCOUNT_CODES")&&(i=discountNinja_Script_ShortCode.BuildResolvedPlaceHolder(t,i,n,"{{REMAINING_DISCOUNT_CODES}}","offer","remaining_discount_codes",t.UsageLimit?t.UsageLimit.Remaining:null)),discountNinja_Script_ShortCode.ContainsPlaceHolder(i,"USED_DISCOUNT_CODES")&&(i=discountNinja_Script_ShortCode.BuildResolvedPlaceHolder(t,i,n,"{{USED_DISCOUNT_CODES}}","offer","used_discount_codes",t.UsageLimit&&t.UsageLimit.Total&&t.UsageLimit.Remaining?t.UsageLimit.Total-t.UsageLimit.Remaining:null)),y&&(discountNinja_Script_ShortCode.ContainsPlaceHolder(i,"DISCOUNT_PERCENTAGE")&&(i=discountNinja_Script_ShortCode.BuildResolvedPlaceHolder(t,i,n,"{{DISCOUNT_PERCENTAGE}}","offer","discount_percentage",discountNinja.Utilities.FormatPercentage(y.Entitlement.Percentage,0)+"%")),discountNinja_Script_ShortCode.ContainsPlaceHolder(i,"DISCOUNT_AMOUNT")&&(i=discountNinja_Script_ShortCode.BuildResolvedPlaceHolderAmount(t,i,n,"{{DISCOUNT_AMOUNT}}","offer","discount_amount",100*y.Entitlement.Amount,r,a,c,s,u,!1,null,null,!0)),t&&"percentage"===t.Entitlement.ValueType&&discountNinja_Script_ShortCode.ContainsPlaceHolder(i,"DISCOUNT")&&(i=discountNinja_Script_ShortCode.BuildResolvedPlaceHolder(t,i,n,"{{DISCOUNT}}","offer","discount",discountNinja.Utilities.FormatPercentage(y.Entitlement.Percentage,0)+"%")),t&&"fixed_amount"===t.Entitlement.ValueType&&discountNinja_Script_ShortCode.ContainsPlaceHolder(i,"DISCOUNT")&&(i=discountNinja_Script_ShortCode.BuildResolvedPlaceHolderAmount(t,i,n,"{{DISCOUNT}}","offer","discount",100*y.Entitlement.Amount,r,a,c,s,u,!1,null,null,!0))),_&&(discountNinja_Script_ShortCode.ContainsPlaceHolder(i,"{{NEXT_GOAL_DISCOUNT_PERCENTAGE}}")&&(i=discountNinja_Script_ShortCode.BuildResolvedPlaceHolder(t,i,n,"{{NEXT_GOAL_DISCOUNT_PERCENTAGE}}","offer","next_goal_discount_percentage",discountNinja.Utilities.FormatPercentage(_.Entitlement.Percentage,0)+"%")),discountNinja_Script_ShortCode.ContainsPlaceHolder(i,"NEXT_GOAL_DISCOUNT_AMOUNT")&&(i=discountNinja_Script_ShortCode.BuildResolvedPlaceHolderAmount(t,i,n,"{{NEXT_GOAL_DISCOUNT_AMOUNT}}","offer","next_goal_discount_amount",100*_.Entitlement.Amount,r,a,c,s,u,!1,null,null,!0)),t&&"percentage"===t.Entitlement.ValueType&&discountNinja_Script_ShortCode.ContainsPlaceHolder(i,"NEXT_GOAL_DISCOUNT")&&(i=discountNinja_Script_ShortCode.BuildResolvedPlaceHolder(t,i,n,"{{NEXT_GOAL_DISCOUNT}}","offer","next_goal_discount",discountNinja.Utilities.FormatPercentage(_.Entitlement.Percentage,0)+"%")),t&&"fixed_amount"===t.Entitlement.ValueType&&discountNinja_Script_ShortCode.ContainsPlaceHolder(i,"NEXT_GOAL_DISCOUNT")&&(i=discountNinja_Script_ShortCode.BuildResolvedPlaceHolderAmount(t,i,n,"{{NEXT_GOAL_DISCOUNT}}","offer","next_goal_discount",100*_.Entitlement.Amount,r,a,c,s,u,!1,null,null,!0))),t&&"percentage"===t.Entitlement.ValueType&&discountNinja_Script_ShortCode.ContainsPlaceHolder(i,"MAXIMUM_DISCOUNT")&&(i=discountNinja_Script_ShortCode.BuildResolvedPlaceHolder(t,i,n,"{{MAXIMUM_DISCOUNT}}","offer","maximum_discount",discountNinja.Utilities.FormatPercentage(b.Percentage,0)+"%")),t&&"fixed_amount"===t.Entitlement.ValueType&&discountNinja_Script_ShortCode.ContainsPlaceHolder(i,"MAXIMUM_DISCOUNT")&&(i=discountNinja_Script_ShortCode.BuildResolvedPlaceHolderAmount(t,i,n,"{{MAXIMUM_DISCOUNT}}","offer","maximum_discount",100*b.Amount,r,a,c,s,u,!1,null,null,!0)),!0===e.Enabled&&(i=(i=(i=(i=(i=(i=i.replace(/{{TIMER}}/g,'<span class="limoniapps-discountninja-timer" data-style="1"></span>')).replace(/{{TIMER,STYLE1}}/g,'<span class="limoniapps-discountninja-timer" data-style="1""></span>')).replace(/{{TIMER,STYLE2}}/g,'<span class="limoniapps-discountninja-timer" data-style="2""></span>')).replace(/{{TIMER,STYLE3}}/g,'<span class="limoniapps-discountninja-timer" data-style="3""></span>')).replace(/{{TIMER,STYLE4}}/g,'<span class="limoniapps-discountninja-timer" data-style="4""></span>')).replace(/{{TIMER,STYLE5}}/g,'<span class="limoniapps-discountninja-timer" data-style="5""></span>')),i}catch(t){return discountNinja.Logging.LogError("ShortCode.ReplacePromotionLevelPlaceHolders",t),i}},ReplaceProductLevelPlaceHolders:function(t,i,n,e){function o(t,i,n,e){return' style="'+(t?"color: "+t+" !important;":"")+(i?"font-size: "+i+"px !important;":"")+(n?"font-weight: "+n+" !important;":"")+(e?e+";":"")+'" '}try{if(e||(e="standard"),void 0===t||""===t||null===t)return t;discountNinja.Logging.LogVerbose("Replacing product level placeholders");let r=discountNinja.Currency.GetCurrencyFormat(),a=discountNinja.Utilities.GetNoDecimalsCurrencyFormat(r),c=discountNinja.Utilities.GetCurrencyFormatAmountComponent(r),s=discountNinja.Utilities.GetCurrencyFormatAmountComponent(a),u=2,d=i.OriginalCompareAtPrice>i.OriginalPrice?i.Amount+i.OriginalCompareAtPrice-i.OriginalPrice:i.Amount,l=d/i.OriginalCompareAtPrice*100,g=function(t){return o(discountNinja.Settings.GetPriceFormat(t).DiscountedPriceColor,discountNinja.Settings.GetPriceFormat(t).DiscountedPriceFontSize,discountNinja.Settings.GetPriceFormat(t).DiscountedPriceFontWeight,discountNinja.Settings.GetPriceFormat(t).DiscountedPriceCustomCss)}(e),p=function(t){return o(discountNinja.Settings.GetPriceFormat(t).OriginalPriceColor,discountNinja.Settings.GetPriceFormat(t).OriginalPriceFontSize,discountNinja.Settings.GetPriceFormat(t).OriginalPriceFontWeight,discountNinja.Settings.GetPriceFormat(t).OriginalPriceCustomCss)}(e),f=discountNinja.Settings.GetPriceFormat(e).DiscountedPriceCssClasses,m=discountNinja.Settings.GetPriceFormat(e).OriginalPriceCssClasses;return i&&void 0!==i.CompareAtAmount&&discountNinja_Script_ShortCode.ContainsPlaceHolder(t,"AMOUNT_COMPAREAT")&&(t=discountNinja_Script_ShortCode.BuildResolvedPlaceHolderAmount(null,t,n,"{{AMOUNT_COMPAREAT}}","product","amount_compareat",100*i.CompareAtAmount,r,a,c,s,u,!1,null,null,!0)),i&&void 0!==i.DiscountedPrice&&discountNinja_Script_ShortCode.ContainsPlaceHolder(t,"DISCOUNTED_PRICE")&&(t=discountNinja_Script_ShortCode.BuildResolvedPlaceHolderAmount(null,t,n,"{{DISCOUNTED_PRICE}}","product","discounted_price",100*i.DiscountedPrice,r,a,c,s,u,!1,g,f,!0)),i&&void 0!==i.OriginalPrice&&discountNinja_Script_ShortCode.ContainsPlaceHolder(t,"ORIGINAL_PRICE")&&(t=discountNinja_Script_ShortCode.BuildResolvedPlaceHolderAmount(null,t,n,"{{ORIGINAL_PRICE}}","product","original_price",100*i.OriginalPrice,r,a,c,s,u,!1,p,m,!0)),i&&void 0!==i.OriginalCompareAtPrice&&discountNinja_Script_ShortCode.ContainsPlaceHolder(t,"ORIGINAL_COMPAREAT_PRICE")&&(t=discountNinja_Script_ShortCode.BuildResolvedPlaceHolderAmount(null,t,n,"{{ORIGINAL_COMPAREAT_PRICE}}","original_compareat_price","amount",100*i.OriginalCompareAtPrice,r,a,c,s,u,!1,p,m,!0)),i&&void 0!==i.DiscountedPrice&&discountNinja_Script_ShortCode.ContainsPlaceHolder(t,"DISCOUNTED_PRICE_AFTERPAY_INSTALLMENT")&&(t=discountNinja_Script_ShortCode.BuildResolvedPlaceHolderAmount(null,t,n,"{{DISCOUNTED_PRICE_AFTERPAY_INSTALLMENT}}","product","discounted_price_afterpay_installment",100*i.DiscountedPrice/4,r,a,c,s,u,!1,g,f,!0)),i&&void 0!==i.Amount&&discountNinja_Script_ShortCode.ContainsPlaceHolder(t,"DISCOUNT_AMOUNT")&&(t=discountNinja_Script_ShortCode.BuildResolvedPlaceHolderAmount(null,t,n,"{{DISCOUNT_AMOUNT}}","product","discount_amount",100*i.Amount,r,a,c,s,u,!1,null,null,!0)),i&&void 0!==i.Percentage&&discountNinja_Script_ShortCode.ContainsPlaceHolder(t,"DISCOUNT_PERCENTAGE")&&(t=discountNinja_Script_ShortCode.BuildResolvedPlaceHolder(null,t,n,"{{DISCOUNT_PERCENTAGE}}","product","discount_percentage",discountNinja.Utilities.FormatPercentage(i.Percentage,0)+"%")),i&&void 0!==i.Percentage&&i.Percentage>0&&discountNinja_Script_ShortCode.ContainsPlaceHolder(t,"DISCOUNT")&&(t=discountNinja_Script_ShortCode.BuildResolvedPlaceHolder(null,t,n,"{{DISCOUNT}}","product","discount",discountNinja.Utilities.FormatPercentage(i.Percentage,0)+"%")),i&&void 0!==i.Amount&&i.Amount>0&&discountNinja_Script_ShortCode.ContainsPlaceHolder(t,"DISCOUNT")&&(t=discountNinja_Script_ShortCode.BuildResolvedPlaceHolderAmount(null,t,n,"{{DISCOUNT}}","product","discount",100*i.Amount,r,a,c,s,u,!1,null,null,!0)),i&&void 0!==i.CompareAtAmount&&void 0!==i.Amount&&discountNinja_Script_ShortCode.ContainsPlaceHolder(t,"DISCOUNT_AMOUNT_COMPAREAT")&&(t=discountNinja_Script_ShortCode.BuildResolvedPlaceHolderAmount(null,t,n,"{{DISCOUNT_AMOUNT_COMPAREAT}}","product","discount_amount_compareat",d,r,a,c,s,u,!1,null,null,!0)),i&&void 0!==i.CompareAtAmount&&void 0!==i.Percentage&&discountNinja_Script_ShortCode.ContainsPlaceHolder(t,"DISCOUNT_PERCENTAGE_COMPAREAT")&&(t=discountNinja_Script_ShortCode.BuildResolvedPlaceHolder(null,t,n,"{{DISCOUNT_PERCENTAGE_COMPAREAT}}","product","discount_percentage_compareat",discountNinja.Utilities.FormatPercentage(l,0)+"%")),t}catch(t){discountNinja.Logging.LogError("ShortCode.ReplaceProductLevelPlaceHolders",t)}},ContainsPlaceHolder:function(t,i){try{return""!==t&&null!=t&&t.indexOf(i.replace("{{","").replace("}}",""))>-1}catch(t){return!1}},ReplaceAllPlaceHolders:function(t,i,n,e){return i=function(i,n){try{if(""===i||null==i)return i;discountNinja.Logging.LogVerbose("Replacing settings level placeholders");let e=discountNinja.Currency.GetCurrencyFormat(),o=discountNinja.Utilities.GetNoDecimalsCurrencyFormat(e),r=discountNinja.Utilities.GetCurrencyFormatAmountComponent(e),a=discountNinja.Utilities.GetCurrencyFormatAmountComponent(o),c=2,s=0;if(window.discountNinjaContext&&window.discountNinjaContext.Cart&&window.discountNinjaContext.Cart.total_price&&(s=window.discountNinjaContext.Cart.total_price),discountNinja_Script_ShortCode.ContainsPlaceHolder(i,"{{CURRENCY}}")&&(i=discountNinja_Script_ShortCode.BuildResolvedPlaceHolder(t,i,n,"{{CURRENCY}}","offer","currency",discountNinja.Settings.Settings.CurrencySettings.BaseCurrency)),discountNinja_Script_ShortCode.ContainsPlaceHolder(i,"{{CURRENCY_SYMBOL}}")&&(i=discountNinja_Script_ShortCode.BuildResolvedPlaceHolder(t,i,n,"{{CURRENCY_SYMBOL}}","offer","currency_symbol",discountNinja.Settings.Settings.CurrencySettings.BaseCurrencySymbol)),discountNinja_Script_ShortCode.ContainsPlaceHolder(i,"{{TOTAL_PRICE}}")&&(i=discountNinja_Script_ShortCode.BuildResolvedPlaceHolderAmount(t,i,n,"{{TOTAL_PRICE}}","offer","total_price",s,e,o,r,a,c,!1,null,null,!1)),i=(i=(i=(i=i.replace(/{{NEW_LINE}}/g,"<br>")).replace(/{{DISCOUNT_ICON}}/g,'<svg class="limoniapps-discountninja-icon-discount" aria-hidden="true" focusable="false"> <use xlink:href="#tags-filled">#shadow-root (closed)<svg id="tags-filled"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 18 18"><path d="M17.78 3.09C17.45 2.443 16.778 2 16 2h-5.165c-.535 0-1.046.214-1.422.593l-6.82 6.89c0 .002 0 .003-.002.003-.245.253-.413.554-.5.874L.738 8.055c-.56-.953-.24-2.178.712-2.737L9.823.425C10.284.155 10.834.08 11.35.22l4.99 1.337c.755.203 1.293.814 1.44 1.533z" fill-opacity=".55"></path><path d="M10.835 2H16c1.105 0 2 .895 2 2v5.172c0 .53-.21 1.04-.586 1.414l-6.818 6.818c-.777.778-2.036.782-2.82.01l-5.166-5.1c-.786-.775-.794-2.04-.02-2.828.002 0 .003 0 .003-.002l6.82-6.89C9.79 2.214 10.3 2 10.835 2zM13.5 8c.828 0 1.5-.672 1.5-1.5S14.328 5 13.5 5 12 5.672 12 6.5 12.672 8 13.5 8z"></path></svg></svg></use></svg>')).replace(/{{SHIPPING_ICON}}/g,'<i class="fa fa-truck" aria-hidden="true"></i>')).replace(/{{DISCOUNT_PERCENTAGE}}/g,'<svg class="limoniapps-discountninja-icon-coupon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><defs><style>.a{fill:none;stroke:#000;stroke-linecap:round;stroke-linejoin:round;stroke-width:1.5px;}</style></defs><title>icon-coupon</title><line class="a" x1="6.75" y1="17.25" x2="17.25" y2="6.75"></line><circle class="a" cx="8.25" cy="8.25" r="1.5"></circle><circle class="a" cx="15.75" cy="15.75" r="1.5"></circle><path class="a" d="M.75,3.75V2.25A1.5,1.5,0,0,1,2.25.75h1.5"></path><path class="a" d="M3.75,23.25H2.25a1.5,1.5,0,0,1-1.5-1.5v-1.5"></path><line class="a" x1="0.75" y1="7.5" x2="0.75" y2="10.5"></line><line class="a" x1="0.75" y1="13.5" x2="0.75" y2="16.5"></line><line class="a" x1="23.25" y1="7.5" x2="23.25" y2="10.5"></line><line class="a" x1="7.5" y1="0.75" x2="10.5" y2="0.75"></line><path class="a" d="M23.25,20.25v1.5a1.5,1.5,0,0,1-1.5,1.5h-1.5"></path><line class="a" x1="23.25" y1="16.5" x2="23.25" y2="13.5"></line><line class="a" x1="16.5" y1="23.25" x2="13.5" y2="23.25"></line><line class="a" x1="13.5" y1="0.75" x2="16.5" y2="0.75"></line><path class="a" d="M20.25.75h1.5a1.5,1.5,0,0,1,1.5,1.5v1.5"></path><line class="a" x1="10.5" y1="23.25" x2="7.5" y2="23.25"></line></svg>'),discountNinja_Script_ShortCode.ContainsPlaceHolder(i,"{{OFFER_COUNT}}")){let t=discountNinja.Notification.GetFromCache()||[];i=i.replace(/{{OFFER_COUNT}}/g,t.length)}return i}catch(t){return discountNinja.Logging.LogError("ShortCode.ReplaceSettingsLevelPlaceHolders",t),i}}(i,!0),n&&(i=discountNinja_Script_ShortCode.ReplaceProductLevelPlaceHolders(i,n,!0,e)),t&&(i=discountNinja_Script_ShortCode.ReplacePromotionLevelPlaceHolders(t,i,!0)),i}},discountNinja_Script_TabReminder={Set:function(){try{let t=discountNinja.Cache.SessionGet("toggletabtitle");null!==t&&"off"!==t||(discountNinja.Cache.SessionSet("toggletabtitle","on-state1"),function t(){try{if(!discountNinja.DynamicPricing.HasActiveDiscountCode())return;let i=discountNinja.Cache.SessionGet("tabtitle");null===i&&(i=document.title,discountNinja.Cache.SessionSet("tabtitle",i)),"visible"===document.visibilityState&&discountNinja.Cache.SessionSet("toggletabtitle","off"),"on-state1"===discountNinja.Cache.SessionGet("toggletabtitle")?(document.title="âœ‹ Promotion active! "+i,discountNinja.Cache.SessionSet("toggletabtitle","on-state2"),setTimeout(function(){t()},2500)):"on-state2"===discountNinja.Cache.SessionGet("toggletabtitle")?(document.title="â˜ž Don't forget! "+i,discountNinja.Cache.SessionSet("toggletabtitle","on-state3"),setTimeout(function(){t()},2500)):"on-state3"===discountNinja.Cache.SessionGet("toggletabtitle")?(document.title="â˜Ÿ Collect discount! "+i,discountNinja.Cache.SessionSet("toggletabtitle","on-state4"),setTimeout(function(){t()},2500)):"on-state4"===discountNinja.Cache.SessionGet("toggletabtitle")&&(document.title=i,discountNinja.Cache.SessionSet("toggletabtitle","on-state1"),setTimeout(function(){t()},5e3))}catch(t){discountNinja.Logging.LogError("TabReminder.ToggleTabReminder",t)}}())}catch(t){discountNinja.Logging.LogError("TabReminder.Set",t)}},Remove:function(){try{discountNinja.Cache.SessionSet("toggletabtitle","off");let t=discountNinja.Cache.SessionGet("tabtitle");null!==t&&(document.title=t)}catch(t){discountNinja.Logging.LogError("TabReminder.Remove",t)}}},discountNinja_Script_TestMode={TestModeDynamicStylesAdded:!1,TestMode:!1,MatchByTokenOnly:!1,TestModeToken:null,TestModeOutput:[],TestModeOutputIssue:!1,ShowTestModeOutput:function(){try{if(!1===discountNinja_Script_TestMode.TestMode)return;let t=function(t,i){let n="";if(null===t||!1===i)n+="<br/><span style='color:green;'><i class='fa fa-thumbs-o-up' aria-hidden='true'></i> No issues found</span>";else{n="<br/><strong>Remarks:</strong><br>";for(let i=0;i<t.length;i++)n+=t[i]}return n+="<br/><span style='font-size:14px;'><strong>Note</strong> This message is not visible for your visitors. Learn more <a style='color: blue; text-decoration: underline;' href='http://support.limoniapps.com/discount-url-support-center/test-mode-output' target='_blank'>here</a>.</span>"}(discountNinja_Script_TestMode.TestModeOutput,discountNinja_Script_TestMode.TestModeOutputIssue);discountNinja_Script_TestMode.TestModeOutput=[],function(t){try{LimoniAppsLoadJQueryNotify(function(){jQuery(".alert-limoniapps-notification-testmodeoutput").remove();let i=jQuery.notify({icon:"fa fa-info-circle",title:"Discount Ninja<br>Test mode output",message:t},{type:"limoniapps-notification-testmodeoutput",placement:{from:"top",align:"left"},delay:0,animate:{enter:"animate fadeInBottom",exit:"animate fadeOutBottom"}});void 0!==jQuery(i)[0].$ele||discountNinja.Logging.LogVerbose("Cannot show test output, Bootstrap Notify may not be registered correctly")})}catch(t){discountNinja.Logging.LogError("TestMode.ShowTestModeNotificationMessage",t)}}(t)}catch(t){discountNinja.Logging.LogError("TestMode.ShowTestModeOutput",t)}},HandleQueryParameter:function(){discountNinja.QueryParameter.Get("discountninjatestmode")?(discountNinja_Script_TestMode.TestMode=!0,discountNinja.Cache.Clear(),discountNinja.Cache.SessionSet("discountninjatestmode",!0),discountNinja.QueryParameter.Remove("discountninjatestmode")):discountNinja.Cache.SessionGet("discountninjatestmode")?discountNinja_Script_TestMode.TestMode=!0:discountNinja_Script_TestMode.TestMode=!1,discountNinja.QueryParameter.Get("discountninjatokenonly")?(discountNinja_Script_TestMode.MatchByTokenOnly=!0,discountNinja.Cache.SessionSet("discountninjatokenonly",!0),discountNinja.QueryParameter.Remove("discountninjatokenonly")):discountNinja.Cache.SessionGet("discountninjatokenonly")?discountNinja_Script_TestMode.MatchByTokenOnly=!0:discountNinja_Script_TestMode.MatchByTokenOnly=!1;let t=discountNinja.QueryParameter.Get("discountninjatestmodetoken"),i=discountNinja.Cache.SessionGet("discountninjatestmodetoken");t?(discountNinja_Script_TestMode.TestModeToken=t,discountNinja.Cache.SessionSet("discountninjatestmodetoken",t),discountNinja.QueryParameter.Remove("discountninjatestmodetoken")):discountNinja_Script_TestMode.TestModeToken=i||!1}},discountNinja_Script_Token={GetTokenFromQueryParameter:function(t){try{let t=discountNinja.QueryParameter.Get("token");return t?t.toUpperCase():""}catch(t){return discountNinja.Logging.LogError("Token.GetTokenFromQueryParameter",t),""}},GetTokenFromPromotionOrQueryParameter:function(t){try{let i=null;return(t=t||discountNinja.Offer.PrimaryOffer)&&(i=t?t.Token:null),null===i&&(i=discountNinja_Script_Token.GetTokenFromQueryParameter()),i?i.toUpperCase():""}catch(t){return discountNinja.Logging.LogError("Token.GetTokenFromPromotionOrQueryParameter ",t,!1),""}},GetCartToken:function(t){try{let i=discountNinja_Script_Token.GetTokenFromPromotionOrQueryParameter(t);return null!==i&&""!==i||(i=discountNinja_Script_Token.GetCartTokenFromLocalStorage()),i?i.toUpperCase():""}catch(t){return discountNinja.Logging.LogError("Token.GetCartToken ",t,!1),""}},GetNonAutomaticToken:function(t){try{let i=discountNinja_Script_Token.GetTokenFromPromotionOrQueryParameter(t);return null!==i&&""!==i||(i=discountNinja_Script_Token.GetNonAutomaticTokenFromSession()),i?i.toUpperCase():""}catch(t){return discountNinja.Logging.LogError("Token.GetNonAutomaticToken ",t,!1),""}},GetToken:function(t){try{let i=discountNinja_Script_Token.GetTokenFromPromotionOrQueryParameter(t);return null!==i&&""!==i||(i=discountNinja_Script_Token.GetTokenFromLocalStorage()),i?i.toUpperCase():""}catch(t){return discountNinja.Logging.LogError("Token.GetToken ",t,!1),""}},GetTokenFromLocalStorage:function(){return discountNinja.Cache.LocalGet("token-device")},SetTokenInLocalStorage:function(t){discountNinja.Cache.LocalSet("token-device",t)},RemoveCartTokenFromLocalStorage:function(){discountNinja.Cache.LocalRemove("token-cart-device")},GetCartTokenFromLocalStorage:function(){return discountNinja.Cache.LocalGet("token-cart-device")},SetCartTokenInLocalStorage:function(t){discountNinja.Cache.LocalSet("token-cart-device",t)},GetNonAutomaticTokenFromSession:function(){return discountNinja.Cache.SessionGet("token-non-automatic-session")},SetNonAutomaticTokenInSession:function(t){discountNinja.Cache.SessionSet("token-non-automatic-session",t)}},discountNinja_Script_Trigger={Clear:function(){try{let t=discountNinja.Offer.Triggers;if(!t)return;for(let i=0;i<t.length;i++)t[i].Triggered=!1}catch(t){discountNinja.Logging.LogError("Trigger.Clear",t)}},TriggerOffers:function(t){let i=!0;for(let n=0;n<t.length;n++){let e=discountNinja.Offer.GetOfferByToken(t[n]);e&&(discountNinja.PromotionFlow.ViewPromotion(e),(e.AutoAccept||discountNinja.Offer.IsOfferAccepted(e.Token,e.Frequency))&&discountNinja.PromotionFlow.AcceptPromotion(e),discountNinja.Timer.ShouldNotStart(e)&&(i=!1))}i||discountNinja.Timer.Stop(),function(){if(discountNinja.Offer.SetPrimaryOffer(),null===discountNinja.Offer.PrimaryOffer)return discountNinja.Logging.LogInformation("No valid applicable offer",!1),discountNinja.PromotionFlow.StopFlow();discountNinja.PromotionFlow.HideAdditionalCheckoutButtons()}(),discountNinja_Script_PromotionFlow.StopFlow()},IntializeTimeOnPageCounter:function(){try{discountNinja.Cache.SessionSet("trigger-time-on-page",0),null!==discountNinja_Script_Trigger.TimeOnPageCounterIntervalId&&0!==discountNinja_Script_Trigger.TimeOnPageCounterIntervalId&&clearInterval(discountNinja_Script_Trigger.TimeOnPageCounterIntervalId),discountNinja_Script_Trigger.TimeOnPageCounterIntervalId=window.setInterval(function(){let t=discountNinja.Cache.SessionGet("trigger-time-on-page");t=!t||isNaN(t)?0:parseInt(t),discountNinja.Cache.SessionSet("trigger-time-on-page",t+1)},1e3)}catch(t){discountNinja.Logging.LogError("Trigger.IntializeTimeOnPageCounter",t)}},TrackExitIntent:function(){try{discountNinja.Cache.SessionSet("trigger-exit-intent","false");let t=discountNinja.Settings.Settings.GeneralSettings.ExitIntentMode;t||(t="default");ouibounce(!1,{aggressive:!0,timer:"aggressive"===t?0:1e3,delay:"aggressive"===t?150:0,sensitivity:"aggressive"===t?80:20,callback:function(){discountNinja.Logging.LogVerbose("Exit intent detected"),discountNinja.Cache.SessionSet("trigger-exit-intent","true")}})}catch(t){discountNinja.Logging.LogError("Trigger.TrackExitIntent",t)}},TrackScrollPercentage:function(){function t(){try{let t=discountNinja.Cache.SessionGet("trigger-scroll-percentage");if(100===t)return;let i=jQuery(window).height(),n=jQuery(document).height(),e=jQuery(window).scrollTop(),o=n-i,r=Math.floor(e/o*100);r>t&&discountNinja.Cache.SessionSet("trigger-scroll-percentage",r)}catch(t){return 0}}try{discountNinja.Cache.SessionSet("trigger-scroll-percentage",0),jQuery(window).on("scroll",function(){t()}),t()}catch(t){discountNinja.Logging.LogError("Trigger.TrackScrollPercentage",t)}},MarkPageAsVisited:function(){try{let t=discountNinja.Cache.SessionGet("trigger-pages-visited-list");t=null===t?[]:t.split(","),-1===jQuery.inArray(window.location.pathname,t)&&t.push(window.location.pathname);let i=t.length;discountNinja.Cache.SessionSet("trigger-pages-visited",i),discountNinja.Logging.LogVerbose("Pages visited: "+i)}catch(t){discountNinja.Logging.LogError("Trigger.MarkPageAsVisited",t)}},ValidForPage:function(t){try{if(!t.PopUpSettings||!t.PopUpSettings.Enabled)return!0;let i=discountNinja.PromotionFlow.IsBuildingBlockEnabledForPage(discountNinja.Settings.Settings.PopUpSettings,"","Pop-up");if(!discountNinja.PromotionFlow.HandleFlowErrorMessage(i))return!1;let n=discountNinja.Settings.Settings.PopUpSettings.ShowOn;return discountNinja.Environment.Shopify.IsCustomPage()&&t.PopUpSettings.Enabled?!!n.ShowOnCustomPages&&(!("custom"===t.TriggerSettings.CustomPagesIncluded&&!discountNinja.Utilities.StringIsIn(t.TriggerSettings.CustomPageContains,discountNinja.Environment.Shopify.CustomPageHandle()))||(discountNinja.Logging.LogTestMode("Offer will not be displayed because the current custom page is not in the set of pages to include",null,!0,!0,!1),!1)):discountNinja.Environment.Shopify.IsBlogPost()&&t.PopUpSettings.Enabled?!!n.ShowOnBlogPosts&&("blogequals"!==t.TriggerSettings.BlogPostsIncluded||discountNinja.Utilities.StringIsIn(t.TriggerSettings.BlogEquals,discountNinja.Environment.Shopify.BlogHandle())?("postcontains"!==t.TriggerSettings.BlogPostsIncluded||discountNinja.Utilities.StringIsIn(t.TriggerSettings.BlogPostHandleContains,discountNinja.Environment.Shopify.BlogPostHandle()))&&!("blogandpostcontains"===t.TriggerSettings.BlogPostsIncluded&&!discountNinja.Utilities.StringIsIn(t.TriggerSettings.BlogPostHandleContains,discountNinja.Environment.Shopify.BlogPostHandle())&&!discountNinja.Utilities.StringIsIn(t.TriggerSettings.BlogEquals,discountNinja.Environment.Shopify.BlogHandle()))||(discountNinja.Logging.LogTestMode("Offer will not be displayed because the current blog post is not in the set of blog posts to include",null,!0,!0,!1),!1):(discountNinja.Logging.LogTestMode("Offer will not be displayed because the current blog is not in the set of blogs to include",null,!0,!0,!1),!1)):!discountNinja.Environment.Shopify.IsCollectionPage()||!t.PopUpSettings.Enabled||!!n.ShowOnCollectionPages&&("overrideinclude"!==t.TriggerSettings.TargetCollectionHandleMode||discountNinja.Utilities.StringIsIn(t.TriggerSettings.OverrideCollectionHandles,discountNinja.Environment.Shopify.CollectionHandle())?"overrideexclude"!==t.TriggerSettings.TargetCollectionHandleMode||!discountNinja.Utilities.StringIsIn(t.TriggerSettings.OverrideCollectionHandles,discountNinja.Environment.Shopify.CollectionHandle())||(discountNinja.Logging.LogTestMode("Offer will not be displayed because the current collection page is in the set of overriden collections to exclude",null,!0,!0,!1),!1):(discountNinja.Logging.LogTestMode("Offer will not be displayed because the current collection page is not in the set of overriden collections to include",null,!0,!0,!1),!1))}catch(t){discountNinja.Logging.LogError("Trigger.PromotionTriggersOnPage",t)}},FilterConditionsAreMet:function(t){let i=t.FilterSettings;return function(t){"guests"===t.CustomerType||t.CustomerType;let i="signedin"===t.CustomerType||"all"===t.CustomerType;if("none"===t.CustomerType&&(discountNinja.Logging.LogTestMode("Trigger will not be activated outside of test mode. Please enable your trigger for guests and/or signed in visitors. Learn more <a style='color: blue; text-decoration: underline;' href='http://support.limoniapps.com/discount-url-support-center/restricting-offers-to-customers-or-prospects' target='_blank'>here</a>.",null,!0,!0,!1),!1===discountNinja.TestMode.TestMode))return!1;if(t.CustomerType&&"signedin"===t.CustomerType&&!discountNinja.Environment.Shopify.IsCustomer()){if(discountNinja.Logging.LogTestMode("Trigger would normally not be activated because it is restricted to signed in visitors only and you are a guest, it is only shown because you are in test mode. Learn more <a style='color: blue; text-decoration: underline;' href='http://support.limoniapps.com/discount-url-support-center/restricting-offers-to-customers-or-prospects' target='_blank'>here</a>.",null,!0,!0,!1),!1===discountNinja.TestMode.TestMode)return!1}else if("guests"===t.CustomerType&&discountNinja.Environment.Shopify.IsCustomer()&&(discountNinja.Logging.LogTestMode("Trigger would normally not be activated because it is restricted to guests only and you are signed in to an account, it is only shown because you are in test mode. Learn more <a style='color: blue; text-decoration: underline;' href='http://support.limoniapps.com/discount-url-support-center/restricting-offers-to-customers-or-prospects' target='_blank'>here</a>.",null,!0,!0,!1),!1===discountNinja.TestMode.TestMode))return!1;if(i&&"all"!==t.CustomerTagType){let i=discountNinja.Environment.Shopify.CustomerTags(),n=!1;if(i&&t.CustomerTags){let e=t.CustomerTags.split(",");for(let t=0;t<i.length;t++)for(let o=0;o<e.length;o++)i[t].toLowerCase().trim()===e[o].toLowerCase().trim()&&(n=!0)}if("include"===t.CustomerTagType&&!1===n&&(discountNinja.Logging.LogTestMode("Trigger would normally not be activated because the signed in visitor is not tagged with one of the following tags: "+t.CustomerTags+", it is only shown because you are in test mode. Learn more <a style='color: blue; text-decoration: underline;' href='http://support.limoniapps.com/discount-url-support-center/restricting-offers-to-customers-or-prospects' target='_blank'>here</a>.",null,!0,!0,!1),!1===discountNinja.TestMode.TestMode))return!1;if("exclude"===t.CustomerTagType&&!0===n&&(discountNinja.Logging.LogTestMode("Trigger would normally not be activated because the signed in visitor is tagged with one of the following tags: "+t.CustomerTags+", it is only shown because you are in test mode. Learn more <a style='color: blue; text-decoration: underline;' href='http://support.limoniapps.com/discount-url-support-center/restricting-offers-to-customers-or-prospects' target='_blank'>here</a>.",null,!0,!0,!1),!1===discountNinja.TestMode.TestMode))return!1}return!0}(i)&&!0},VisitorBehaviorConditionsAreMet:function(t){try{if("true"===discountNinja.Cache.SessionGet("trigger-conditions-met-"+t.Token))return!0;if(discountNinja.PromotionFlow.HasPopUpBeenShownForLevel(t))return!0;let i=t.TriggerSettings;if(!i||"none"===i.Type)return!0;let n=null!==i.ScrollPercentage&&void 0!==i.ScrollPercentage&&!1!==i.ScrollPercentage,e=null!==i.PagesVisited&&void 0!==i.PagesVisited&&!1!==i.PagesVisited,o=null!==i.OnExitIntent&&void 0!==i.OnExitIntent&&!1!==i.OnExitIntent,r=null!==i.TimeOnPageInSeconds&&void 0!==i.TimeOnPageInSeconds&&!1!==i.TimeOnPageInSeconds;if(!(n||e||o||r))return!0;let a=!0,c=!0,s=!0,u=!0;r&&!function(t){let i=t.TriggerSettings.TimeOnPageInSeconds,n=discountNinja.Cache.SessionGet("trigger-time-on-page");if(n&&!isNaN(n))return n>=i}(t)&&(a=!1),n&&!function(t){let i=t.TriggerSettings.ScrollPercentage,n=discountNinja.Cache.SessionGet("trigger-scroll-percentage");if(n&&!isNaN(n))return n>=i}(t)&&(c=!1),e&&!function(t){let i=t.TriggerSettings.PagesVisited,n=discountNinja.Cache.SessionGet("trigger-pages-visited");if(n&&!isNaN(n))return n>=i}(t)&&(s=!1),o&&!discountNinja.Utilities.IsMobilePhone()&&"true"!==discountNinja.Cache.SessionGet("trigger-exit-intent")&&(u=!1);let d="or"===i.Type?a||c||s||u:a&&c&&s&&u;return discountNinja.Cache.SessionSet("trigger-conditions-met-"+t.Token,d),d}catch(t){discountNinja.Logging.LogError("Trigger.PromotionTriggerConditionsMet",t)}},IsTriggerCanceled:function(t,i){return"onceperdevice"===i?"false"===discountNinja.Cache.LocalGet("trigger-accepted-"+t):"false"===discountNinja.Cache.SessionGet("trigger-accepted-"+t)},WaitForTriggerConditions:function(t){function i(t,i){for(let n=0;n<i.length;n++)if(i[n]===t)return!0;return!1}function n(t,e){if(!discountNinja_Script_Trigger.IsTriggerCanceled(t.Token,"oncepersession")&&discountNinja_Script_Trigger.FilterConditionsAreMet(t)&&discountNinja_Script_Trigger.ValidForPage(t)){discountNinja.Logging.LogVerbose("FLOW: Trigger "+t.Token+" is applicable on this page, checking visitor behavior conditions");for(let i=0;i<t.Offers.length;i++)e.push(t.Offers[i]);discountNinja_Script_Trigger.VisitorBehaviorConditionsAreMet(t)?(discountNinja.Logging.LogInformation("FLOW: Trigger "+t.Token+" conditions met, displaying associated offers"),t.Triggered=!0,discountNinja_Script_Trigger.TriggerOffers(t.Offers)):(discountNinja.Logging.LogVerbose("FLOW: Trigger "+t.Token+" visitor behavior conditions not met, checking again in 500ms"),waitForTriggerConditionsTimeoutHandle=setTimeout(function(){n(t,e)},500))}else{discountNinja.Logging.LogVerbose("FLOW: Trigger "+t.Token+" is NOT applicable on this page, not applying offers");for(let n=0;n<t.Offers.length;n++){let o=discountNinja.Offer.GetOfferByToken(t.Offers[n]);o&&!i(o.Token,e)&&discountNinja.PromotionFlow.UnAcceptPromotion(o)}}}if(discountNinja.Logging.LogInformation("FLOW: Waiting for trigger conditions to be met"),!t||0===t.length)return discountNinja.PromotionFlow.StopFlow();let e=[];for(let i=0;i<t.length;i++){let o=t[i];!0!==o.Triggered&&n(o,e)}}},discountNinja_Script_Cart_Shopify={IsDirty:!0,AddToCartButtonId:"LimoniAppsDiscountNinjaAddToCartButton",RegisteringAddToCart:!1,SubscribeDrawerCartOpened:function(){discountNinja.Events.Subscribe("DrawerCartOpened",discountNinja_Script_Cart_Shopify.OnDrawerCartOpened),jQuery(document).on("afterCartLoad.ajaxCart",discountNinja_Script_Cart_Shopify.OnDrawerCartOpened)},OnDrawerCartOpened:function(){discountNinja.Logging.LogVerbose("Received OnDrawerCartOpened event"),discountNinja.DynamicPricing.DrawerCartIsDirty=!0,discountNinja.DynamicPricing.UpdatePrice(!1,!0),discountNinja.DiscountCode.EnableDiscountCodeField(),discountNinja.DiscountCode.UpdateTags(),discountNinja.DiscountCode.LockDiscountCodeFieldIfRequired()},UpdateCart:function(t){function i(t,i,e){discountNinja.Logging.LogInformation("EVENT HANDLED - Local cart updated");let o=function(t){let i=discountNinja.LiquidData.Cart();if(!i||!t)return!0;if(i.total_price!==t.total_price)return!0;if(i.items.length!==t.items.length)return!0;for(let n=0;n<t.items.length;n++)if(i.items[n].key!==t.items[n].key)return!0;return!1}(i);o?(discountNinja.Logging.LogVerbose("Local cart updated"),discountNinja.DiscountedCart.IsDirty=!0,"object"==typeof window.discountNinjaContext?window.discountNinjaContext.Cart=i:discountNinja.Logging.LogErrorMessage("Cart","Liquid cart object not available")):discountNinja.Logging.LogVerbose("Local cart not updated"),n(i,o,e)}function n(t,i,n){return discountNinja.LocalCartUpdatedEvent.Handle(null,t,i,null!==n),null!=n&&"function"==typeof n?n():null}try{if(discountNinja_Script_Cart_Shopify.IsDirty){discountNinja.Logging.LogVerbose("Updating cart");let n=discountNinja.DeviceId.Get();discountNinja.XmlHttpRequest.Send("/cart.json?m="+n+"-"+moment().format("x"),null,null,"get",!0,!0,function(n){discountNinja_Script_Cart_Shopify.IsDirty=!1,i(0,n,t)})}else discountNinja.Logging.LogVerbose("Not updating cart - not assumed dirty"),n(discountNinja.LiquidData.Cart(),!1,t)}catch(t){discountNinja.Logging.LogError("Cart.Shopify.UpdateCart",t)}},AddToCart:function(t,i,n,e){try{if(i<=0)return void discountNinja.Logging.LogVerbose("Not adding variant "+t+" to cart, quantity requested is zero.");discountNinja.XmlHttpRequest.Send("/cart/add.js",null,{quantity:i,id:t,properties:n},"post",!0,!0,function(){discountNinja.Logging.LogVerbose("Variant "+t+" successfully added to the cart"),e&&e()})}catch(t){discountNinja.Logging.LogError("Cart.Shopify.AddToCart",t)}},ChangeQuantityInCart:function(t,i,n,e,o){try{let r=null;if(n){let i=discountNinja.LiquidData.CartItemByVariantAndProperty(t,n,e);i&&(r=i.key)}r||(r=discountNinja.LiquidData.CartItemByVariant(t).key),discountNinja.XmlHttpRequest.Send("/cart/change.js",null,{quantity:i,id:r},"post",!0,!0,function(){discountNinja.Logging.LogVerbose("Variant "+t+" quantity changed in cart"),o&&o()})}catch(t){discountNinja.Logging.LogError("Cart.Shopify.ChangeQuantityInCart",t)}},AddPropertiesToCartItem:function(t,i,n,e){try{let o=discountNinja.LiquidData.CartItemByKey(t).properties;o||(o={}),o[i]=n,discountNinja.XmlHttpRequest.Send("/cart/change.js",null,{properties:o,id:t},"post",!0,!0,function(){discountNinja.Logging.LogVerbose("Properties changed in cart for item with key "+t),e&&e()})}catch(t){discountNinja.Logging.LogError("Cart.Shopify.ChangePropertiesInCart",t)}},OnAddToCart:function(t,i){try{discountNinja.Logging.LogVerbose("Handling add to cart");let n=discountNinja.Environment.Shopify.IsProductPage()?discountNinja.Environment.Shopify.ProductHandle():discountNinja.LiquidData.ProductHandleFromCart(i);if(null===n&&null!=t){let i=jQuery(t.target).closest("[data-limoniapps-discountninja-product-handle]").attr("data-limoniapps-discountninja-product-handle")||jQuery(t.target).find("[data-limoniapps-discountninja-product-handle]").attr("data-limoniapps-discountninja-product-handle");if(void 0===i){let i=jQuery(t.target).find('input[name="variantid"]').val()||jQuery(t.target).closest(".remodal-wrapper [data-id]").attr("data-id")||jQuery(t.target).find('input[name="id"]').val()||jQuery(t.target).find("button[data-variant-id]").attr("data-variant-id")||jQuery(t.target).find("button[data-variantid]").attr("data-variantid")||jQuery(t.target).find("button[data-id]").attr("data-id")||jQuery(t.target).find("a[data-variant-id]").attr("data-variant-id")||jQuery(t.target).find("a[data-variantid]").attr("data-variantid")||jQuery(t.target).find("a[data-id]").attr("data-id");void 0!==i&&(discountNinja.Logging.LogVerbose("OnAddToCart found variant: "+i+" in the form"),n=discountNinja.LiquidData.ProductHandleFromCart(i))}else discountNinja.Logging.LogVerbose("OnAddToCart found product handle from data attribute: "+i),n=i}null===n?discountNinja.Logging.LogVerbose("OnAddToCart could not find a product handle"):discountNinja.Logging.LogVerbose("OnAddToCart found product handle "+n);let e=null;return null!==n&&(e=discountNinja.Offer.GetOfferForProduct(n,null,null,null,null,null,!1,!1),discountNinja.ProductData.SaveOnAddToCart(n)),e?(discountNinja.PromotionEvent.AddToQueue(e,2),discountNinja.Offer.SetTokenForProductInCache(n,e.Token),discountNinja.Logging.LogVerbose("OnAddToCart tracked product with handle "+n+" is in offer with token "+e.Token)):discountNinja.Logging.LogVerbose("OnAddToCart could not find a offer for product with handle "+n),!0}catch(t){return discountNinja.Logging.LogError("Cart.Shopify.OnAddToCart",t),!0}},OnUpdateCart:function(){try{discountNinja.DiscountedCart.BuildDiscountedCart(function(){discountNinja.Logging.LogVerbose("Restart flow to handle update to cart"),discountNinja.PromotionFlow.StartFlow(),setTimeout(function(){discountNinja.Logging.LogVerbose("Replacing prices in cart and drawer cart after update cart");let t=discountNinja.Settings.Settings;discountNinja_Script_DynamicPricing.ReplacePricesInDrawerCart(t)},1e3)})}catch(t){discountNinja.Logging.LogError("Cart.Shopify.OnUpdateCart",t)}},RegisterEventHandlerForAddToCart:function(){function t(t,i){try{i&&function(t){try{void 0!==t&&t&&(t.preventDefault&&t.preventDefault(),t.stopPropagation&&t.stopPropagation(),t.returnValue=!1)}catch(t){discountNinja.Logging.LogError("Checkout.Shopify.RegisterEventHandlerForCheckout.cancelDefaultBehaviorCheckoutButton",t)}}(t),discountNinja.Cart.Shopify.OnAddToCart(),i&&jQuery("#"+discountNinja_Script_Cart_Shopify.AddToCartButtonId).click()}catch(t){discountNinja.Logging.LogError("Cart.Shopify.RegisterAddToCartHook.onAddToCart",t)}}try{discountNinja.Logging.LogVerbose("Registering event handler for cart/add");let i=jQuery('form[action^="/cart/add"]').not(".limoniapps-discountninja-ignore"),n=discountNinja.Settings.GetFlag("EnableAddToCartHook");if(n?i.each(function(){let t=$('<input id="'+discountNinja_Script_Cart_Shopify.AddToCartButtonId+'" type="submit" name="add" style="display:none" class="limoniapps-discountninja-ignore">');jQuery(this).append(t)}):i.on("submit.discountNinja.cart",function(i){t(i,!1)}),n){let n=i.find(':submit[name="add"], :submit[value="add"], :submit[value="Add"], :submit[value="ADD"]').not(".limoniapps-discountninja-ignore");n.off(".discountNinja.cart"),n.each(function(){jQuery(this).on("click.discountNinja.cart",function(i){t(i,!0)})})}}catch(t){discountNinja.Logging.LogError("Cart.Shopify.RegisterEventHandlerForAddToCart",t)}}},discountNinja_Script_TemplateParameterEngine={Replace:function(t,i,n){if(!t||!i)return t;let e=new RegExp("\\[\\["+i+"\\]\\]","g");return t.replace(e,n||"")}},discountNinja_Script_ActionButton={HideIfNecessary:function(t,i,n){try{let e=!1;"applydiscount"===t.Action&&discountNinja.Offer.IsOfferAccepted(i.Token,i.Frequency)&&(e=!0);let o="hasaction"+n,r=discountNinja.StickyBar.GetWrapperElement().find(".limoniapps-sticky-bar");e?r.removeClass(o):r.addClass(o)}catch(t){return discountNinja.Logging.LogError("ActionButton.HandleAction",t),""}},HandleAction:function(t,i,n){try{if("redirect"===t.Action){let i=t.OpenInNewTab?"_blank":"_self";window.open(t.RedirectUrl,i)}else"applydiscount"===t.Action&&(discountNinja.PromotionFlow.AcceptPromotion(i,n),discountNinja.PromotionFlow.DisplayAppliedOffers())}catch(t){return discountNinja.Logging.LogError("ActionButton.HandleAction",t),""}},ReplacePlaceHoldersForButton:function(t,i,n,e,o){try{if(!o)return t;let r=discountNinja.ShortCode.ReplaceAllPlaceHolders(i,discountNinja.TextSettings.GetText(o.Text,i),n),a=discountNinja.TextSettings.WrapInColor(o.TextColor,r),c="ACTIONBUTTON"+e;return t=discountNinja.TemplateParameter.Replace(t,c+"_STYLE",o.Style?o.Style:""),t=discountNinja.TemplateParameter.Replace(t,c+"_SIZE",o.Size?o.Size:""),t=discountNinja.TemplateParameter.Replace(t,c+"_LABEL",a),t=discountNinja.TemplateParameter.Replace(t,c+"_ACTION",o.Action?o.Action:"")}catch(i){return discountNinja.Logging.LogError("ActionButton.ReplacePlaceHoldersForButton",i),t}}},discountNinja_Script_Prerequisite={PrerequisiteItemsInCart:function(t,i){return function(){if(i.Prerequisite.MinimumItems){if("*"===t.Prerequisite.PrerequisiteCollections)return discountNinja.LiquidData.QuantityInCartExcludingGifts(t.Prerequisite.PrerequisiteExcludeCollections);if(t.Prerequisite.PrerequisiteCollections)return discountNinja.LiquidData.QuantityInCartFromCollections(t.Prerequisite.PrerequisiteCollections,t.Prerequisite.PrerequisiteExcludeCollections);if(t.Prerequisite.PrerequisiteProducts)return discountNinja.LiquidData.QuantityInCartFromProducts(t.Prerequisite.PrerequisiteProducts,t.Prerequisite.PrerequisiteExcludeCollections)}return null}()||function(){if(i.Prerequisite.MinimumAmount){let n=0;return"*"===t.Prerequisite.PrerequisiteCollections?n=discountNinja.LiquidData.ValueInCartExcludingGifts(t.Prerequisite.PrerequisiteExcludeCollections):t.Prerequisite.PrerequisiteCollections?n=discountNinja.LiquidData.ValueInCartFromCollections(t.Prerequisite.PrerequisiteCollections,t.Prerequisite.PrerequisiteExcludeCollections):t.Prerequisite.PrerequisiteProducts&&(n=discountNinja.LiquidData.ValueInCartFromProducts(t.Prerequisite.PrerequisiteProducts,t.Prerequisite.PrerequisiteExcludeCollections)),Math.floor(n/100/i.Prerequisite.MinimumAmount)}return null}()||0},EntitledQuantity:function(t,i){if(i.Entitlement&&i.Entitlement.EntitledQuantity&&i.Prerequisite.BogoPrerequisiteQuantity&&i.Prerequisite.BogoPrerequisiteQuantity>0){let n=i.Entitlement.EntitledQuantity,e=i.Prerequisite.BogoPrerequisiteQuantity,o=discountNinja_Script_Prerequisite.PrerequisiteItemsInCart(t,i);n*=Math.floor(o/e);let r=t.AttributedQuantity,a=t.Entitlement.AllocationLimit;a>0&&n+r>a&&(n=Math.max(0,a-r));let c=Math.max(0,n-r);return n=Math.min(c,n)}return null}},discountNinja_Script_DeviceId={Get:function(){let t=discountNinja.Cache.LocalGet("limoniapps.deviceid.v2");return null===t&&(t="_"+(new Date).getTime()+"_"+function(){let t="";try{t=window.crypto&&"function"==typeof window.crypto.getRandomValues?window.crypto.getRandomValues(new Uint32Array(1))[0]:Math.random().toString().slice(2)}catch(i){t=Math.random().toString().slice(2)}return t}(),discountNinja.Cache.LocalSet("limoniapps.deviceid.v2",t)),t}};if(void 0===discountNinja)var discountNinja={Badge:discountNinja_Script_Badge,Cache:discountNinja_Script_Cache,Cart:{Shopify:discountNinja_Script_Cart_Shopify},Checkout:{Shopify:discountNinja_Script_Checkout_Shopify},Cookie:discountNinja_Script_Cookie,Core:discountNinja_Script_Core,DiscountCode:discountNinja_Script_DiscountCode,DiscountCodeTrigger:discountNinja_Script_DiscountCodeTrigger,DiscountedCart:discountNinja_Script_DiscountedCart,DiscountedProduct:discountNinja_Script_DiscountedProduct,DiscountTier:discountNinja_Script_DiscountTier,DynamicPricing:discountNinja_Script_DynamicPricing,Environment:{Shopify:discountNinja_Script_Environment_Shopify},LiquidData:discountNinja_Script_LiquidData,Logging:discountNinja_Script_Logging,MultiCurrency:discountNinja_Script_MultiCurrency,Notification:discountNinja_Script_Notification,PopUp:discountNinja_Script_PopUp,ProductData:discountNinja_Script_ProductData,Offer:discountNinja_Script_Offer,PromotionEvent:discountNinja_Script_PromotionEvent,PromotionFlow:discountNinja_Script_PromotionFlow,QueryParameter:discountNinja_Script_QueryParameter,Settings:discountNinja_Script_Settings,ShortCode:discountNinja_Script_ShortCode,StickyBar:discountNinja_Script_StickyBar,TabReminder:discountNinja_Script_TabReminder,TestMode:discountNinja_Script_TestMode,TextSettings:discountNinja_Script_TextSettings,Timer:discountNinja_Script_Timer,Token:discountNinja_Script_Token,Trigger:discountNinja_Script_Trigger,Utilities:discountNinja_Script_Utilities,TextScaling:discountNinja_Script_TextScaling,TemplateParameter:discountNinja_Script_TemplateParameterEngine,VariantChange:discountNinja_Script_VariantChange,XmlHttpRequest:discountNinja_Script_XmlHttpRequest,Events:discountNinja_Script_Events,VariantChangedEvent:discountNinja_Script_VariantChangedEvent,ServerCartItemsAddedEvent:discountNinja_Script_ServerCartItemsAddedEvent,ServerCartItemsChangedEvent:discountNinja_Script_ServerCartItemsChangedEvent,ServerCartItemsUpdatedEvent:discountNinja_Script_ServerCartItemsUpdatedEvent,ServerCollectionProductsPageLoadedEvent:discountNinja_Script_ServerCollectionProductsPageLoadedEvent,LocalCartUpdatedEvent:discountNinja_Script_LocalCartUpdatedEvent,ActionButton:discountNinja_Script_ActionButton,Prerequisite:discountNinja_Script_Prerequisite,DeviceId:discountNinja_Script_DeviceId,Currency:discountNinja_Script_Currency};history.pushState=function(t){return function(){var i=t.apply(this,arguments);return window.dispatchEvent(new Event("pushState")),window.dispatchEvent(new Event("limoniapps-discountninja-locationchange")),i}}(history.pushState),history.replaceState=function(t){return function(){var i=t.apply(this,arguments);return window.dispatchEvent(new Event("replaceState")),window.dispatchEvent(new Event("limoniapps-discountninja-locationchange")),i}}(history.replaceState),window.addEventListener("popstate",function(){window.dispatchEvent(new Event("limoniapps-discountninja-locationchange"))}),window.addEventListener("limoniapps-discountninja-locationchange",function(){var t=discountNinja.QueryParameter.RemoveFromUrl(window.location.href,"discountninjatestmode",1);(t=discountNinja.QueryParameter.RemoveFromUrl(t,"discountninjalog",1))!==discountNinja.Core.CurrentLocation&&(discountNinja.Core.CurrentLocation=t,setTimeout(function(){discountNinja.Core.Start()},1500))}),discountNinja.DynamicPricing.UpdatePriceDebouncedAfterInject=discountNinja.Utilities.Debounce(function(){discountNinja.DynamicPricing.UpdatePrice(!1,!0)},250),discountNinja.DynamicPricing.UpdatePriceDebouncedAfterServerUpdate=discountNinja.Utilities.Debounce(function(){discountNinja.DynamicPricing.UpdatePrice(!1,!1)},500),discountNinja.DOMHasLoaded=!1,discountNinja.Core.ExecuteOnLoadCallback(),discountNinja.Core.Start(!0),jQuery(document).ready(function(t){discountNinja.DOMHasLoaded=!0,discountNinja.Logging.LogVerbose("JQuery Document Ready")})}